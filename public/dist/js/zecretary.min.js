<<<<<<< HEAD
var zp=function(){"use strict";var t=function(t){zp.model.initModule(),zp.shell.initModule(t)};return{initModule:t}}();zp.model=function(){"use strict";var t,e,a,n,o,r,i,d,l,c,s,u,p,f,h={anon_idx:0},m={anon_user:null,db:new PouchDB("anon")};return i=function(t){var e=new PouchDB("http://zerohch0.iriscouch.com/members"),a=$.Deferred();return e.get(t).then(function(t){console.log(t),a.reject(t)})["catch"](function(t){console.log(t),a.resolve(t)}),a.promise()},r=function(t){var e=new PouchDB("http://zerohch0.iriscouch.com/members"),a=$.Deferred();return e.put(t).then(function(t){console.log(t),a.resolve(t)})["catch"](function(t){console.log(t),a.reject(t)}),a.promise()},o=function(t){var e=$.Deferred(),a=new PouchDB("http://zerohch0.iriscouch.com/members");return a.get(t.email,{include_docs:!0}).then(function(a){console.log(a),a.pw===t.pw?e.resolve(a):e.reject("비밀번호가 틀립니다.")})["catch"](function(t){console.log(t),e.reject("아이디가 존재하지 않습니다.")}),e.promise()},d=function(t){var e=new PouchDB("anon"),a=$.Deferred();return e=new PouchDB("anon"===localStorage.user?"anon":JSON.parse(localStorage.user)._id),e.put(t).then(function(t){return a.resolve(t),!0})["catch"](function(t){return console.log(t),a.reject(t),!1}),a.promise()},c=function(){var t,e,a=[],n=0,o=$.Deferred(),r=new PouchDB("anon");return r.allDocs({include_docs:!0}).then(function(r){for(console.log(r),t=r.rows,e=t.length,n;e>n;n++)console.log(t[n]),a.push(t[n].doc);o.resolve(a)})["catch"](function(t){console.log("todo",t),o.reject(t)}),o.promise()},l=function(t){var e=new PouchDB("anon"),a=$.Deferred();return e.put(t).then(function(t){return $.gevent.publish("submit",["plan"]),console.log("plan registered",t),!0})["catch"](function(t){return console.log(t),alert("error!"),!1}),a.promise()},s=function(){var t,e,a=[],n=0,o=$.Deferred();return h.plans.allDocs({include_docs:!0,attachments:!0}).then(function(o){for(console.log(o),t=o.rows,e=t.length,n;e>n;n++)console.log(t[n]),a.push(t[n].doc);$.gevent.publish("getPlan",[a])})["catch"](function(t){console.log("plan",t)}),o.promise()},e=function(t){var e=new PouchDB("anon"),a=$.Deferred();return e.put(t).then(function(t){return a.resolve(t),!0})["catch"](function(t){return a.reject(t),!1}),a.promise()},a=function(){var t,e,a=[],n=0,o=$.Deferred(),r=new PouchDB("anon");return r.allDocs({include_docs:!0}).then(function(o){for(console.log(o),t=o.rows,e=t.length,n;e>n;n++)console.log(t[n]),a.push(t[n].doc);$.gevent.publish("getDday",[a])})["catch"](function(t){console.log("dday",t)}),o.promise()},u=function(){return!0},n=function(t){var e=$.Deferred(),a=new PouchDB("anon");return a.replicate.to("http://zerohch0.iriscouch.com/"+t,{live:!0},function(t){console.log(t)}),a.replicate.from("http://zerohch0.iriscouch.com/"+t,{live:!0},function(t){console.log(t)}),e.promise()},p=function(t){var e=$.Deferred(),a=new PouchDB("anon");return a.replicate.to("http://zerohch0.iriscouch.com/"+t,{live:!0},function(t){t?(console.log(t),e.reject(t)):e.resolve()}),e.promise()},f=function(t){var e=$.Deferred(),a=new PouchDB("anon");return a.replicate.from("http://zerohch0.iriscouch.com/"+t,{live:!0},function(t){t?(console.log(t),e.reject(t)):e.resolve()}),e.promise()},t=function(){return"false"===localStorage.online&&(m.anon_user=!0),!0},{initModule:t,login:o,setTodo:d,getTodo:c,setPlan:l,getPlan:s,getInfo:u,setDday:e,getDday:a,sync:n,join:r,checkEmail:i,upload:p,download:f}}(),zp.util=function(){var t,e;return t=function(t,e,a){var n=new Error;return n.name=t,n.message=e,a&&(n.data=a),n},e=function(e){var a,n,o=e.input_map,r=e.settable_map,i=e.config_map;for(a in o)if(o.hasOwnProperty(a)){if(!r.hasOwnProperty(a))throw n=t("Bad Input","Setting config key |"+a+"| is not supported");i[a]=o[a]}},{makeError:t,setConfigMap:e}}(),zp.util_b=function(){"use strict";var t,e,a,n={regex_encode_html:/[&"'><]/g,regex_encode_noamp:/["'><]/g,html_encode_map:{"&":"&#38;",'"':"&#34;","'":"&#39;",">":"&#62;","<":"&#60;"}};return n.encode_noamp_map=$.extend({},n.html_encode_map),delete n.encode_noamp_map["&"],t=function(t){return $("<div/>").html(t||"").text()},e=function(t,e){var a,o,r=String(t);return e?(o=n.encode_noamp_map,a=n.regex_encode_noamp):(o=n.html_encode_map,a=n.regex_encode_html),r.replace(a,function(t){return o[t]||""})},a=function(t){return Number(getComputedStyle(t,"").fontSize.match(/\d*\.?\d*/)[0])},{decodeHtml:t,encodeHtml:e,getEmSize:a}}(),zp.calendar=function(){"use strict";var t,e,a,n,o,r,i,d,l,c,s,u,p,f,h,m,g={main_html:String()+'<table class="calendar-table"><caption class="calendar-caption"></caption><thead><tr><th>주</th><th>일</th><th>월</th><th>화</th><th>수</th><th>목</th><th>금</th><th>토</th></tr></thead><tbody><tr><th></th><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><th></th><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><th></th><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><th></th><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><th></th><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><th></th><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table>',day_list:["일","월","화","수","목","금","토"]},y={$container:null},v={};return e=function(t){var e=0;for(v={$container:t,$table:t.find("table"),$caption:t.find("caption")},e;6>=e;e++)v["$tr"+e]=t.find("tr:eq("+e+")")},t=function(t,a){var o=a.month,r=a.year;y.$container=t,t.html(g.main_html),e(t),n(o,r)},n=function(t,e){t=parseInt(t,10),e=parseInt(e,10);var n,r,i,d,l,c=new Date,s=1,u=2,p=new Date;for(c.setYear(e),c.setMonth(t-1),c.setDate(1),n=c.getDay(),c.setMonth(t),c.setDate(c.getDate()-1),r=c.getDate(),v.$caption.html(t+"월"),d=o(s,t,e),i=n;7>i;i++)v.$tr1.find("th").html(d+"주"),v.$tr1.find("td").eq(i).append("<div>"+s+"</div>"),s++;for(d++;r-7>=s;){for(i=0;7>i;i++)v["$tr"+String(u)].find("th").html(d+"주"),v["$tr"+String(u)].find("td").eq(i).append("<div>"+s+"</div>"),s++;u++,d++}for(i=0;r>=s;i++)v["$tr"+String(u)].find("th").html(d+"주"),v["$tr"+String(u)].find("td").eq(i).append("<div>"+s+"</div>"),s++;switch(u){case 4:v.$tr5.addClass("hidden"),v.$tr6.addClass("hidden");break;case 5:v.$tr6.addClass("hidden")}e===p.getFullYear()&&t===p.getMonth()+1&&(l=v.$table.find("td"),l.each(function(){parseInt($(this).find("div").eq(0).html(),10)===p.getDate()&&$(this).addClass("td-today")})),a(t,e)},a=function(t,e){var a,n=v.$table.find("td"),o=s(e+"0101","ltos"),r=s(e+"0408","ltos"),i=s(e+"0815","ltos");switch(t===o.month?n.each(function(){a=parseInt($(this).text(),10),(a===o.day||a===o.day-1||a===o.day+1)&&$(this).css("color","red")}):t===r.month?n.each(function(){a=parseInt($(this).text(),10),a===r.day&&$(this).css("color","red")}):t===i.month&&n.each(function(){a=parseInt($(this).text(),10),(a===i.day||a===i.day-1||a===i.day+1)&&$(this).css("color","red")}),t){case 1:n.each(function(){1===parseInt($(this).text(),10)&&$(this).css("color","red")});break;case 3:n.each(function(){1===parseInt($(this).text(),10)&&$(this).css("color","red")});break;case 5:n.each(function(){5===parseInt($(this).text(),10)&&$(this).css("color","red")});break;case 6:n.each(function(){6===parseInt($(this).text(),10)&&$(this).css("color","red")});break;case 8:n.each(function(){15===parseInt($(this).text(),10)&&$(this).css("color","red")});break;case 10:n.each(function(){(3===parseInt($(this).text(),10)||9===parseInt($(this).text(),10))&&$(this).css("color","red")});break;case 12:n.each(function(){25===parseInt($(this).text(),10)&&$(this).css("color","red")})}return!0},s=function(t,e){if("ltos"!==e&&"stol"!==e)return!1;var a,n,o,i,d,l,c,s,u,p,f,h,m,g,$,y,v,k,w,b,_,x,S,D,z=[[1,2,4,1,1,2,1,2,1,2,2,1],[2,2,1,2,1,1,2,1,2,1,2,1],[2,2,2,1,2,1,4,1,2,1,2,1],[2,2,1,2,1,2,1,2,1,2,1,2],[1,2,1,2,2,1,2,1,2,1,2,1],[2,1,2,1,5,2,1,2,2,1,2,1],[2,1,1,2,1,2,1,2,2,2,1,2],[1,2,1,1,2,1,2,1,2,2,2,1],[2,1,2,3,2,1,2,1,2,1,2,2],[2,1,2,1,1,2,1,1,2,2,1,2],[2,2,1,2,1,1,2,1,2,1,5,2],[2,1,2,2,1,1,2,1,2,1,1,2],[2,1,2,2,1,2,1,2,1,2,1,2],[1,2,1,2,1,2,5,2,1,2,1,2],[1,1,2,1,2,2,1,2,2,1,2,1],[2,1,1,2,1,2,1,2,2,2,1,2],[1,2,1,1,5,2,1,2,1,2,2,2],[1,2,1,1,2,1,1,2,2,1,2,2],[2,1,2,1,1,2,1,1,2,1,2,2],[2,1,6,1,1,2,1,1,2,1,2,2],[1,2,2,1,2,1,2,1,2,1,1,2],[2,1,2,1,2,2,1,2,2,3,1,2],[1,2,2,1,2,1,2,2,1,2,1,2],[1,1,2,1,2,1,2,2,1,2,2,1],[2,1,1,2,4,1,2,2,1,2,2,1],[2,1,1,2,1,1,2,2,1,2,2,2],[1,2,1,1,2,1,1,2,1,2,2,2],[1,2,2,3,2,1,1,2,1,2,2,1],[2,2,2,1,1,2,1,1,2,1,2,1],[2,2,2,1,2,1,2,1,1,5,2,1],[2,2,1,2,2,1,2,1,2,1,1,2],[1,2,1,2,2,1,2,1,2,2,1,2],[1,1,2,1,2,4,2,1,2,2,1,2],[1,1,2,1,2,1,2,1,2,2,2,1],[2,1,1,2,1,1,2,1,2,2,2,1],[2,2,1,1,5,1,2,1,2,2,1,2],[2,2,1,1,2,1,1,2,1,2,1,2],[2,2,1,2,1,2,1,1,2,1,2,1],[2,2,4,2,1,2,1,1,2,1,2,1],[2,1,2,2,1,2,2,1,2,1,1,2],[1,2,1,2,1,2,5,2,2,1,2,1],[1,2,1,2,1,2,1,2,2,1,2,2],[1,1,2,1,1,2,1,2,2,2,1,2],[2,1,1,2,3,2,1,2,2,1,2,2],[2,1,1,2,1,1,2,1,2,1,2,2],[2,1,2,1,2,1,1,2,1,2,1,2],[2,2,1,5,2,1,1,2,1,2,1,2],[2,1,2,2,1,2,1,1,2,1,2,1],[2,1,2,2,1,2,1,2,1,2,1,2],[1,5,2,1,2,2,1,2,1,2,1,2],[1,2,1,2,1,2,1,2,2,1,2,2],[1,1,2,1,1,5,2,2,1,2,2,2],[1,1,2,1,1,2,1,2,1,2,2,2],[1,2,1,2,1,1,2,1,2,1,2,2],[2,1,2,1,5,1,2,1,2,1,2,1],[2,2,2,1,2,1,1,2,1,2,1,2],[1,2,2,1,2,1,2,1,2,1,2,1],[2,1,5,2,2,1,2,1,2,1,2,1],[2,1,2,1,2,1,2,2,1,2,1,2],[1,2,1,1,2,1,2,5,2,2,1,2],[1,2,1,1,2,1,2,1,2,2,2,1],[2,1,2,1,1,2,1,2,1,2,2,2],[1,2,1,2,3,2,1,1,2,2,1,2],[2,2,1,2,1,1,2,1,1,2,2,1],[2,2,1,2,2,1,1,2,1,2,1,2],[1,2,2,4,1,2,1,2,1,2,1,2],[1,2,1,2,1,2,2,1,2,1,2,1],[2,1,1,2,2,1,2,1,2,2,1,2],[1,5,1,2,1,2,1,2,2,2,1,2],[1,2,1,1,2,1,2,1,2,2,2,1],[2,1,2,1,1,5,1,2,2,1,2,2],[2,1,2,1,1,2,1,1,2,2,1,2],[2,2,1,2,1,1,2,1,1,2,1,2],[2,2,1,2,5,1,2,1,2,1,1,2],[2,1,2,2,1,2,1,2,1,2,1,2],[1,2,1,2,1,2,2,1,2,1,2,1],[2,3,2,1,2,2,1,2,2,1,2,1],[2,1,1,2,1,2,1,2,2,2,1,2],[1,2,1,1,2,1,5,2,2,1,2,2],[1,2,1,1,2,1,1,2,2,1,2,2],[2,1,2,1,1,2,1,1,2,1,2,2],[2,1,2,2,3,2,1,1,2,1,2,2],[1,2,2,1,2,1,2,1,2,1,1,2],[2,1,2,1,2,2,1,2,1,2,1,1],[2,1,2,5,2,1,2,2,1,2,1,2],[1,1,2,1,2,1,2,2,1,2,2,1],[2,1,1,2,1,2,1,2,2,1,2,2],[1,5,1,2,1,1,2,2,1,2,2,2],[1,2,1,1,2,1,1,2,1,2,2,2],[1,2,2,1,1,5,1,2,1,2,2,1],[2,2,2,1,1,2,1,1,2,1,2,1],[2,2,2,1,2,1,2,1,1,2,1,2],[1,2,2,1,6,1,2,1,2,1,1,2],[1,2,1,2,2,1,2,2,1,2,1,2],[1,1,2,1,2,1,2,2,1,2,2,1],[2,1,4,1,2,1,2,1,2,2,2,1],[2,1,1,2,1,1,2,1,2,2,2,1],[2,2,1,1,2,1,4,1,2,2,1,2],[2,2,1,1,2,1,1,2,1,2,1,2],[2,2,1,2,1,2,1,1,2,1,2,1],[2,2,1,2,2,4,1,1,2,1,2,1],[2,1,2,2,1,2,2,1,2,1,1,2],[1,2,1,2,1,2,2,1,2,2,1,2],[1,1,2,4,1,2,1,2,2,1,2,2],[1,1,2,1,1,2,1,2,2,2,1,2],[2,1,1,2,1,1,2,1,2,2,1,2],[2,5,1,2,1,1,2,1,2,1,2,2],[2,1,2,1,2,1,1,2,1,2,1,2],[2,2,1,2,1,2,3,2,1,2,1,2],[2,1,2,2,1,2,1,1,2,1,2,1],[2,1,2,2,1,2,1,2,1,2,1,2],[1,2,1,2,4,2,1,2,1,2,1,2],[1,2,1,1,2,2,1,2,2,1,2,2],[1,1,2,1,1,2,1,2,2,1,2,2],[2,1,4,1,1,2,1,2,1,2,2,2],[1,2,1,2,1,1,2,1,2,1,2,2],[2,1,2,1,2,1,1,5,2,1,2,2],[1,2,2,1,2,1,1,2,1,2,1,2],[1,2,2,1,2,1,2,1,2,1,2,1],[2,1,2,1,2,5,2,1,2,1,2,1],[2,1,2,1,2,1,2,2,1,2,1,2],[1,2,1,1,2,1,2,2,1,2,2,1],[2,1,2,3,2,1,2,1,2,2,2,1],[2,1,2,1,1,2,1,2,1,2,2,2],[1,2,1,2,1,1,2,1,1,2,2,1],[2,2,5,2,1,1,2,1,1,2,2,1],[2,2,1,2,2,1,1,2,1,2,1,2],[1,2,2,1,2,1,5,2,1,2,1,2],[1,2,1,2,1,2,2,1,2,1,2,1],[2,1,1,2,2,1,2,1,2,2,1,2],[1,2,1,1,5,2,1,2,2,2,1,2],[1,2,1,1,2,1,2,1,2,2,2,1],[2,1,2,1,1,2,1,1,2,2,2,1],[2,2,1,5,1,2,1,1,2,2,1,2],[2,2,1,2,1,1,2,1,1,2,1,2],[2,2,1,2,1,2,1,5,2,1,1,2],[2,1,2,2,1,2,1,2,1,2,1,1],[2,2,1,2,1,2,2,1,2,1,2,1],[2,1,1,2,1,6,1,2,2,1,2,1],[2,1,1,2,1,2,1,2,2,1,2,2],[1,2,1,1,2,1,1,2,2,1,2,2],[2,1,2,3,2,1,1,2,2,1,2,2],[2,1,2,1,1,2,1,1,2,1,2,2],[2,1,2,2,1,1,2,1,1,5,2,2],[1,2,2,1,2,1,2,1,1,2,1,2],[1,2,2,1,2,2,1,2,1,2,1,1],[2,1,2,2,1,5,2,2,1,2,1,2],[1,1,2,1,2,1,2,2,1,2,2,1],[2,1,1,2,1,2,1,2,2,1,2,2],[1,2,1,1,5,1,2,1,2,2,2,2],[1,2,1,1,2,1,1,2,1,2,2,2],[1,2,2,1,1,2,1,1,2,1,2,2],[1,2,5,2,1,2,1,1,2,1,2,1],[2,2,2,1,2,1,2,1,1,2,1,2],[1,2,2,1,2,2,1,5,2,1,1,2],[1,2,1,2,2,1,2,1,2,2,1,2],[1,1,2,1,2,1,2,2,1,2,2,1],[2,1,1,2,3,2,2,1,2,2,2,1],[2,1,1,2,1,1,2,1,2,2,2,1],[2,2,1,1,2,1,1,2,1,2,2,1],[2,2,2,3,2,1,1,2,1,2,1,2],[2,2,1,2,1,2,1,1,2,1,2,1],[2,2,1,2,2,1,2,1,1,2,1,2],[1,5,2,2,1,2,1,2,2,1,1,2],[1,2,1,2,1,2,2,1,2,2,1,2],[1,1,2,1,2,1,5,2,2,1,2,2],[1,1,2,1,1,2,1,2,2,2,1,2],[2,1,1,2,1,1,2,1,2,2,1,2],[2,2,1,1,5,1,2,1,2,1,2,2],[2,1,2,1,2,1,1,2,1,2,1,2],[2,1,2,2,1,2,1,1,2,1,2,1],[2,1,6,2,1,2,1,1,2,1,2,1],[2,1,2,2,1,2,1,2,1,2,1,2],[1,2,1,2,1,2,1,2,5,2,1,2],[1,2,1,1,2,1,2,2,2,1,2,2],[1,1,2,1,1,2,1,2,2,1,2,2],[2,1,1,2,3,2,1,2,1,2,2,2],[1,2,1,2,1,1,2,1,2,1,2,2],[2,1,2,1,2,1,1,2,1,2,1,2],[2,1,2,5,2,1,1,2,1,2,1,2],[1,2,2,1,2,1,2,1,2,1,2,1],[2,1,2,1,2,2,1,2,1,2,1,2],[1,5,2,1,2,1,2,2,1,2,1,2],[1,2,1,1,2,1,2,2,1,2,2,1],[2,1,2,1,1,5,2,1,2,2,2,1],[2,1,2,1,1,2,1,2,1,2,2,2],[1,2,1,2,1,1,2,1,1,2,2,2],[1,2,2,1,5,1,2,1,1,2,2,1],[2,2,1,2,2,1,1,2,1,1,2,2],[1,2,1,2,2,1,2,1,2,1,2,1],[2,1,5,2,1,2,2,1,2,1,2,1],[2,1,1,2,1,2,2,1,2,2,1,2],[1,2,1,1,2,1,5,2,2,2,1,2],[1,2,1,1,2,1,2,1,2,2,2,1],[2,1,2,1,1,2,1,1,2,2,1,2],[2,2,1,2,1,4,1,1,2,1,2,2],[2,2,1,2,1,1,2,1,1,2,1,2],[2,2,1,2,1,2,1,2,1,1,2,1],[2,2,1,2,5,2,1,2,1,2,1,1],[2,1,2,2,1,2,2,1,2,1,2,1],[2,1,1,2,1,2,2,1,2,2,1,2],[1,5,1,2,1,2,1,2,2,2,1,2],[1,2,1,1,2,1,1,2,2,1,2,2]],M=[31,0,31,30,31,30,31,31,30,31,30,31],N=t.substring(0,4),O=t.substring(4,6),C=t.substring(6,8),I=[203];if("stol"===e){for(S=672069.2,w=N,_=O,M[1]=r(2,w),x=C||M[_-1],b=w-1,D=365*b+b/4-b/100+b/400+parseInt(x,10),m=0;_-1>m;m++)D+=M[m];for($=D-S+1,m=0;w-1841>=m;m++)for(I[m]=0,g=0;12>g;g++){switch(z[m][g]){case 1:s=29;break;case 2:s=30;break;case 3:s=58;break;case 4:s=59;break;case 5:s=59;break;case 6:s=60}I[m]=I[m]+s}for(y=0;;){if(!($>I[y]))break;$-=I[y],y+=1}for(v=0;;)if(z[y][v]<=2){if(s=z[y][v]+28,!($>s))break;$-=s,v+=1}else{switch(z[y][v]){case 3:f=29,h=29;break;case 4:f=29,h=30;break;case 5:f=30,h=29;break;case 6:f=30,h=30}if(!($>f))break;if($-=f,!($>h))break;$-=h,v+=1}return y+=1841,v+=1,k=$,{year:y,month:v,day:k}}if("ltos"===e){if(a=N,n=O,u=a-1841,f=n-1,i=0,z[u][f]>2)switch(z[u][f]){case 1:case 3:case 4:s=29;break;case 2:case 5:case 6:s=30}for(o=C,$=0,m=0;u>m;m++)for(g=0;12>g;g++)switch(z[m][g]){case 1:$+=29;break;case 2:$+=30;break;case 3:$+=58;break;case 4:$+=59;break;case 5:$+=59;break;case 6:$+=60}for(g=0;f>g;g++)switch(z[u][g]){case 1:$+=29;break;case 2:$+=30;break;case 3:$+=58;break;case 4:$+=59;break;case 5:$+=59;break;case 6:$+=60}if(1===i)switch(z[u][f]){case 3:case 4:$+=29;break;case 5:case 6:$+=30}for($=$+parseFloat(o)+22,u=1840;;){if(u+=1,p=u%400===0||u%100!==0&&u%4===0?366:365,p>=$)break;$-=p}for(d=u,M[1]=parseInt(p,10)-337,f=0;;){if(f+=1,$<=M[f-1])break;$-=M[f-1]}return l=parseInt(f,10),c=parseInt($,10),{year:d,month:l,day:c}}},p=function(t,e){var a,n;return e||(e=1),a=new Date(t.year,t.month-1,parseInt(t.date,10)+e),n={date:a.getDate(),month:a.getMonth()+1,year:a.getFullYear()},n.week=o(n.date,n.month,n.year),n.day=new Date(n.year,n.month-1,n.date).getDay(),n},u=function(t,e){var a,n;return e||(e=1),a=new Date(t.year,t.month-1,t.date-e),n={date:a.getDate(),month:a.getMonth()+1,year:a.getFullYear()},n.week=o(n.date,n.month,n.year),n.day=new Date(n.year,n.month-1,n.date).getDay(),n},h=function(t,e){e||(e=1);var a=u(t,e);return l(a)},f=function(t,e){e||(e=1);var a=p(t,e);return l(a)},l=function(t,e){var a,n="",o=t.date,r=t.month,i=t.year;return e||(e=""),n+=i,t.week?(a=t.week,n=n+e+a):r&&(10>r&&(n+=0),n=n+e+r),o&&(10>o&&(n+=0),n=n+e+o),n},d=function(t){if("string"!=typeof t)return console.warn("인자는 문자열이어야 합니다."),!1;var e,a,n,r;return 8===t.length?(a=t.substr(0,4),n=t.substr(4,2),r=t.substr(6,2)):10===t.length&&(a=t.substr(0,4),n=t.substr(5,2),r=t.substr(8,2)),e={year:parseInt(a,10),month:parseInt(n,10),date:parseInt(r,10),week:o(a,n,r)}},m=function(t,e,a){a||(a=(new Date).getFullYear());var n=new Date(a,e-1,t).getDay();return g.day_list[n]},i=function(t,e,a){var n=[31,28,31,30,31,30,31,31,30,31,30,31],o=0,i=0;if(a||(a=(new Date).getFullYear()),29===r(2,a)&&(n[1]=29),e){for(;e-1>o;)i+=n[o],o++;return i+=t}for(;t>0;)t-=n[o],o++;return e=o,t+=n[o-1],{month:e,date:t,year:a}},r=function(t,e){return e||(e=(new Date).getFullYear()),new Date(e,t,0).getDate()},c=function(t,e){e||(e=(new Date).getFullYear());var a,n,o=0,r=new Date(e,0,1).getDay(),d=[];for(a=7*t-r-6,o;7>o;o++)n=i(a),d[o]={month:n.month,date:n.date},a++;return d},o=function(t,e,a){a||(a=(new Date).getFullYear());var n,o,r=new Date(a,0,1).getDay(),d=new Date(a,e-1,t).getDay(),l=6-d;return o=i(t,e,a)+r+l,n=Math.floor(o/7),r>4&&(n-=1),n},{initModule:t,getWeekNum:o,dayOfYear:i,getWeekDay:c,daysInMonth:r,dayOfWeek:m,stringify:l,objectify:d,lunarSolar:s,getPrevDate:u,getNextDate:p,getPrevString:h,getNextString:f}}(),zp.shell=function(){"use strict";var t,e,a,n,o,r,i,d,l,c,s,u,p,f,h,m,g,y,v,k,w,b,_,x,S,D,z,M,N,O,C,I,J={anchor_schema_map:{current:{year:!0,month:!0,week:!0,day:!0,plan:!0,todo:!0},date:!0},today:{year:(new Date).getFullYear(),month:(new Date).getMonth()+1,date:(new Date).getDate(),week:zp.calendar.getWeekNum((new Date).getDate(),(new Date).getMonth()+1),day:(new Date).getDay()},day:["일","월","화","수","목","금","토"]},T={$container:null,anchor_map:{},cur:"day",act:"reload",date_info:{year:J.today.year,month:J.today.month,date:J.today.date,week:J.today.week,day:J.today.day},flick:[100,200,0],state:"static",top:0,left:0,fidx:0,db:null},q={};return e=function(t){q={$container:t,$header:t.find("header"),$user:t.find(".user"),$avatar:t.find(".avatar"),$info:t.find(".info"),$name:t.find(".name"),$menu:t.find(".menu"),$logout:t.find(".menu-logout"),$profile:t.find(".menu-profile"),$upload:t.find(".menu-upload"),$download:t.find(".menu-download"),$main:t.find("main"),$flickView:t.find(".flick-view"),$flickCon:t.find(".flick-con"),$flick:t.find(".flick-panel"),$toggle:t.find(".tool-toggle"),$search:t.find(".tool-search"),$modal:t.find(".modal"),$intro:t.find(".intro")}},n=function(t,e){t.preventDefault();var a;"static"===T.state?(a=String(e.year)+("0"+e.month).slice(-2)+("0"+e.date).slice(-2),p("day",a),I()):T.state="static"},o=function(t,e){t.preventDefault();var a;"static"===T.state?(a=e.year+("0"+e.week).slice(-2),p("week",a),I()):T.state="static"},r=function(t,e){t.preventDefault();var a;"static"===T.state?(a=e.year+("0"+e.month).slice(-2),p("month",a),I()):T.state="static"},i=function(t,e){t.preventDefault();var a;"static"===T.state?(a=String(e.year),p("year",a),I()):T.state="static"},a=function(t,e){console.log("main을 초기화합니다."+t);var a={};e.week=e.week||zp.calendar.getWeekNum(e.date,e.month,e.year),zp[t].initModule(q.$flick.eq(0),e),"day"===t?(a=zp.calendar.getNextDate(e),zp.day.initModule(q.$flick.eq(1),a),a=zp.calendar.getPrevDate(e),zp.day.initModule(q.$flick.eq(2),a)):"week"===t?(a.week=e.week+1,a.year=e.year,54===a.week&&(a.week=1,a.year+=1),zp.week.initModule(q.$flick.eq(1),a),a.week=e.week-1,0===a.week&&(a.week=53,a.year-=1),zp.week.initModule(q.$flick.eq(2),a)):"month"===t?(a={year:e.year,month:e.month+1},13===a.month&&(a.month=1,a.year+=1),zp.month.initModule(q.$flick.eq(1),a),a={year:e.year,month:e.month-1},0===a.month&&(a.month=12,a.year-=1),zp.month.initModule(q.$flick.eq(2),a)):"year"===t&&(a={year:e.year+1},zp.year.initModule(q.$flick.eq(1),a),a={year:e.year-1},zp.year.initModule(q.$flick.eq(2),a)),T.cur=t,x(e),console.log("메인이 초기화되었습니다!")},x=function(t){console.log("상단 title을 변경합니다.");var e="",a="",n=T.cur;switch(n){case"day":0===t.day?a='style="color:yellow;"':6===t.day&&(a='style="color:blue;"'),e='<span class="title-year">'+t.year+'</span>.<span class="title-month">'+t.month+'</span>.<span class="title-date">'+t.date+'</span> <span class="title-day" '+a+">"+J.day[t.day]+'</span> <span class="title-week">'+t.week+"주차</span>";break;case"week":t.week=t.week||zp.calendar.getWeekNum(t.date,t.month,t.year),e='<span class="title-year">'+t.year+'</span>년 <span class="title">'+t.week+"주차</span>";break;case"month":e='<span class="title-year">'+t.year+'년</span> <span class="title">'+t.month+"월</span>";break;case"year":e='<span class="title">'+t.year+"년</span>";break;case"todo":e='<span class="title">할일</span>';break;case"plan":e='<span class="title">일정</span>';break;case"dday":e='<span class="title">D-day / 기념일</span>'}return q.$info.html(e),t&&(console.log("data가 있어 stateMap 날짜 정보를 변경합니다."),t.hasOwnProperty("date")&&(T.date_info.date=t.date),t.hasOwnProperty("month")&&(T.date_info.month=t.month),t.hasOwnProperty("year")&&(T.date_info.year=t.year),t.hasOwnProperty("week")&&(T.date_info.week=t.week)),$.extend({},t)},u=function(){alert("처음이시군요!"),q.$intro.show(),confirm("다음 실행 때도 보시겠습니까?")||(localStorage.first="false")},w=function(t){return t.stopPropagation(),JSON.parse(localStorage.online)===!1?(zp.modal.initModule(q.$modal,"login").show(),!1):confirm("로그아웃하시겠습니까?")?(q.$name.html("로그인"),q.$avatar.html(""),localStorage.removeItem("user"),localStorage.online="false",alert("로그아웃되었습니다!"),q.$menu.hide(),zp.modal.initModule(q.$modal,"login").show(),void q.$modal.find(".input-id").focus()):!1},b=function(){zp.model.upload()},_=function(){zp.model.download()},S=function(){I(),p("year",T.date_info.year),T.cur="year",x(T.date_info)},D=function(){I(),p("month",T.date_info.year+("0"+T.date_info.month).slice(-2)),T.cur="month",x(T.date_info)},z=function(){I(),p("week",T.date_info.year+("0"+T.date_info.week).slice(-2)),T.cur="week",x(T.date_info)},C=function(t,e){var a,n,o=T.cur;if(T.act="swipe",e.year=parseInt(e.year,10),e.month=parseInt(e.month,10),e.week=parseInt(e.week,10),"left"===t)switch(console.log("swiped to the left!"),n=(T.fidx+1)%3,o){case"day":e=x(zp.calendar.getNextDate(e)),a=zp.calendar.getNextDate(e),zp[o].initModule(q.$flick.eq(n),a),p(o,e.year+("0"+e.month).slice(-2)+("0"+e.date).slice(-2));break;case"week":e.week+=1,54===e.week&&(e.week=1,e.year+=1),a=x(e),a.week+=1,54===a.week&&(a.week=1,a.year+=1),zp.week.initModule(q.$flick.eq(n),a),p("week",e.year+("0"+e.week).slice(-2));break;case"month":e.month+=1,13===e.month&&(e.month=1,e.year+=1),a=x(e),a.month+=1,13===a.month&&(a.month=1,a.year+=1),zp.month.initModule(q.$flick.eq(n),a),p("month",e.year+("0"+e.month).slice(-2));break;case"year":e.year+=1,e=x(e),a=$.extend({},e),a.year+=1,zp.year.initModule(q.$flick.eq(n),a),p("year",e.year);break;case"todo":T.cur="plan",x();break;case"plan":T.cur="dday",x();break;case"dday":T.cur="todo",x()}else switch(console.log("swiped to the right!"),n=(T.fidx-1)%3,o){case"day":e=x(zp.calendar.getPrevDate(e)),a=zp.calendar.getPrevDate(e),zp[o].initModule(q.$flick.eq(n),a),p(o,e.year+("0"+e.month).slice(-2)+("0"+e.date).slice(-2));break;case"week":e.week-=1,0===e.week&&(e.week=53,e.year-=1),a=x(e),a.week-=1,0===a.week&&(a.week=53,a.year-=1),zp.week.initModule(q.$flick.eq(n),a),p("week",e.year+("0"+e.week).slice(-2));break;case"month":e.month-=1,0===e.month&&(e.month=12,e.year-=1),a=x(e),a.month-=1,0===a.month&&(a.month=12,a.year-=1),zp[o].initModule(q.$flick.eq(n),a),p(o,e.year+("0"+e.month).slice(-2));break;case"year":e.year-=1,a=x(e),a.year-=1,zp[o].initModule(q.$flick.eq(n),a),p(o,e.year);break;case"todo":T.cur="dday",x();break;case"plan":T.cur="todo",x();break;case"dday":T.cur="plan",x()}return q.$flick.eq(n).css("top",0),T.date_info=e,console.log("swipe가 완료되었습니다",T.act),e},O=function(){return"true"!==localStorage.online?(zp.modal.initModule(q.$modal,"login").show(),!1):(q.$menu.toggle(),!1)},m=function(t,e){t.preventDefault(),localStorage.online="true",q.$name.html(e.name),q.$avatar.html(e.avatar||""),localStorage.user=JSON.stringify(e),console.log("online mode"),!localStorage.first&&JSON.parse(localStorage.first)&&u()},h=function(){zp.modal.configModule({set_cur_anchor:p}),zp.modal.initModule(q.$modal,"search").show()},N=function(t,e){t.preventDefault(),console.log("onSubmit",e),p(e)},g=function(t,e){t.preventDefault(),zp.modal.initModule(q.$modal,"type",e).show()},s=function(){var t=c().current;T.act="reload","todo"===t||"plan"===t||"dday"===t?(p("day"),q.$toggle.html('<i class="fa fa-list"></i>')):(p("todo"),q.$toggle.html('<i class="fa fa-calendar"></i>'))},c=function(){return $.extend(!0,{},T.anchor_map)},l=function(t){var e,a,n=c(),o=!0;for(e in t)if(t.hasOwnProperty(e)){if(0===e.indexOf("_"))continue;n[e]=t[e],void 0===t[e]&&(delete t[e],delete n[e]),a="_"+e,t[a]?n[a]=t[a]:(delete n[a],delete n["_s"+a])}try{$.uriAnchor.setAnchor(n)}catch(r){$.uriAnchor.setAnchor(T.anchor_map,null,!0),o=!1}return o},p=function(t,e){var a={current:t,date:e};return l(a)},f=function(){var t,e,n,o,r,i,d=c(),l={};console.log((new Date).getHours(),(new Date).getMinutes(),(new Date).getSeconds(),"해시가 변경이 시도되었습니다.");try{t=$.uriAnchor.makeAnchorMap()}catch(s){return $.uriAnchor.setAnchor(d,null,!0),!1}if(void 0===t.current&&(t.current="day"),T.anchor_map=t,r=d._s_date,i=t._s_date,e=d._s_current,n=t._s_current,!Object.keys(d).length||e!==n||r!==i)switch(o=t.current){case"year":"reload"===T.act?(i&&(l.year=T.date_info.year=parseInt(i.substr(0,4),10)),a("year",l)):T.act="reload";break;case"month":"reload"===T.act?(i&&(l.year=T.date_info.year=parseInt(i.substr(0,4),10),l.month=T.date_info.month=parseInt(i.substr(4,2),10)),a("month",l)):T.act="reload";break;case"week":"reload"===T.act?(i&&(l.year=T.date_info.year=parseInt(i.substr(0,4),10),l.week=T.date_info.week=parseInt(i.substr(4,2),10)),console.log("onhashchange","data.week",l.week),a("week",l)):T.act="reload";break;case"day":"reload"===T.act?(i?(l.year=T.date_info.year=parseInt(i.substr(0,4),10),l.month=T.date_info.month=parseInt(i.substr(4,2),10),l.date=T.date_info.date=parseInt(i.substr(6,2),10)):(l.year=T.date_info.year,l.month=T.date_info.month,l.date=T.date_info.date),l.day=new Date(l.year,l.month-1,l.date).getDay(),l.week=zp.calendar.getWeekNum(l.date,l.month,l.year),a("day",l)):T.act="reload";break;case"plan":I(),zp.plan.initModule(q.$flick.eq(0)),zp.dday.initModule(q.$flick.eq(1)),zp.todo.initModule(q.$flick.eq(2)),T.cur="plan",x();break;case"todo":I(),zp.todo.initModule(q.$flick.eq(0)),zp.plan.initModule(q.$flick.eq(1)),zp.dday.initModule(q.$flick.eq(2)),T.cur="todo",x();break;case"dday":I(),zp.dday.initModule(q.$flick.eq(0)),zp.todo.initModule(q.$flick.eq(1)),zp.plan.initModule(q.$flick.eq(2)),T.cur="dday",x();break;default:delete t.current,delete t.date,$.uriAnchor.setAnchor(t,null,!0)}},I=function(){console.log("flick 포지션을 초기화합니다"),q.$main.css("height",$(window).height()-q.$header.height()),q.$flick.css("min-height",$(window).height()-q.$header.height()),q.$flick.eq(0).css("left","0%"),q.$flick.eq(1).css("left","100%"),q.$flick.eq(2).css("left","-100%")},M=function(){T.fidx=T.fidx<0?T.fidx+3:T.fidx%3;var t=T.fidx,e=t+1,a=t-1;0>t-1&&(a=2),t+1>2&&(e=0),q.$flick.eq(a).css({left:"-100%"}),q.$flick.eq(t).css({left:"0%"}),q.$flick.eq(e).css({left:"100%"})},d=function(t,e){var a,n=Math.abs(parseFloat((e/t).toFixed(2))),o=(window.innerHeight/2/window.innerWidth).toFixed(2),r=(window.innerHeight/(window.innerWidth/2)).toFixed(2);return a=n>=o?2:r>=n?0:1},k=function(t){return q.$flickCon.css({webkitTransition:"null"}),T.touch_start_x=T.touch_x=t.originalEvent.touches[0].clientX,T.touch_start_y=T.touch_y=t.originalEvent.touches[0].clientY,!0},v=function(t){T.touch_x=t.originalEvent.touches[0].clientX,T.touch_y=t.originalEvent.touches[0].clientY,T.gap_x=T.touch_x-T.touch_start_x,T.gap_y=T.touch_y-T.touch_start_y,T.direction=T.direction||d(T.gap_x,T.gap_y),0===T.direction&&(t.preventDefault(),q.$flickCon.css({transform:"translate("+T.gap_x+"px)"})),T.state="drag"},y=function(){return Math.abs(T.gap_x)>$(window).width()/2.5?(T.gap_x<0?(q.$flickCon.css({transform:"translate(100%,0)",webkitTransition:"200ms"}),T.fidx++,C("left",T.date_info)):(q.$flickCon.css({transform:"translate(-100%,0)",webkitTransition:"200ms"}),T.fidx--,C("right",T.date_info)),M(),q.$flickCon.css({transform:"translate(0)",webkitTransition:"null"})):q.$flickCon.css({transform:"translate(0)",webkitTransition:"200ms"}),T.direction=void 0,T.gap_x=0,!0},t=function(t){console.log("shell init!");var a=localStorage.online?JSON.parse(localStorage.online):!1;$.uriAnchor.configModule({schema_map:J.anchor_schema_map}),localStorage.first=localStorage.first?JSON.parse(localStorage.first):!1,T.$container=t,e(t),a?m(event,JSON.parse(localStorage.user)):(console.log("오프라인모드로 접속합니다."),localStorage.user="anon"),I(),$(window).on("error",function(t,e,a,n,o){console.error(t),t.indexOf("Script error.")>-1||alert("Error: "+t+" Script: "+e+" Line: "+a+" Column: "+n+" StackTrace: "+o)}).on("hashchange",f).trigger("hashchange").on("orientationchange resize",function(){q.$main.css("height",$(window).height()-q.$header.height()),q.$flick.css("min-height",$(window).height()-q.$header.height())}),$.gevent.subscribe(q.$user,"login",m),$.gevent.subscribe(q.$container,"submit",N),$.gevent.subscribe(q.$main,"day",n),$.gevent.subscribe(q.$main,"week",o),$.gevent.subscribe(q.$main,"month",r),$.gevent.subscribe(q.$main,"year",i),$.gevent.subscribe(q.$modal,"cell",g),q.$user.on("click",O),q.$logout.on("click",w),q.$toggle.on("click",s),q.$search.on("click",h),q.$info.on("click",".title-year",S),q.$info.on("click",".title-month",D),q.$info.on("click",".title-week",z),q.$flickView.on("touchstart",k).on("touchmove",v).on("touchend",y)},{initModule:t}}(),zp.day=function(){"use strict";var t,e,a,n,o,r,i,d,l={settable_map:{set_cur_anchor:!0},today:{year:(new Date).getFullYear(),month:(new Date).getMonth()+1,date:(new Date).getDate()},set_cur_anchor:null,tr_h:40},c={day_list:[],update:!1},s={};return t=function(t,e){s={$container:t},s[e]={$container:t,$ddayTable:t.find(".dday-table"),$planTable:t.find(".plan-table")}},r=function(e,a){var r,c={date:parseInt(a.date,10),month:parseInt(a.month,10),year:parseInt(a.year,10)},u=a.month,p=a.date,f=a.year;10>u&&(u="0"+c.month),10>p&&(p="0"+c.date),r=String()+f+u+p,console.log(c.date,"모듈을 로딩합니다."),e.load("/html/zp.day.html",function(){console.log("모듈을 로딩했습니다."),t(e,r),n(a,r),c.date===l.today.date&&c.month===l.today.month&&c.year===l.today.year&&(i(r),setInterval(i(r),6e4)),s[r].$ddayTable.attr("data-date",r),s[r].$planTable.on("click",".todo, .plan, .dday",o),s[r].$planTable.on("click","td",a,d)})},d=function(t){var e=$(this).data("time"),a={year:t.data.year,month:t.data.month,date:t.data.date,time:e};$.gevent.publish("cell",[a])},o=function(){var t=$(this).attr("class");"whole"===t&&(t="plan"),$.gevent.publish("submit",[t])},i=function(t){var e,a,n,o=(new Date).getHours(),r=(new Date).getMinutes(),i=$(".time-indicator");n=s[t].$ddayTable.find("tr").length,a=o*l.tr_h+r*l.tr_h/60+40*n,i.length&&i.remove(),e=$("<div/>").addClass("time-indicator").css({top:a}),s[t].$container.prepend(e)},n=function(t,e){var a,n,o,r,i,d,c,u,p,f,h,m,g,y,v,k,w,b=1;if(n=("0"+t.month).slice(-2),a=("0"+t.date).slice(-2),m=t.year+"-"+n+"-"+a,d=localStorage.todo?JSON.parse(localStorage.todo):"",c=localStorage.plan?JSON.parse(localStorage.plan):"",u=localStorage.dday?JSON.parse(localStorage.dday):"",console.log(e,"일정을 삽입합니다."),u)for(b;b<u.length;b++)h=u[b],h&&h.target===m&&(y=$("<tr/>").attr("data-idx",b).append("<td/>"),y.find("td").addClass("dday").text(h.text),y.prependTo(s[e].$ddayTable));if(d)for(b=1;b<d.length;b++)p=d[b],p&&p.date===m&&(k=p.time.substr(0,2),w=p.time.substr(3,2),v=k*l.tr_h+w*l.tr_h/60+1,g=$("<div/>").addClass("todo").attr("data-idx",b),g.css({top:v}).append($("<div/>")).find("div").addClass("input").text(p.text),g.appendTo(s[e].$planTable));if(c)for(b=1;b<c.length;b++)f=c[b],f&&(o=new Date(f.startdate).getTime(),r=new Date(f.enddate).getTime(),i=new Date(m).getTime(),f.startdate===m?(k=f.starttime.substr(0,2),w=f.starttime.substr(3,2),v=k*l.tr_h+w*l.tr_h/60+1,g=$("<div/>").addClass("plan").attr("data-idx",b),g.css({top:v}).append($("<div/>")).find("div").addClass("input").text(f.text+" 시작"),g.appendTo(s[e].$planTable)):i>o&&r>i?(y=$("<tr/>").attr("data-idx",b).append("<td/>"),y.find("td").addClass("whole").text(f.text),y.prependTo(s[e].$ddayTable)):f.enddate===m&&(k=f.endtime.substr(0,2),w=f.endtime.substr(3,2),v=k*l.tr_h+w*l.tr_h/60+1,g=$("<div/>").addClass("plan").attr("data-idx",b),g.css({top:v}).append($("<div/>")).find("div").addClass("input").text(f.text+"끝"),g.appendTo(s[e].$planTable)));return!0},e=function(t){return zp.util.setConfigMap({input_map:t,settable_map:l.settable_map,config_map:l}),!0},a=function(t,e){var a=e.year+("0"+e.month).slice(-2)+("0"+e.date).slice(-2);return c.day_list[a]=new r(t,e),c.day_list},{configModule:e,initModule:a};

}(),zp.dday=function(){"use strict";var t,e,a,n,o,r,i,d,l,c,s,u,p={settable_map:{set_cur_anchor:!0},set_cur_anchor:null},f={$container:null,taphold:null},h={};return t=function(t){h={$container:t,$main:t.find(".dday-main")}},r=function(t){var e,a=new Date,n=zp.calendar.objectify(String(t)),o=new Date(n.year,n.month-1,n.date),r=o.getTime()-a.getTime();return r=Math.ceil(r/1e3/60/60/24),e=r>0?"D-"+r:0===r?"D-day":"D+"+Math.abs(r)},e=function(){var t,e,a,n,o,i,d,l,c=$(document.createDocumentFragment());return zp.model.getDday(),$.gevent.subscribe(h.$main,"getDday",function(s,u){if(s.preventDefault(),u.length){for(h.$main.html(""),l=0;l<u.length;l++)n=u[l],n&&(d=n.target,e=$("<div/>").addClass("dday-item").attr("data-idx",l),t=$("<div/>").addClass("dday-text").text(n.text),o=$("<div/>").addClass("dday-target").text(d),i=$("<div/>").addClass("dday-left").text(r(d)),a=$("<div/>").addClass("dday-del").html('<i class="fa fa-trash-o"></i>'),e.append(i).append(t).append(o).append(a),c.append(e));h.$main.append(c)}}),h.$main.html('<div style="text-align:center">기념일이나 D-day를 작성해주세요</div>'),!0},o=function(){if(!confirm("삭제하시겠습니까?"))return!1;var t=$(this).closest(".dday-item"),e=t.data("idx"),a=localStorage.change?JSON.parse(localStorage.change):{c:[],u:[],d:[]},n=JSON.parse(localStorage.dday);return delete n[e],t.remove(),localStorage.dday=JSON.stringify(n),a.d.push({cidx:e,type:"dday"}),localStorage.change=JSON.stringify(a),!0},l=function(t){return console.log("holdtap"),t.stopImmediatePropagation(),f.taphold=setTimeout(function(){"dday-text"===t.target.className?d(t.target):"dday-target"===t.target.className&&i(t.target)},1e3),!1},c=function(t){return console.log("holdstop"),t.stopPropagation(),clearTimeout(f.taphold),!1},i=function(t){var e=$(t).text();$(t).empty().append('<input type="text" value="'+e+'"/>'),$(t).find("input").focus().on("blur",{target:t,origin:e},s)},d=function(t){var e=$(t).text();$(t).empty().append('<input type="text" value="'+e+'"/>'),$(t).find("input").focus().on("blur",{target:t,origin:e},u)},s=function(t){var e,a,n,o,r=t.data,i=$(r.target),d=i.find("input").val();return r.origin===d?void i.empty().text(r.origin):(i.empty().text(d),e=JSON.parse(localStorage.change),a=JSON.parse(localStorage.dday),n=i.parent(".dday-item").data("idx"),o=d.substr(0,10),alert(n),a[n].target=o,e.u.push({cidx:n,type:"dday"}),localStorage.dday=JSON.stringify(a),void(localStorage.change=JSON.stringify(e)))},u=function(t){var e,a,n,o=t.data,r=$(o.target),i=r.find("input").val();return o.origin===i?void r.empty().text(o.origin):(r.empty().text(i),e=JSON.parse(localStorage.change),a=JSON.parse(localStorage.dday),n=r.parent(".dday-item").data("idx"),alert(n),a[n].text=i,e.u.push({cidx:n,type:"dday"}),localStorage.dday=JSON.stringify(a),void(localStorage.change=JSON.stringify(e)))},a=function(t){zp.util.setConfigMap({input_map:t,settable_map:p.settable_map,config_map:p})},n=function(a){return a.load("/html/zp.dday.html",function(){f.$container=a,t(a),e(),h.$main.on("click",".dday-del",o),h.$main.on("touchstart",".dday-target, .dday-text",l),h.$main.on("touchend",".dday-target, .dday-text",c)}),a},{configModule:a,initModule:n,calculate:r}}(),zp.modal=function(){"use strict";var t,e,a,n,o,r,i,d,l,c,s,u,p,f,h,m,g,y,v,k,w,b,_,x,S,D,z={settable_map:{set_cur_anchor:!0},set_cur_anchor:null,today:{year:(new Date).getFullYear(),month:(new Date).getMonth()+1,date:(new Date).getDate()}},M={$container:null,year:(new Date).getFullYear(),month:(new Date).getMonth()+1,date:(new Date).getDate(),hour:(new Date).getHours(),minute:(new Date).getMinutes()},N={};return t=function(t){N={$container:t,$close:t.find(".modal-close"),$login:t.find("#login-sbmt"),$todo:t.find(".todo-btn button"),$plan:t.find(".plan-btn button "),$dday:t.find(".dday-btn button "),$join:t.find(".join-btn"),$back:t.find(".modal-back"),$typeTodo:t.find("#type-todo"),$typePlan:t.find("#type-plan"),$typeDday:t.find("#type-dday"),$checkEmailBtn:t.find("#check-email-btn"),$joinSbmt:t.find("#join-sbmt"),$findpw:t.find(".findpw-btn"),$findEmailForm:t.find("#findpw-email-form"),$findEmailBtn:t.find("#findpw-email-sbmt"),$findPwForm:t.find("#findpw-qst-form"),$findPwBtn:t.find("#findpw-ans-sbmt"),$findPwResult:t.find("#findpw-result"),$offline:t.find(".offline-btn"),$repeat:t.find("#plan-input-repeat"),$repeatType:t.find('input[name="repeat-type"]'),$search:t.find("#search-btn"),$today:t.find("#search-today")}},m=function(){$(this).parent().find("output").val($(this).val()+"점")},r=function(t){zp.modal.initModule(N.$container,"todo",t.data)},i=function(t){zp.modal.initModule(N.$container,"plan",t.data)},d=function(t){zp.modal.initModule(N.$container,"dday",t.data)},v=function(){$.gevent.publish("zp-offline",[]),N.$container.hide()},n=function(){N.$container.empty().hide()},o=function(){zp.modal.initModule(N.$container,"login")},_=function(){zp.modal.initModule(N.$container,"findpw")},x=function(t){t.preventDefault();var e={email:N.$findEmailForm.find("#findpw-email").val()};return $.post("/findid",e,function(t){t?(N.$findPwForm.show(),N.$findPwForm.find("#findpw-qst").html(t.qst),N.$findPwForm.find("#findpw-email2").val(e.email),alert("아이디가 있습니다.")):alert("아이디가 없습니다.")}),!1},S=function(t){t.preventDefault();var e={email:N.$findEmailForm.find("#findpw-email").val(),ans:N.$findPwForm.find("#findpw-ans").val()};return $.post("/findpw",e,function(t){alert(JSON.stringify(t)),t?N.$findPwResult.html(t.pw):alert("답이 틀렸습니다.")}).fail(function(t){alert(t.responseText)}),!1},y=function(){zp.modal.initModule(N.$container,"join")},D=function(t){var e,a=$(t.target).prev().val();return""===a?(alert("이메일을 입력해주세요."),!1):k(a)?(e=zp.model.checkEmail(a),e.fail(function(t){return alert("이미 사용하고 있는 이메일입니다.",t),!1}),void e.done(function(t){console.log(t),alert("사용하셔도 좋습니다!"),$("#join-agree").removeAttr("disabled")})):!1},k=function(t){var e=/^[\-A-Za-z0-9_]+[\-A-Za-z0-9_.]*@[\-A-Za-z0-9_]+[\-A-Za-z0-9_.]*\.[A-Za-z]{2,5}$/,a=t.hasOwnProperty("data")?t.data.value.val():t;return t.hasOwnProperty("data")&&""===a?!1:"string"!=typeof a||""===a?(alert("이메일이 문자열이 아니거나 빈칸입니다."),!1):-1===a.search(e)?(alert("이메일 형식에 맞지 않습니다."),!1):!0},b=function(t){t.preventDefault();var e,a=$("#join-email"),n=$("#join-name"),o=$("#join-pw"),r=$("#join-pwc"),i=$("#join-qst"),d=$("#join-ans"),l=$("#join-agree"),c={_id:a.val(),pw:o.val(),name:n.val(),qst:i.val(),ans:d.val(),avatar:"z"};return a.val()?n.val()?o.val()?i.val()?d.val()?o.val()!==r.val()?(alert("비밀번호 확인이 일치하지 않습니다."),o.focus(),!1):(l.prop("disabled")&&alert("중복확인을 해주세요."),l.is(":checked")?(e=zp.model.join(c),e.done(function(t){console.log(t),alert("회원이 되신 것을 축하드립니다!")}),void e.fail(function(t){console.log(t),alert("오류가 발생했습니다. 다시 시도해주세요.")})):(alert("약관에 동의하셔야 합니다."),l.focus(),!1)):(alert("답변을 입력해주세요."),d.focus(),!1):(alert("질문을 입력해주세요."),i.focus(),!1):(alert("비밀번호를 입력해주세요."),o.focus(),!1):(alert("닉네임을 입력해주세요."),n.focus(),!1):(alert("이메일을 입력해주세요."),a.focus(),!1)},g=function(t){t.preventDefault();var e,a,n=$(this).parent().prev(),o=n.find("#login-email"),r=n.find("#login-pw"),i=o.val(),d=r.val();if(""===i.trim())alert("아이디를 입력해주십시오."),o.focus();else if(""===d.trim())return alert("비밀번호를 입력해주십시오."),r.focus(),!1;return k(i)?(e={email:i,pw:d},a=zp.model.login(e),a.done(function(t){alert("로그인 성공!"),N.$container.hide(),$.gevent.publish("login",[t]),confirm("서버의 데이터와 동기화하시겠습니까?")&&zp.model.sync(i)}),void a.fail(function(t){return alert(t),o.empty().focus(),r.empty(),!1})):(o.focus(),!1)},u=function(){$(this).next().toggle()},h=function(){var t=$(".plan-repeat-everyweek"),e=t.find("input[name=repeat-day]");"everyday"===$(this).val()?(e.prop("checked",!0),t.hide()):"everyweek"===$(this).val()&&(e.prop("checked",!1),t.show())},p=function(){var t=$(this).next(".plan-input-enddate");""===t.val()&&t.val($(this).val())},f=function(t){t.preventDefault();var e,a,n,o=$(this).prev("#search-date").val();return o?(e=o.substr(0,4),a=o.substr(5,2),n=o.substr(8,2),""===n||"00"===n?""===a||"00"===a?z.set_cur_anchor("year",e):z.set_cur_anchor("month",e+a):z.set_cur_anchor("day",e+a+n),void N.$container.empty().hide()):(alert("날짜를 입력하세요"),!0)},w=function(t){t.preventDefault();var e,a,n;a=z.today.month,n=z.today.date,10>a&&(a="0"+a),10>n&&(n="0"+n),e=String(z.today.year)+a+n,z.set_cur_anchor("day",e),N.$container.empty().hide()},l=function(t){t.preventDefault();var e,a,n=$(this).parent().prev(),o=n.find("#todo-input-date").val(),r=n.find("#todo-input-time").val(),i=n.find("#todo-input-text").val(),d=n.find("#todo-input-nodue").is(":checked");return""===o||""===r||""===i?(alert("빈칸이 있습니다."),!1):(d===!0&&(o="nodue",r="nodue"),e={_id:new Date(o+" "+r).getTime(),date:o,time:r,text:i,done:!1,type:"todo"},a=zp.model.setTodo(e),a.done(function(){N.$container.empty().hide(),console.log("successfully submit todo",a),$.gevent.publish("submit",["todo"])}),void a.fail(function(){alert("error!")}))},c=function(){var t,e,a,n,o,r,i,d=$(this).parent().prev(),l=d.find("#plan-input-startdate").val(),c=d.find("#plan-input-starttime").val(),s=d.find("#plan-input-enddate").val(),u=d.find("#plan-input-endtime").val(),p=d.find(".plan-input-text").val(),f={};return""===l||""===p?(alert("빈칸이 있습니다"),!1):(s||(n=new Date(l+" "+c),n.setHours(n.getHours()+1),o=("0"+(n.getMonth()+1)).slice(-2),r=("0"+n.getDate()).slice(-2),s=n.getFullYear()+"-"+o+"-"+r,u=n.getHours()+":"+n.getMinutes()),t={_id:new Date(l+" "+c).getTime(),startdate:l,starttime:c,enddate:s,endtime:u,text:p,type:"plan"},console.log(t),i=zp.model.setPlan(t),i.done(function(){if(d.find("#plan-input-repeat").is(":checked"))for(f={num:d.find(".plan-input-number").val(),lastdate:d.find(".plan-input-lastdate").val()},f.day=d.find('input[name="repeat-day"]:checked').map(function(){return $(this).val()}).get(),t.num=f.num,t.lastdate=f.lastdate,t.day=f.day,a=zp.plan.calculate(t),e=0;e<a.length;e++)zp.model.setPlan(a[e]);N.$container.empty().hide()}),!1)},s=function(){var t,e,a=$(this).parent().prev(),n=a.find(".dday-input-target").val(),o=a.find(".dday-input-text").val();return""===n||""===o?(alert("빈칸이 있습니다"),!1):(t={_id:new Date(n).getTime(),target:n,text:o,type:"dday"},e=zp.model.setDday(t),e.done(function(){N.$container.empty().hide(),$.gevent.publish("submit",["dday"]),console.log("dday registered",e)}),e.fail(function(t){alert("error")}),!1)},e=function(t){zp.util.setConfigMap({input_map:t,settable_map:z.settable_map,config_map:z})},a=function(e,a,z){if("string"!=typeof a)throw"initModule argument type error";return""===a&&(a="login"),e.load("/html/zp.modal.html #modal-"+a,function(){if(M.$container=e,t(e),z&&("todo"===a||"plan"===a||"dday"===a)){var O;z.month=z.month<10?"0"+z.month:z.month,z.date=z.date<10?"0"+z.date:z.date,O=z.year+"-"+z.month+"-"+z.date,z.time=4===z.time.length?"0"+z.time:z.time,"todo"===a?(e.find("#todo-input-date").val(O),e.find("#todo-input-time").val(z.time)):"plan"===a?(e.find("#plan-input-startdate").val(O),e.find("#plan-input-starttime").val(z.time)):"dday"===a&&e.find(".dday-input-target").val(O)}return $(document).on("blur","#login-email",{value:$(this).find("#login-email")},k),N.$close.on("click",n),N.$login.on("click",g),N.$repeat.on("click",u),N.$todo.on("click",z,l),N.$plan.on("click",z,c),N.$dday.on("click",z,s),N.$plan.prev().find(".plan-input-startdate").on("change",p),N.$container.find("#todo-input-score").on("input",m),N.$typeTodo.on("click",z,r),N.$typePlan.on("click",z,i),N.$typeDday.on("click",z,d),N.$join.on("click",y),N.$back.on("click",o),N.$joinSbmt.on("click",b),N.$checkEmailBtn.on("click",D),N.$findpw.on("click",_),N.$findEmailBtn.on("click",x),N.$findPwBtn.on("click",S),N.$offline.on("click",v),N.$search.on("click",f),N.$today.on("click",w),N.$repeatType.on("change",h),e}),e},{configModule:e,initModule:a}}(),zp.month=function(){var t,e,a,n,o,r,i,d,l={settable_map:{set_cur_anchor:!0},set_cur_anchor:null},c={month_list:[]},s={};return d=function(t,e){var o,d=e.month,l=e.year;t.load("/html/zp.month.html",function(){10>d&&(d="0"+d),o=String(l)+d,console.log("month",o),a(t,o),n(e.month,e.year),s[o].$month.attr("data-date",o),s[o].$month.find("td").on("click",e,r),s[o].$month.find("tbody th").on("click",e,i)})},a=function(t,e){s.$container=t,s[e]={$month:t.find(".month-calendar")}},n=function(t,e){var a,n={month:t,year:e};return t=10>t?"0"+t:t,a=String(e)+t,zp.calendar.initModule(s[a].$month,n),o(a),!0},o=function(t){var e,a,n,o,r,i,d,l,c,u,p,f,h,m,g,y,v,k,w,b,_,x,S,D,z=parseInt(t.substr(0,4),10),M=parseInt(t.substr(4,2),10);if(localStorage.plan)for(n=JSON.parse(localStorage.plan),d=1;d<n.length;d++)i=n[d],console.log(i),i&&(y=i.startdate,_=new Date(y).getTime(),v=parseInt(y.substr(5,2),10),k=y.substr(8,2),w=i.enddate,x=new Date(w).getTime(),b=parseInt(w.substr(5,2),10),S=(x-_)/1e3/60/60/24,M>=v&&b>=M&&(f=s[t].$month.find("td"),f.each(function(){if($(this).find("div").eq(0).text()===k)for(h=$(this).index(),g=$("<div/>").addClass("month-plan").text(i.text),D=$(this).parent().children(),D.eq(h).append(g.clone()),console.log(h,S,D);S>0;)h++,console.log(D.eq(h)),D.eq(h).length?D.eq(h).append(g.clone()):(h=1,D=D.parent().next().children(),D.eq(h).append(g.clone())),console.log(h,S,D),S--})));if(localStorage.dday)for(a=JSON.parse(localStorage.dday),d=1;d<a.length;d++)r=a[d],r&&(l=r.target,c=parseInt(l.substr(0,4),10),u=parseInt(l.substr(5,2),10),p=l.substr(8,2),c===z&&u===M&&(f=s[t].$month.find("td"),f.each(function(){$(this).find("div").eq(0).text()===p&&(g=$("<div/>").addClass("month-dday").text(r.text),$(this).append(g))})));if(localStorage.todo)for(e=JSON.parse(localStorage.todo),d=1;d<e.length;d++)o=e[d],o&&(m=o.date,c=parseInt(m.substr(0,4),10),u=parseInt(m.substr(5,2),10),p=m.substr(8,2),c===z&&u===M&&(f=s[t].$month.find("td"),f.each(function(){$(this).find("div").eq(0).text()===p&&(g=$("<div/>").addClass("month-todo").text(o.text),o.done?g.addClass("month-done"):new Date(m).getTime()<(new Date).getTime()&&g.addClass("month-due"),$(this).append(g))})));return console.log("plan inserted"),!0},i=function(t){var e,a=parseInt(("0"+parseInt($(this).html(),10)).slice(-2),10),n=t.data.year;return"&nbsp;"===a?!1:("0"===a&&(n=--n,a=zp.calendar.getWeekNum(31,12,n)),e={week:a,year:n},void $.gevent.publish("week",[e]))},r=function(t){var e,a=parseInt($(this).find("div").eq(0).text(),10),n=t.data.month,o=t.data.year;""!=a&&(e={date:a,month:n,year:o},$.gevent.publish("day",[e]))},t=function(t){zp.util.setConfigMap({input_map:t,settable_map:l.settable_map,config_map:l})},e=function(t,e){var a=e.year+("0"+e.month).slice(-2);return console.log("month initiated"),c.month_list[a]=new d(t,e),t},{configModule:t,initModule:e}}(),zp.plan=function(){var t,e,a,n,o,r,i,d,l,c,s,u,p,f,h={settable_map:{set_cur_anchor:!0},set_cur_anchor:null},m={$container:null,taphold:null},g={};return t=function(t){g={$container:t,$main:t.find(".plan-main")}},o=function(t){var e,a,n,o,r,i,d,l=[];if(t.num){for(e=zp.calendar.objectify(t.startdate),a=new Date(e.year,e.month-1,e.date).getDay(),n=0;n<t.day.length;n++)if(t.day[n]===a){o=a;break}for(t.day=t.day.map(function(t,e){return i=e,o=i}),t.day=t.day.map(function(e,a){var n,o;return n=t.day[e+1]||t.day[0],o=n-a,0>o&&(o=7+o),o}),r=t.num-1,n=0;r>n;n++)d=t.day[n],t.cidx++,t.startdate=zp.calendar.getNextString(t.startdate,d),t.enddate=zp.calendar.getNextString(t.enddate,d),l.push(t)}return l},n=function(){var t,e,a,n,o,r,i,d,l,c,s,u,p,f,h,m=$(document.createDocumentFragment());zp.model.getPlan(),$.gevent.subscribe(g.$main,"getPlan",function(y,v){if(y.preventDefault(),v.length){for(g.$main.html(""),r=0;r<v.length;r++)t=v[r],t&&(e=t.startdate,a=t.starttime,n=t.enddate,o=t.endtime,i=e+" "+a,d=n+" "+o,l=$("<div/>").addClass("plan-item").attr("data-idx",r),c=$("<div/>").addClass("plan-option"),s=$("<div/>").addClass("plan-del").html('<i class="fa fa-trash-o"></i>'),u=$('<div/>"').addClass("plan-alarm").html('<i class="fa fa-alarm"></i>'),p=$("<div/>").addClass("plan-text").text(t.text),f=$("<div/>").addClass("plan-start").text(i),h=$("<div/>").addClass("plan-end").text(d),c.append(s).append(u),l.append(f).append(h).append(p).append(c),m.append(l));g.$main.append(m)}}),g.$main.html('<div style="text-align:center">일정을 작성해주세요</div>')},r=function(){if(!confirm("삭제하시겠습니까?"))return!1;var t=$(this).closest(".plan-item"),e=t.data("idx"),a=localStorage.change?JSON.parse(localStorage.change):{c:[],u:[],d:[]},n=JSON.parse(localStorage.plan);return delete n[e],t.remove(),localStorage.plan=JSON.stringify(n),a.d.push({cidx:e,type:"plan"}),localStorage.change=JSON.stringify(a),!0},c=function(t){return console.log("holdtap"),t.stopImmediatePropagation(),m.taphold=setTimeout(function(){"plan-text"===t.target.className?l(t.target):"plan-start"===t.target.className?i(t.target):"plan-end"===t.target.className&&d(t.target)},1e3),!1},s=function(t){return console.log("holdstop"),t.stopPropagation(),clearTimeout(m.taphold),!1},i=function(t){var e=$(t).text();$(t).empty().append('<input type="text" value="'+e+'"/>'),$(t).find("input").focus().on("blur",{target:t,origin:e},u)},d=function(t){var e=$(t).text();$(t).empty().append('<input type="text" value="'+e+'"/>'),$(t).find("input").focus().on("blur",{target:t,origin:e},p)},l=function(t){var e=$(t).text();$(t).empty().append('<input type="text" value="'+e+'"/>'),$(t).find("input").focus().on("blur",{target:t,origin:e},f)},u=function(t){var e,a,n,o,r,i=t.data,d=$(i.target),l=d.find("input").val();return i.origin===l?void d.empty().text(i.origin):(d.empty().text(l),e=JSON.parse(localStorage.change),a=JSON.parse(localStorage.plan),n=d.parent(".plan-item").data("idx"),o=l.substr(0,10),r=l.substr(11,8),alert(n),a[n].startdate=o,a[n].starttime=r,e.u.push({cidx:n,type:"plan"}),localStorage.plan=JSON.stringify(a),void(localStorage.change=JSON.stringify(e)))},p=function(t){var e,a,n,o,r,i=t.data,d=$(i.target),l=d.find("input").val();return i.origin===l?void d.empty().text(i.origin):(d.empty().text(l),e=JSON.parse(localStorage.change),a=JSON.parse(localStorage.plan),n=d.parent(".plan-item").data("idx"),o=l.substr(0,10),r=l.substr(11,8),alert(n),a[n].enddate=o,a[n].endtime=r,e.u.push({cidx:n,type:"plan"}),localStorage.plan=JSON.stringify(a),void(localStorage.change=JSON.stringify(e)))},f=function(t){var e,a,n,o=t.data,r=$(o.target),i=r.find("input").val();return o.origin===i?void r.empty().text(o.origin):(r.empty().text(i),e=JSON.parse(localStorage.change),a=JSON.parse(localStorage.plan),n=r.parent(".todo-item").data("idx"),alert(n),a[n].text=i,e.u.push({cidx:n,type:"plan"}),localStorage.plan=JSON.stringify(a),void(localStorage.change=JSON.stringify(e)))},e=function(t){zp.util.setConfigMap({input_map:t,settable_map:h.settable_map,config_map:h})},a=function(e){e.load("/html/zp.plan.html",function(){m.$container=e,t(e),n(),g.$main.on("click",".plan-del",r),g.$main.on("touchstart",".plan-text, .plan-start, .plan-end",c),g.$main.on("touchend",".plan-text, .plan-start, .plan-end",s)})},{configModule:e,initModule:a,calculate:o}}(),zp.todo=function(){"use strict";var t,e,a,n,o,r,i,d,l,c,s,u,p,f,h={settable_map:{set_cur_anchor:!0},set_cur_anchor:null},m={$container:null},g={};return t=function(t){g={$container:t,$main:t.find(".todo-main")}},e=function(){var t,e,a,n,o,r,i,d,l,c,s,u,p,f,h=$(document.createDocumentFragment());return f=zp.model.getTodo(),f.done(function(f,m){if(f.preventDefault(),console.log(m),m.length){for(g.$main.html(""),p=0;p<m.length;p++)l=m[p],console.log(l),l&&(s=l.date,u=l.time,d=l.done,c=s+" "+u,n=$("<div/>").addClass("todo-item").attr("data-idx",p),a=$("<div/>").addClass("todo-done").append('<input type="checkbox" size="3">'),i=$("<div/>").addClass("todo-option"),o=$("<div/>").addClass("todo-del").html('<i class="fa fa-trash-o"></i>'),r=$("<div/>").addClass("todo-alarm").html('<i class="fa fa-bell-o"></i>'),e=$("<div/>").addClass("todo-text").text(l.text),t=$("<div/>").addClass("todo-due").text(c),new Date(c).getTime()<(new Date).getTime()&&e.addClass("item-due"),d&&(a.find("input").prop("checked",!0),e.addClass("item-done")),i.append(o).append(r),n.append(a).append(e).append(i).append(t),h.append(n));g.$main.append(h)}}),f.fail(function(t){alert(t)}),g.$main.html('<div style="text-align:center">할일을 작성해주세요</div>'),!0},o=function(){var t=$(this).parent().next(),e=JSON.parse(localStorage.todo),a=$(this).closest(".todo-item").data("idx"),n=localStorage.change?JSON.parse(localStorage.change):{c:[],u:[],d:[]};return $(this).is(":checked")?($(this).prop("checked",!0),t.addClass("item-done"),e[a].done=!0):($(this).prop("checked",!1),t.removeClass("item-done"),e[a].done=!1),n.u.push({cidx:a,type:"todo"}),localStorage.todo=JSON.stringify(e),localStorage.change=JSON.stringify(n),!0},r=function(){if(!confirm("삭제하시겠습니까?"))return!1;var t=$(this).closest(".todo-item"),e=t.data("idx"),a=localStorage.change?JSON.parse(localStorage.change):{c:[],u:[],d:[]},n=JSON.parse(localStorage.todo);return delete n[e],t.remove(),localStorage.todo=JSON.stringify(n),a.d.push({cidx:e,type:"todo"}),localStorage.change=JSON.stringify(a),!0},f=function(){var t,e,a={Android:/Android/,iOS:/like Mac OS X/};for(e in a)a.hasOwnProperty(e)&&a[e].test(navigator.userAgent)&&(t=e);return"Android"===t||"iOS"===t},i=function(){return f()?(alert("준비중입니다"),!1):(alert("모바일에서만 가능한 기능입니다"),!1)},c=function(t){return console.log("holdtap"),t.stopImmediatePropagation(),m.taphold=setTimeout(function(){"todo-text"===t.target.className?l(t.target):"todo-due"===t.target.className&&d(t.target)},1e3),!1},s=function(t){return console.log("holdstop"),t.stopPropagation(),clearTimeout(m.taphold),!1},d=function(t){var e=$(t).text();$(t).empty().append('<input type="text" value="'+e+'"/>'),$(t).find("input").focus().on("blur",{target:t,origin:e},u)},l=function(t){var e=$(t).text();$(t).empty().append('<input type="text" value="'+e+'"/>'),$(t).find("input").focus().on("blur",{target:t,origin:e},p)},u=function(t){var e,a,n,o,r,i=t.data,d=$(i.target),l=d.find("input").val();return i.origin===l?void d.empty().text(i.origin):(d.empty().text(l),e=JSON.parse(localStorage.change),a=JSON.parse(localStorage.todo),n=d.parent(".todo-item").data("idx"),o=l.substr(0,10),r=l.substr(11,8),alert(n),a[n].date=o,a[n].time=r,e.u.push({cidx:n,type:"todo"}),localStorage.todo=JSON.stringify(a),void(localStorage.change=JSON.stringify(e)))},p=function(t){var e,a,n,o=t.data,r=$(o.target),i=r.find("input").val();return o.origin===i?void r.empty().text(o.origin):(r.empty().text(i),e=JSON.parse(localStorage.change),a=JSON.parse(localStorage.todo),n=r.parent(".todo-item").data("idx"),alert(n),a[n].text=i,e.u.push({cidx:n,type:"todo"}),localStorage.todo=JSON.stringify(a),void(localStorage.change=JSON.stringify(e)))},a=function(t){zp.util.setConfigMap({input_map:t,settable_map:h.settable_map,config_map:h})},n=function(a){return a.load("/html/zp.todo.html",function(){m.$container=a,t(a),e(),g.$main.on("click","input[type=checkbox]",o),g.$main.on("click",".todo-del",r),g.$main.on("click",".todo-alarm",i),g.$main.on("touchstart",".todo-text, .todo-due",c),g.$main.on("touchend",".todo-text, .todo-due",s)}),a},{configModule:a,initModule:n}}(),zp.week=function(){var t,e,a,n,o,r,i,d={settable_map:{set_cur_anchor:!0},set_cur_anchor:null,tr_h:30},l={week_list:[]},c={};return i=function(t,e){var o,i=e.week,d=e.year;t.load("/html/zp.week.html",function(){o=d+("0"+i).slice(-2),console.log("week",o),a(t,o),n(i,d),c[o].$week.attr("data-week",o),c[o].$thead.on("click",e,r)})},a=function(t,e){c.$container=t,c[e]={$week:t.find(".week-table"),$thead:t.find("thead th"),$info:t.find(".week-info")}},n=function(t,e){var a,n=e+("0"+t).slice(-2),r=zp.calendar.getWeekDay(t,e),i=0;for(i;7>i;i++)a=r[i].month+"."+r[i].date,c[n].$thead.eq(i).text(a);return o(n),!0},o=function(t){var e,a,n,o,r,i,l,s,u,p,f,h,m,g,y=parseInt(t.substr(0,4),10),v=parseInt(t.substr(4,2),10),k=zp.calendar.getWeekDay(v,y),w=localStorage.todo?JSON.parse(localStorage.todo):"",b=localStorage.plan?JSON.parse(localStorage.plan):"",_=localStorage.dday?JSON.parse(localStorage.dday):"";if(console.log(t,"일정을 삽입합니다."),_)for(i=1;i<_.length;i++)if(a=_[i])for(l=0;7>l;l++)s=("0"+k[l].month).slice(-2),u=("0"+k[l].date).slice(-2),o=y+"-"+s+"-"+u,a.target===o&&(g=c[t].$info.children().eq(l),m=$("<div/>").addClass("week-dday").text(a.text).appendTo(g));if(w)for(i=1;i<w.length;i++)if(e=w[i])for(l=0;7>l;l++)s=("0"+k[l].month).slice(-2),u=("0"+k[l].date).slice(-2),o=y+"-"+s+"-"+u,e.date===o&&(f=e.time.substr(0,2),h=e.time.substr(3,2),r=f*d.tr_h+h*d.tr_h/60+61,console.log("top",r),m=$("<div/>").addClass("week-todo").attr("data-idx",i),e.done?m.addClass("week-done"):new Date(e.date).getTime()<(new Date).getTime()&&m.addClass("week-due"),p=14.285714*l+"%",m.css({top:r,left:p}).append($("<div/>")).find("div").addClass("input").text(e.text),m.appendTo(c[t].$week));if(b){var x,S,D,z,M,N,O;for(i=1;i<b.length;i++)if(n=b[i])for(l=0;7>l;l++)s=("0"+k[l].month).slice(-2),u=("0"+k[l].date).slice(-2),o=y+"-"+s+"-"+u,x=new Date(n.startdate).getTime(),S=new Date(n.enddate).getTime(),D=new Date(o),D>=x&&S>=D&&(x===D?(f=n.starttime.substr(0,2),h=n.starttime.substr(3,2),r=f*d.tr_h+h*d.tr_h/60+61,D===S?(M=n.endtime.substr(0,2),N=n.endtime.substr(3,2),O=M*d.tr_h+N*d.tr_h/60+61,z=O-r):z=24*d.tr_h-r,m=$("<div/>").addClass("week-plan").attr("data-idx",i),p=14.285714*l+"%",m.css({top:r,left:p,height:z}).append($("<div/>")).find("div").addClass("input").text(n.text),m.appendTo(c[t].$week)):D>x&&S>D?(g=c[t].$info.children().eq(l),m=$("<div/>").addClass("week-whole").text(n.text).appendTo(g)):D===S&&(f=n.endtime.substr(0,2),h=n.endtime.substr(3,2),r=0,p=14.285714*l+"%",z=f*d.tr_h+h*d.tr_h/60+61,m=$("<div/>").addClass("week-plan").attr("data-idx",i),m.css({top:r,left:p,height:z}).append($("<div/>")).find("div").addClass("input").text(n.text),m.appendTo(c[t].$week)))}return console.log("plan inserted"),!0},r=function(t){var e,a=$(this).text(),n=parseInt(a.split(".")[1],10),o=parseInt(a.split(".")[0],10),r=t.data.year;""!=n&&(e={date:n,month:o,year:r},$.gevent.publish("day",[e]))},t=function(t){zp.util.setConfigMap({input_map:t,settable_map:d.settable_map,config_map:d})},e=function(t,e){var a=e.year+("0"+e.week).slice(-2);return console.log("month initiated"),l.week_list[a]=new i(t,e),l.week_list},{configModule:t,initModule:e}}(),zp.year=function(){"use strict";var t,e,a,n,o,r,i={settable_map:{set_cur_anchor:!0},set_cur_anchor:null},d={$container:null,year_list:[]},l={};return r=function(t,a){t.load("/html/zp.year.html",function(){console.log(a.year),e(t,a.year),n(a.year),l[a.year].$calendar.on("click",a,o)})},n=function(t){var e,a=0,n={year:t};for(a;12>a;a++)e=l[t].$calendar.eq(a),n.month=parseInt(e.data("month"),10),zp.calendar.initModule(e,n)},e=function(t,e){l.$container=t,l[e]={$calendar:t.find(".year-calendar")}},o=function(t){var e=$(this).data("month"),a=t.data.year,n={month:e,year:a};$.gevent.publish("month",[n])},a=function(t){zp.util.setConfigMap({input_map:t,settable_map:i.settable_map,config_map:i})},t=function(t,e){e.year=parseInt(e.year,10),d.$container=t,d.year_list[e.year]=new r(t,e)},{configModule:a,initModule:t}}();
=======
var zp=function(){"use strict";var t=function(t){zp.model.initModule(),zp.shell.initModule(t)};return{initModule:t}}();zp.model=function(){"use strict";var t,e,a,n,o,r,i,d,l,c,s,u,p,f,h={anon_idx:0},m={anon_user:null,db:new PouchDB("anon")};return i=function(t){var e=new PouchDB("http://zerohch0.iriscouch.com/members"),a=$.Deferred();return e.get(t).then(function(t){console.log(t),a.reject(t)})["catch"](function(t){console.log(t),a.resolve(t)}),a.promise()},r=function(t){var e=new PouchDB("http://zerohch0.iriscouch.com/members"),a=$.Deferred();return e.put(t).then(function(t){console.log(t),a.resolve(t)})["catch"](function(t){console.log(t),a.reject(t)}),a.promise()},o=function(t){var e=$.Deferred(),a=new PouchDB("http://zerohch0.iriscouch.com/members");return a.get(t.email,{include_docs:!0}).then(function(a){console.log(a),a.pw===t.pw?e.resolve(a):e.reject("비밀번호가 틀립니다.")})["catch"](function(t){console.log(t),e.reject("아이디가 존재하지 않습니다.")}),e.promise()},d=function(t){var e=new PouchDB("anon"),a=$.Deferred();return e=new PouchDB("anon"===localStorage.user?"anon":"user"),e.put(t).then(function(t){return a.resolve(t),!0})["catch"](function(t){return console.log(t),a.reject(t),!1}),a.promise()},c=function(){var t,e,a=[],n=0,o=$.Deferred(),r=new PouchDB("anon");return r.allDocs({include_docs:!0}).then(function(r){for(console.log(r),t=r.rows,e=t.length,n;e>n;n++)console.log(t[n]),a.push(t[n].doc);o.resolve(a)})["catch"](function(t){console.log("todo",t),o.reject(t)}),o.promise()},l=function(t){var e=new PouchDB("anon"),a=$.Deferred();return e.put(t).then(function(t){return $.gevent.publish("submit",["plan"]),console.log("plan registered",t),!0})["catch"](function(t){return console.log(t),alert("error!"),!1}),a.promise()},s=function(){var t,e,a=[],n=0,o=$.Deferred();return h.plans.allDocs({include_docs:!0,attachments:!0}).then(function(o){for(console.log(o),t=o.rows,e=t.length,n;e>n;n++)console.log(t[n]),a.push(t[n].doc);$.gevent.publish("getPlan",[a])})["catch"](function(t){console.log("plan",t)}),o.promise()},e=function(t){var e=new PouchDB("anon"),a=$.Deferred();return e.put(t).then(function(t){return a.resolve(t),!0})["catch"](function(t){return a.reject(t),!1}),a.promise()},a=function(){var t,e,a=[],n=0,o=$.Deferred(),r=new PouchDB("anon");return r.allDocs({include_docs:!0}).then(function(o){for(console.log(o),t=o.rows,e=t.length,n;e>n;n++)console.log(t[n]),a.push(t[n].doc);$.gevent.publish("getDday",[a])})["catch"](function(t){console.log("dday",t)}),o.promise()},u=function(){return!0},n=function(t){var e=$.Deferred(),a=new PouchDB("anon");return a.replicate.to("http://zerohch0.iriscouch.com/"+t,{live:!0},function(t){console.log(t)}),a.replicate.from("http://zerohch0.iriscouch.com/"+t,{live:!0},function(t){console.log(t)}),e.promise()},p=function(t){var e=$.Deferred(),a=new PouchDB("anon");return a.replicate.to("http://zerohch0.iriscouch.com/"+t,{live:!0},function(t){t?(console.log(t),e.reject(t)):e.resolve()}),e.promise()},f=function(t){var e=$.Deferred(),a=new PouchDB("anon");return a.replicate.from("http://zerohch0.iriscouch.com/"+t,{live:!0},function(t){t?(console.log(t),e.reject(t)):e.resolve()}),e.promise()},t=function(){return"false"===localStorage.online&&(m.anon_user=!0),!0},{initModule:t,login:o,setTodo:d,getTodo:c,setPlan:l,getPlan:s,getInfo:u,setDday:e,getDday:a,sync:n,join:r,checkEmail:i,upload:p,download:f}}(),zp.util=function(){var t,e;return t=function(t,e,a){var n=new Error;return n.name=t,n.message=e,a&&(n.data=a),n},e=function(e){var a,n,o=e.input_map,r=e.settable_map,i=e.config_map;for(a in o)if(o.hasOwnProperty(a)){if(!r.hasOwnProperty(a))throw n=t("Bad Input","Setting config key |"+a+"| is not supported");i[a]=o[a]}},{makeError:t,setConfigMap:e}}(),zp.util_b=function(){"use strict";var t,e,a,n={regex_encode_html:/[&"'><]/g,regex_encode_noamp:/["'><]/g,html_encode_map:{"&":"&#38;",'"':"&#34;","'":"&#39;",">":"&#62;","<":"&#60;"}};return n.encode_noamp_map=$.extend({},n.html_encode_map),delete n.encode_noamp_map["&"],t=function(t){return $("<div/>").html(t||"").text()},e=function(t,e){var a,o,r=String(t);return e?(o=n.encode_noamp_map,a=n.regex_encode_noamp):(o=n.html_encode_map,a=n.regex_encode_html),r.replace(a,function(t){return o[t]||""})},a=function(t){return Number(getComputedStyle(t,"").fontSize.match(/\d*\.?\d*/)[0])},{decodeHtml:t,encodeHtml:e,getEmSize:a}}(),zp.calendar=function(){"use strict";var t,e,a,n,o,r,i,d,l,c,s,u,p,f,h,m,g={main_html:String()+'<table class="calendar-table"><caption class="calendar-caption"></caption><thead><tr><th>주</th><th>일</th><th>월</th><th>화</th><th>수</th><th>목</th><th>금</th><th>토</th></tr></thead><tbody><tr><th></th><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><th></th><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><th></th><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><th></th><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><th></th><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr><tr><th></th><td></td><td></td><td></td><td></td><td></td><td></td><td></td></tr></tbody></table>',day_list:["일","월","화","수","목","금","토"]},y={$container:null},v={};return e=function(t){var e=0;for(v={$container:t,$table:t.find("table"),$caption:t.find("caption")},e;6>=e;e++)v["$tr"+e]=t.find("tr:eq("+e+")")},t=function(t,a){var o=a.month,r=a.year;y.$container=t,t.html(g.main_html),e(t),n(o,r)},n=function(t,e){t=parseInt(t,10),e=parseInt(e,10);var n,r,i,d,l,c=new Date,s=1,u=2,p=new Date;for(c.setYear(e),c.setMonth(t-1),c.setDate(1),n=c.getDay(),c.setMonth(t),c.setDate(c.getDate()-1),r=c.getDate(),v.$caption.html(t+"월"),d=o(s,t,e),i=n;7>i;i++)v.$tr1.find("th").html(d+"주"),v.$tr1.find("td").eq(i).append("<div>"+s+"</div>"),s++;for(d++;r-7>=s;){for(i=0;7>i;i++)v["$tr"+String(u)].find("th").html(d+"주"),v["$tr"+String(u)].find("td").eq(i).append("<div>"+s+"</div>"),s++;u++,d++}for(i=0;r>=s;i++)v["$tr"+String(u)].find("th").html(d+"주"),v["$tr"+String(u)].find("td").eq(i).append("<div>"+s+"</div>"),s++;switch(u){case 4:v.$tr5.addClass("hidden"),v.$tr6.addClass("hidden");break;case 5:v.$tr6.addClass("hidden")}e===p.getFullYear()&&t===p.getMonth()+1&&(l=v.$table.find("td"),l.each(function(){parseInt($(this).find("div").eq(0).html(),10)===p.getDate()&&$(this).addClass("td-today")})),a(t,e)},a=function(t,e){var a,n=v.$table.find("td"),o=s(e+"0101","ltos"),r=s(e+"0408","ltos"),i=s(e+"0815","ltos");switch(t===o.month?n.each(function(){a=parseInt($(this).text(),10),(a===o.day||a===o.day-1||a===o.day+1)&&$(this).css("color","red")}):t===r.month?n.each(function(){a=parseInt($(this).text(),10),a===r.day&&$(this).css("color","red")}):t===i.month&&n.each(function(){a=parseInt($(this).text(),10),(a===i.day||a===i.day-1||a===i.day+1)&&$(this).css("color","red")}),t){case 1:n.each(function(){1===parseInt($(this).text(),10)&&$(this).css("color","red")});break;case 3:n.each(function(){1===parseInt($(this).text(),10)&&$(this).css("color","red")});break;case 5:n.each(function(){5===parseInt($(this).text(),10)&&$(this).css("color","red")});break;case 6:n.each(function(){6===parseInt($(this).text(),10)&&$(this).css("color","red")});break;case 8:n.each(function(){15===parseInt($(this).text(),10)&&$(this).css("color","red")});break;case 10:n.each(function(){(3===parseInt($(this).text(),10)||9===parseInt($(this).text(),10))&&$(this).css("color","red")});break;case 12:n.each(function(){25===parseInt($(this).text(),10)&&$(this).css("color","red")})}return!0},s=function(t,e){if("ltos"!==e&&"stol"!==e)return!1;var a,n,o,i,d,l,c,s,u,p,f,h,m,g,$,y,v,k,w,b,_,x,S,D,z=[[1,2,4,1,1,2,1,2,1,2,2,1],[2,2,1,2,1,1,2,1,2,1,2,1],[2,2,2,1,2,1,4,1,2,1,2,1],[2,2,1,2,1,2,1,2,1,2,1,2],[1,2,1,2,2,1,2,1,2,1,2,1],[2,1,2,1,5,2,1,2,2,1,2,1],[2,1,1,2,1,2,1,2,2,2,1,2],[1,2,1,1,2,1,2,1,2,2,2,1],[2,1,2,3,2,1,2,1,2,1,2,2],[2,1,2,1,1,2,1,1,2,2,1,2],[2,2,1,2,1,1,2,1,2,1,5,2],[2,1,2,2,1,1,2,1,2,1,1,2],[2,1,2,2,1,2,1,2,1,2,1,2],[1,2,1,2,1,2,5,2,1,2,1,2],[1,1,2,1,2,2,1,2,2,1,2,1],[2,1,1,2,1,2,1,2,2,2,1,2],[1,2,1,1,5,2,1,2,1,2,2,2],[1,2,1,1,2,1,1,2,2,1,2,2],[2,1,2,1,1,2,1,1,2,1,2,2],[2,1,6,1,1,2,1,1,2,1,2,2],[1,2,2,1,2,1,2,1,2,1,1,2],[2,1,2,1,2,2,1,2,2,3,1,2],[1,2,2,1,2,1,2,2,1,2,1,2],[1,1,2,1,2,1,2,2,1,2,2,1],[2,1,1,2,4,1,2,2,1,2,2,1],[2,1,1,2,1,1,2,2,1,2,2,2],[1,2,1,1,2,1,1,2,1,2,2,2],[1,2,2,3,2,1,1,2,1,2,2,1],[2,2,2,1,1,2,1,1,2,1,2,1],[2,2,2,1,2,1,2,1,1,5,2,1],[2,2,1,2,2,1,2,1,2,1,1,2],[1,2,1,2,2,1,2,1,2,2,1,2],[1,1,2,1,2,4,2,1,2,2,1,2],[1,1,2,1,2,1,2,1,2,2,2,1],[2,1,1,2,1,1,2,1,2,2,2,1],[2,2,1,1,5,1,2,1,2,2,1,2],[2,2,1,1,2,1,1,2,1,2,1,2],[2,2,1,2,1,2,1,1,2,1,2,1],[2,2,4,2,1,2,1,1,2,1,2,1],[2,1,2,2,1,2,2,1,2,1,1,2],[1,2,1,2,1,2,5,2,2,1,2,1],[1,2,1,2,1,2,1,2,2,1,2,2],[1,1,2,1,1,2,1,2,2,2,1,2],[2,1,1,2,3,2,1,2,2,1,2,2],[2,1,1,2,1,1,2,1,2,1,2,2],[2,1,2,1,2,1,1,2,1,2,1,2],[2,2,1,5,2,1,1,2,1,2,1,2],[2,1,2,2,1,2,1,1,2,1,2,1],[2,1,2,2,1,2,1,2,1,2,1,2],[1,5,2,1,2,2,1,2,1,2,1,2],[1,2,1,2,1,2,1,2,2,1,2,2],[1,1,2,1,1,5,2,2,1,2,2,2],[1,1,2,1,1,2,1,2,1,2,2,2],[1,2,1,2,1,1,2,1,2,1,2,2],[2,1,2,1,5,1,2,1,2,1,2,1],[2,2,2,1,2,1,1,2,1,2,1,2],[1,2,2,1,2,1,2,1,2,1,2,1],[2,1,5,2,2,1,2,1,2,1,2,1],[2,1,2,1,2,1,2,2,1,2,1,2],[1,2,1,1,2,1,2,5,2,2,1,2],[1,2,1,1,2,1,2,1,2,2,2,1],[2,1,2,1,1,2,1,2,1,2,2,2],[1,2,1,2,3,2,1,1,2,2,1,2],[2,2,1,2,1,1,2,1,1,2,2,1],[2,2,1,2,2,1,1,2,1,2,1,2],[1,2,2,4,1,2,1,2,1,2,1,2],[1,2,1,2,1,2,2,1,2,1,2,1],[2,1,1,2,2,1,2,1,2,2,1,2],[1,5,1,2,1,2,1,2,2,2,1,2],[1,2,1,1,2,1,2,1,2,2,2,1],[2,1,2,1,1,5,1,2,2,1,2,2],[2,1,2,1,1,2,1,1,2,2,1,2],[2,2,1,2,1,1,2,1,1,2,1,2],[2,2,1,2,5,1,2,1,2,1,1,2],[2,1,2,2,1,2,1,2,1,2,1,2],[1,2,1,2,1,2,2,1,2,1,2,1],[2,3,2,1,2,2,1,2,2,1,2,1],[2,1,1,2,1,2,1,2,2,2,1,2],[1,2,1,1,2,1,5,2,2,1,2,2],[1,2,1,1,2,1,1,2,2,1,2,2],[2,1,2,1,1,2,1,1,2,1,2,2],[2,1,2,2,3,2,1,1,2,1,2,2],[1,2,2,1,2,1,2,1,2,1,1,2],[2,1,2,1,2,2,1,2,1,2,1,1],[2,1,2,5,2,1,2,2,1,2,1,2],[1,1,2,1,2,1,2,2,1,2,2,1],[2,1,1,2,1,2,1,2,2,1,2,2],[1,5,1,2,1,1,2,2,1,2,2,2],[1,2,1,1,2,1,1,2,1,2,2,2],[1,2,2,1,1,5,1,2,1,2,2,1],[2,2,2,1,1,2,1,1,2,1,2,1],[2,2,2,1,2,1,2,1,1,2,1,2],[1,2,2,1,6,1,2,1,2,1,1,2],[1,2,1,2,2,1,2,2,1,2,1,2],[1,1,2,1,2,1,2,2,1,2,2,1],[2,1,4,1,2,1,2,1,2,2,2,1],[2,1,1,2,1,1,2,1,2,2,2,1],[2,2,1,1,2,1,4,1,2,2,1,2],[2,2,1,1,2,1,1,2,1,2,1,2],[2,2,1,2,1,2,1,1,2,1,2,1],[2,2,1,2,2,4,1,1,2,1,2,1],[2,1,2,2,1,2,2,1,2,1,1,2],[1,2,1,2,1,2,2,1,2,2,1,2],[1,1,2,4,1,2,1,2,2,1,2,2],[1,1,2,1,1,2,1,2,2,2,1,2],[2,1,1,2,1,1,2,1,2,2,1,2],[2,5,1,2,1,1,2,1,2,1,2,2],[2,1,2,1,2,1,1,2,1,2,1,2],[2,2,1,2,1,2,3,2,1,2,1,2],[2,1,2,2,1,2,1,1,2,1,2,1],[2,1,2,2,1,2,1,2,1,2,1,2],[1,2,1,2,4,2,1,2,1,2,1,2],[1,2,1,1,2,2,1,2,2,1,2,2],[1,1,2,1,1,2,1,2,2,1,2,2],[2,1,4,1,1,2,1,2,1,2,2,2],[1,2,1,2,1,1,2,1,2,1,2,2],[2,1,2,1,2,1,1,5,2,1,2,2],[1,2,2,1,2,1,1,2,1,2,1,2],[1,2,2,1,2,1,2,1,2,1,2,1],[2,1,2,1,2,5,2,1,2,1,2,1],[2,1,2,1,2,1,2,2,1,2,1,2],[1,2,1,1,2,1,2,2,1,2,2,1],[2,1,2,3,2,1,2,1,2,2,2,1],[2,1,2,1,1,2,1,2,1,2,2,2],[1,2,1,2,1,1,2,1,1,2,2,1],[2,2,5,2,1,1,2,1,1,2,2,1],[2,2,1,2,2,1,1,2,1,2,1,2],[1,2,2,1,2,1,5,2,1,2,1,2],[1,2,1,2,1,2,2,1,2,1,2,1],[2,1,1,2,2,1,2,1,2,2,1,2],[1,2,1,1,5,2,1,2,2,2,1,2],[1,2,1,1,2,1,2,1,2,2,2,1],[2,1,2,1,1,2,1,1,2,2,2,1],[2,2,1,5,1,2,1,1,2,2,1,2],[2,2,1,2,1,1,2,1,1,2,1,2],[2,2,1,2,1,2,1,5,2,1,1,2],[2,1,2,2,1,2,1,2,1,2,1,1],[2,2,1,2,1,2,2,1,2,1,2,1],[2,1,1,2,1,6,1,2,2,1,2,1],[2,1,1,2,1,2,1,2,2,1,2,2],[1,2,1,1,2,1,1,2,2,1,2,2],[2,1,2,3,2,1,1,2,2,1,2,2],[2,1,2,1,1,2,1,1,2,1,2,2],[2,1,2,2,1,1,2,1,1,5,2,2],[1,2,2,1,2,1,2,1,1,2,1,2],[1,2,2,1,2,2,1,2,1,2,1,1],[2,1,2,2,1,5,2,2,1,2,1,2],[1,1,2,1,2,1,2,2,1,2,2,1],[2,1,1,2,1,2,1,2,2,1,2,2],[1,2,1,1,5,1,2,1,2,2,2,2],[1,2,1,1,2,1,1,2,1,2,2,2],[1,2,2,1,1,2,1,1,2,1,2,2],[1,2,5,2,1,2,1,1,2,1,2,1],[2,2,2,1,2,1,2,1,1,2,1,2],[1,2,2,1,2,2,1,5,2,1,1,2],[1,2,1,2,2,1,2,1,2,2,1,2],[1,1,2,1,2,1,2,2,1,2,2,1],[2,1,1,2,3,2,2,1,2,2,2,1],[2,1,1,2,1,1,2,1,2,2,2,1],[2,2,1,1,2,1,1,2,1,2,2,1],[2,2,2,3,2,1,1,2,1,2,1,2],[2,2,1,2,1,2,1,1,2,1,2,1],[2,2,1,2,2,1,2,1,1,2,1,2],[1,5,2,2,1,2,1,2,2,1,1,2],[1,2,1,2,1,2,2,1,2,2,1,2],[1,1,2,1,2,1,5,2,2,1,2,2],[1,1,2,1,1,2,1,2,2,2,1,2],[2,1,1,2,1,1,2,1,2,2,1,2],[2,2,1,1,5,1,2,1,2,1,2,2],[2,1,2,1,2,1,1,2,1,2,1,2],[2,1,2,2,1,2,1,1,2,1,2,1],[2,1,6,2,1,2,1,1,2,1,2,1],[2,1,2,2,1,2,1,2,1,2,1,2],[1,2,1,2,1,2,1,2,5,2,1,2],[1,2,1,1,2,1,2,2,2,1,2,2],[1,1,2,1,1,2,1,2,2,1,2,2],[2,1,1,2,3,2,1,2,1,2,2,2],[1,2,1,2,1,1,2,1,2,1,2,2],[2,1,2,1,2,1,1,2,1,2,1,2],[2,1,2,5,2,1,1,2,1,2,1,2],[1,2,2,1,2,1,2,1,2,1,2,1],[2,1,2,1,2,2,1,2,1,2,1,2],[1,5,2,1,2,1,2,2,1,2,1,2],[1,2,1,1,2,1,2,2,1,2,2,1],[2,1,2,1,1,5,2,1,2,2,2,1],[2,1,2,1,1,2,1,2,1,2,2,2],[1,2,1,2,1,1,2,1,1,2,2,2],[1,2,2,1,5,1,2,1,1,2,2,1],[2,2,1,2,2,1,1,2,1,1,2,2],[1,2,1,2,2,1,2,1,2,1,2,1],[2,1,5,2,1,2,2,1,2,1,2,1],[2,1,1,2,1,2,2,1,2,2,1,2],[1,2,1,1,2,1,5,2,2,2,1,2],[1,2,1,1,2,1,2,1,2,2,2,1],[2,1,2,1,1,2,1,1,2,2,1,2],[2,2,1,2,1,4,1,1,2,1,2,2],[2,2,1,2,1,1,2,1,1,2,1,2],[2,2,1,2,1,2,1,2,1,1,2,1],[2,2,1,2,5,2,1,2,1,2,1,1],[2,1,2,2,1,2,2,1,2,1,2,1],[2,1,1,2,1,2,2,1,2,2,1,2],[1,5,1,2,1,2,1,2,2,2,1,2],[1,2,1,1,2,1,1,2,2,1,2,2]],M=[31,0,31,30,31,30,31,31,30,31,30,31],N=t.substring(0,4),O=t.substring(4,6),C=t.substring(6,8),I=[203];if("stol"===e){for(S=672069.2,w=N,_=O,M[1]=r(2,w),x=C||M[_-1],b=w-1,D=365*b+b/4-b/100+b/400+parseInt(x,10),m=0;_-1>m;m++)D+=M[m];for($=D-S+1,m=0;w-1841>=m;m++)for(I[m]=0,g=0;12>g;g++){switch(z[m][g]){case 1:s=29;break;case 2:s=30;break;case 3:s=58;break;case 4:s=59;break;case 5:s=59;break;case 6:s=60}I[m]=I[m]+s}for(y=0;;){if(!($>I[y]))break;$-=I[y],y+=1}for(v=0;;)if(z[y][v]<=2){if(s=z[y][v]+28,!($>s))break;$-=s,v+=1}else{switch(z[y][v]){case 3:f=29,h=29;break;case 4:f=29,h=30;break;case 5:f=30,h=29;break;case 6:f=30,h=30}if(!($>f))break;if($-=f,!($>h))break;$-=h,v+=1}return y+=1841,v+=1,k=$,{year:y,month:v,day:k}}if("ltos"===e){if(a=N,n=O,u=a-1841,f=n-1,i=0,z[u][f]>2)switch(z[u][f]){case 1:case 3:case 4:s=29;break;case 2:case 5:case 6:s=30}for(o=C,$=0,m=0;u>m;m++)for(g=0;12>g;g++)switch(z[m][g]){case 1:$+=29;break;case 2:$+=30;break;case 3:$+=58;break;case 4:$+=59;break;case 5:$+=59;break;case 6:$+=60}for(g=0;f>g;g++)switch(z[u][g]){case 1:$+=29;break;case 2:$+=30;break;case 3:$+=58;break;case 4:$+=59;break;case 5:$+=59;break;case 6:$+=60}if(1===i)switch(z[u][f]){case 3:case 4:$+=29;break;case 5:case 6:$+=30}for($=$+parseFloat(o)+22,u=1840;;){if(u+=1,p=u%400===0||u%100!==0&&u%4===0?366:365,p>=$)break;$-=p}for(d=u,M[1]=parseInt(p,10)-337,f=0;;){if(f+=1,$<=M[f-1])break;$-=M[f-1]}return l=parseInt(f,10),c=parseInt($,10),{year:d,month:l,day:c}}},p=function(t,e){var a,n;return e||(e=1),a=new Date(t.year,t.month-1,parseInt(t.date,10)+e),n={date:a.getDate(),month:a.getMonth()+1,year:a.getFullYear()},n.week=o(n.date,n.month,n.year),n.day=new Date(n.year,n.month-1,n.date).getDay(),n},u=function(t,e){var a,n;return e||(e=1),a=new Date(t.year,t.month-1,t.date-e),n={date:a.getDate(),month:a.getMonth()+1,year:a.getFullYear()},n.week=o(n.date,n.month,n.year),n.day=new Date(n.year,n.month-1,n.date).getDay(),n},h=function(t,e){e||(e=1);var a=u(t,e);return l(a)},f=function(t,e){e||(e=1);var a=p(t,e);return l(a)},l=function(t,e){var a,n="",o=t.date,r=t.month,i=t.year;return e||(e=""),n+=i,t.week?(a=t.week,n=n+e+a):r&&(10>r&&(n+=0),n=n+e+r),o&&(10>o&&(n+=0),n=n+e+o),n},d=function(t){if("string"!=typeof t)return console.warn("인자는 문자열이어야 합니다."),!1;var e,a,n,r;return 8===t.length?(a=t.substr(0,4),n=t.substr(4,2),r=t.substr(6,2)):10===t.length&&(a=t.substr(0,4),n=t.substr(5,2),r=t.substr(8,2)),e={year:parseInt(a,10),month:parseInt(n,10),date:parseInt(r,10),week:o(a,n,r)}},m=function(t,e,a){a||(a=(new Date).getFullYear());var n=new Date(a,e-1,t).getDay();return g.day_list[n]},i=function(t,e,a){var n=[31,28,31,30,31,30,31,31,30,31,30,31],o=0,i=0;if(a||(a=(new Date).getFullYear()),29===r(2,a)&&(n[1]=29),e){for(;e-1>o;)i+=n[o],o++;return i+=t}for(;t>0;)t-=n[o],o++;return e=o,t+=n[o-1],{month:e,date:t,year:a}},r=function(t,e){return e||(e=(new Date).getFullYear()),new Date(e,t,0).getDate()},c=function(t,e){e||(e=(new Date).getFullYear());var a,n,o=0,r=new Date(e,0,1).getDay(),d=[];for(a=7*t-r-6,o;7>o;o++)n=i(a),d[o]={month:n.month,date:n.date},a++;return d},o=function(t,e,a){a||(a=(new Date).getFullYear());var n,o,r=new Date(a,0,1).getDay(),d=new Date(a,e-1,t).getDay(),l=6-d;return o=i(t,e,a)+r+l,n=Math.floor(o/7),r>4&&(n-=1),n},{initModule:t,getWeekNum:o,dayOfYear:i,getWeekDay:c,daysInMonth:r,dayOfWeek:m,stringify:l,objectify:d,lunarSolar:s,getPrevDate:u,getNextDate:p,getPrevString:h,getNextString:f}}(),zp.shell=function(){"use strict";var t,e,a,n,o,r,i,d,l,c,s,u,p,f,h,m,g,y,v,k,w,b,_,x,S,D,z,M,N,O,C,I,J={anchor_schema_map:{current:{year:!0,month:!0,week:!0,day:!0,plan:!0,todo:!0},date:!0},today:{year:(new Date).getFullYear(),month:(new Date).getMonth()+1,date:(new Date).getDate(),week:zp.calendar.getWeekNum((new Date).getDate(),(new Date).getMonth()+1),day:(new Date).getDay()},day:["일","월","화","수","목","금","토"]},T={$container:null,anchor_map:{},cur:"day",act:"reload",date_info:{year:J.today.year,month:J.today.month,date:J.today.date,week:J.today.week,day:J.today.day},flick:[100,200,0],state:"static",top:0,left:0,fidx:0,db:null},q={};return e=function(t){q={$container:t,$header:t.find("header"),$user:t.find(".user"),$avatar:t.find(".avatar"),$info:t.find(".info"),$name:t.find(".name"),$menu:t.find(".menu"),$logout:t.find(".menu-logout"),$profile:t.find(".menu-profile"),$upload:t.find(".menu-upload"),$download:t.find(".menu-download"),$main:t.find("main"),$flickView:t.find(".flick-view"),$flickCon:t.find(".flick-con"),$flick:t.find(".flick-panel"),$toggle:t.find(".tool-toggle"),$search:t.find(".tool-search"),$modal:t.find(".modal"),$intro:t.find(".intro")}},n=function(t,e){t.preventDefault();var a;"static"===T.state?(a=String(e.year)+("0"+e.month).slice(-2)+("0"+e.date).slice(-2),p("day",a),I()):T.state="static"},o=function(t,e){t.preventDefault();var a;"static"===T.state?(a=e.year+("0"+e.week).slice(-2),p("week",a),I()):T.state="static"},r=function(t,e){t.preventDefault();var a;"static"===T.state?(a=e.year+("0"+e.month).slice(-2),p("month",a),I()):T.state="static"},i=function(t,e){t.preventDefault();var a;"static"===T.state?(a=String(e.year),p("year",a),I()):T.state="static"},a=function(t,e){console.log("main을 초기화합니다."+t);var a={};e.week=e.week||zp.calendar.getWeekNum(e.date,e.month,e.year),zp[t].initModule(q.$flick.eq(0),e),"day"===t?(a=zp.calendar.getNextDate(e),zp.day.initModule(q.$flick.eq(1),a),a=zp.calendar.getPrevDate(e),zp.day.initModule(q.$flick.eq(2),a)):"week"===t?(a.week=e.week+1,a.year=e.year,54===a.week&&(a.week=1,a.year+=1),zp.week.initModule(q.$flick.eq(1),a),a.week=e.week-1,0===a.week&&(a.week=53,a.year-=1),zp.week.initModule(q.$flick.eq(2),a)):"month"===t?(a={year:e.year,month:e.month+1},13===a.month&&(a.month=1,a.year+=1),zp.month.initModule(q.$flick.eq(1),a),a={year:e.year,month:e.month-1},0===a.month&&(a.month=12,a.year-=1),zp.month.initModule(q.$flick.eq(2),a)):"year"===t&&(a={year:e.year+1},zp.year.initModule(q.$flick.eq(1),a),a={year:e.year-1},zp.year.initModule(q.$flick.eq(2),a)),T.cur=t,x(e),console.log("메인이 초기화되었습니다!")},x=function(t){console.log("상단 title을 변경합니다.");var e="",a="",n=T.cur;switch(n){case"day":0===t.day?a='style="color:yellow;"':6===t.day&&(a='style="color:blue;"'),e='<span class="title-year">'+t.year+'</span>.<span class="title-month">'+t.month+'</span>.<span class="title-date">'+t.date+'</span> <span class="title-day" '+a+">"+J.day[t.day]+'</span> <span class="title-week">'+t.week+"주차</span>";break;case"week":t.week=t.week||zp.calendar.getWeekNum(t.date,t.month,t.year),e='<span class="title-year">'+t.year+'</span>년 <span class="title">'+t.week+"주차</span>";break;case"month":e='<span class="title-year">'+t.year+'년</span> <span class="title">'+t.month+"월</span>";break;case"year":e='<span class="title">'+t.year+"년</span>";break;case"todo":e='<span class="title">할일</span>';break;case"plan":e='<span class="title">일정</span>';break;case"dday":e='<span class="title">D-day / 기념일</span>'}return q.$info.html(e),t&&(console.log("data가 있어 stateMap 날짜 정보를 변경합니다."),t.hasOwnProperty("date")&&(T.date_info.date=t.date),t.hasOwnProperty("month")&&(T.date_info.month=t.month),t.hasOwnProperty("year")&&(T.date_info.year=t.year),t.hasOwnProperty("week")&&(T.date_info.week=t.week)),$.extend({},t)},u=function(){alert("처음이시군요!"),q.$intro.show(),confirm("다음 실행 때도 보시겠습니까?")||(localStorage.first="false")},w=function(t){return t.stopPropagation(),JSON.parse(localStorage.online)===!1?(zp.modal.initModule(q.$modal,"login").show(),!1):confirm("로그아웃하시겠습니까?")?(q.$name.html("로그인"),q.$avatar.html(""),localStorage.removeItem("user"),localStorage.online="false",alert("로그아웃되었습니다!"),q.$menu.hide(),zp.modal.initModule(q.$modal,"login").show(),void q.$modal.find(".input-id").focus()):!1},b=function(){zp.model.upload()},_=function(){zp.model.download()},S=function(){I(),p("year",T.date_info.year),T.cur="year",x(T.date_info)},D=function(){I(),p("month",T.date_info.year+("0"+T.date_info.month).slice(-2)),T.cur="month",x(T.date_info)},z=function(){I(),p("week",T.date_info.year+("0"+T.date_info.week).slice(-2)),T.cur="week",x(T.date_info)},C=function(t,e){var a,n,o=T.cur;if(T.act="swipe",e.year=parseInt(e.year,10),e.month=parseInt(e.month,10),e.week=parseInt(e.week,10),"left"===t)switch(console.log("swiped to the left!"),n=(T.fidx+1)%3,o){case"day":e=x(zp.calendar.getNextDate(e)),a=zp.calendar.getNextDate(e),zp[o].initModule(q.$flick.eq(n),a),p(o,e.year+("0"+e.month).slice(-2)+("0"+e.date).slice(-2));break;case"week":e.week+=1,54===e.week&&(e.week=1,e.year+=1),a=x(e),a.week+=1,54===a.week&&(a.week=1,a.year+=1),zp.week.initModule(q.$flick.eq(n),a),p("week",e.year+("0"+e.week).slice(-2));break;case"month":e.month+=1,13===e.month&&(e.month=1,e.year+=1),a=x(e),a.month+=1,13===a.month&&(a.month=1,a.year+=1),zp.month.initModule(q.$flick.eq(n),a),p("month",e.year+("0"+e.month).slice(-2));break;case"year":e.year+=1,e=x(e),a=$.extend({},e),a.year+=1,zp.year.initModule(q.$flick.eq(n),a),p("year",e.year);break;case"todo":T.cur="plan",x();break;case"plan":T.cur="dday",x();break;case"dday":T.cur="todo",x()}else switch(console.log("swiped to the right!"),n=(T.fidx-1)%3,o){case"day":e=x(zp.calendar.getPrevDate(e)),a=zp.calendar.getPrevDate(e),zp[o].initModule(q.$flick.eq(n),a),p(o,e.year+("0"+e.month).slice(-2)+("0"+e.date).slice(-2));break;case"week":e.week-=1,0===e.week&&(e.week=53,e.year-=1),a=x(e),a.week-=1,0===a.week&&(a.week=53,a.year-=1),zp.week.initModule(q.$flick.eq(n),a),p("week",e.year+("0"+e.week).slice(-2));break;case"month":e.month-=1,0===e.month&&(e.month=12,e.year-=1),a=x(e),a.month-=1,0===a.month&&(a.month=12,a.year-=1),zp[o].initModule(q.$flick.eq(n),a),p(o,e.year+("0"+e.month).slice(-2));break;case"year":e.year-=1,a=x(e),a.year-=1,zp[o].initModule(q.$flick.eq(n),a),p(o,e.year);break;case"todo":T.cur="dday",x();break;case"plan":T.cur="todo",x();break;case"dday":T.cur="plan",x()}return q.$flick.eq(n).css("top",0),T.date_info=e,console.log("swipe가 완료되었습니다",T.act),e},O=function(){return"true"!==localStorage.online?(zp.modal.initModule(q.$modal,"login").show(),!1):(q.$menu.toggle(),!1)},m=function(t,e){t.preventDefault(),localStorage.online="true",q.$name.html(e.name),q.$avatar.html(e.avatar||""),localStorage.user=JSON.stringify(e),console.log("online mode"),!localStorage.first&&JSON.parse(localStorage.first)&&u()},h=function(){zp.modal.configModule({set_cur_anchor:p}),zp.modal.initModule(q.$modal,"search").show()},N=function(t,e){t.preventDefault(),console.log("onSubmit",e),p(e)},g=function(t,e){t.preventDefault(),zp.modal.initModule(q.$modal,"type",e).show()},s=function(){var t=c().current;T.act="reload","todo"===t||"plan"===t||"dday"===t?(p("day"),q.$toggle.html('<i class="fa fa-list"></i>')):(p("todo"),q.$toggle.html('<i class="fa fa-calendar"></i>'))},c=function(){return $.extend(!0,{},T.anchor_map)},l=function(t){var e,a,n=c(),o=!0;for(e in t)if(t.hasOwnProperty(e)){if(0===e.indexOf("_"))continue;n[e]=t[e],void 0===t[e]&&(delete t[e],delete n[e]),a="_"+e,t[a]?n[a]=t[a]:(delete n[a],delete n["_s"+a])}try{$.uriAnchor.setAnchor(n)}catch(r){$.uriAnchor.setAnchor(T.anchor_map,null,!0),o=!1}return o},p=function(t,e){var a={current:t,date:e};return l(a)},f=function(){var t,e,n,o,r,i,d=c(),l={};console.log((new Date).getHours(),(new Date).getMinutes(),(new Date).getSeconds(),"해시가 변경이 시도되었습니다.");try{t=$.uriAnchor.makeAnchorMap()}catch(s){return $.uriAnchor.setAnchor(d,null,!0),!1}if(void 0===t.current&&(t.current="day"),T.anchor_map=t,r=d._s_date,i=t._s_date,e=d._s_current,n=t._s_current,!Object.keys(d).length||e!==n||r!==i)switch(o=t.current){case"year":"reload"===T.act?(i&&(l.year=T.date_info.year=parseInt(i.substr(0,4),10)),a("year",l)):T.act="reload";break;case"month":"reload"===T.act?(i&&(l.year=T.date_info.year=parseInt(i.substr(0,4),10),l.month=T.date_info.month=parseInt(i.substr(4,2),10)),a("month",l)):T.act="reload";break;case"week":"reload"===T.act?(i&&(l.year=T.date_info.year=parseInt(i.substr(0,4),10),l.week=T.date_info.week=parseInt(i.substr(4,2),10)),console.log("onhashchange","data.week",l.week),a("week",l)):T.act="reload";break;case"day":"reload"===T.act?(i?(l.year=T.date_info.year=parseInt(i.substr(0,4),10),l.month=T.date_info.month=parseInt(i.substr(4,2),10),l.date=T.date_info.date=parseInt(i.substr(6,2),10)):(l.year=T.date_info.year,l.month=T.date_info.month,l.date=T.date_info.date),l.day=new Date(l.year,l.month-1,l.date).getDay(),l.week=zp.calendar.getWeekNum(l.date,l.month,l.year),a("day",l)):T.act="reload";break;case"plan":I(),zp.plan.initModule(q.$flick.eq(0)),zp.dday.initModule(q.$flick.eq(1)),zp.todo.initModule(q.$flick.eq(2)),T.cur="plan",x();break;case"todo":I(),zp.todo.initModule(q.$flick.eq(0)),zp.plan.initModule(q.$flick.eq(1)),zp.dday.initModule(q.$flick.eq(2)),T.cur="todo",x();break;case"dday":I(),zp.dday.initModule(q.$flick.eq(0)),zp.todo.initModule(q.$flick.eq(1)),zp.plan.initModule(q.$flick.eq(2)),T.cur="dday",x();break;default:delete t.current,delete t.date,$.uriAnchor.setAnchor(t,null,!0)}},I=function(){console.log("flick 포지션을 초기화합니다"),q.$main.css("height",$(window).height()-q.$header.height()),q.$flick.css("min-height",$(window).height()-q.$header.height()),q.$flick.eq(0).css("left","0%"),q.$flick.eq(1).css("left","100%"),q.$flick.eq(2).css("left","-100%")},M=function(){T.fidx=T.fidx<0?T.fidx+3:T.fidx%3;var t=T.fidx,e=t+1,a=t-1;0>t-1&&(a=2),t+1>2&&(e=0),q.$flick.eq(a).css({left:"-100%"}),q.$flick.eq(t).css({left:"0%"}),q.$flick.eq(e).css({left:"100%"})},d=function(t,e){var a,n=Math.abs(parseFloat((e/t).toFixed(2))),o=(window.innerHeight/2/window.innerWidth).toFixed(2),r=(window.innerHeight/(window.innerWidth/2)).toFixed(2);return a=n>=o?2:r>=n?0:1},k=function(t){return q.$flickCon.css({webkitTransition:"null"}),T.touch_start_x=T.touch_x=t.originalEvent.touches[0].clientX,T.touch_start_y=T.touch_y=t.originalEvent.touches[0].clientY,!0},v=function(t){T.touch_x=t.originalEvent.touches[0].clientX,T.touch_y=t.originalEvent.touches[0].clientY,T.gap_x=T.touch_x-T.touch_start_x,T.gap_y=T.touch_y-T.touch_start_y,T.direction=T.direction||d(T.gap_x,T.gap_y),0===T.direction&&(t.preventDefault(),q.$flickCon.css({transform:"translate("+T.gap_x+"px)"})),T.state="drag"},y=function(){return Math.abs(T.gap_x)>$(window).width()/2.5?(T.gap_x<0?(q.$flickCon.css({transform:"translate(100%,0)",webkitTransition:"200ms"}),T.fidx++,C("left",T.date_info)):(q.$flickCon.css({transform:"translate(-100%,0)",webkitTransition:"200ms"}),T.fidx--,C("right",T.date_info)),M(),q.$flickCon.css({transform:"translate(0)",webkitTransition:"null"})):q.$flickCon.css({transform:"translate(0)",webkitTransition:"200ms"}),T.direction=void 0,T.gap_x=0,!0},t=function(t){console.log("shell init!");var a=localStorage.online?JSON.parse(localStorage.online):!1;$.uriAnchor.configModule({schema_map:J.anchor_schema_map}),localStorage.first=localStorage.first?JSON.parse(localStorage.first):!1,T.$container=t,e(t),a?m(event,JSON.parse(localStorage.user)):(console.log("오프라인모드로 접속합니다."),localStorage.user="anon"),I(),$(window).on("error",function(t,e,a,n,o){console.error(t),t.indexOf("Script error.")>-1||alert("Error: "+t+" Script: "+e+" Line: "+a+" Column: "+n+" StackTrace: "+o)}).on("hashchange",f).trigger("hashchange").on("orientationchange resize",function(){q.$main.css("height",$(window).height()-q.$header.height()),q.$flick.css("min-height",$(window).height()-q.$header.height())}),$.gevent.subscribe(q.$user,"login",m),$.gevent.subscribe(q.$container,"submit",N),$.gevent.subscribe(q.$main,"day",n),$.gevent.subscribe(q.$main,"week",o),$.gevent.subscribe(q.$main,"month",r),$.gevent.subscribe(q.$main,"year",i),$.gevent.subscribe(q.$modal,"cell",g),q.$user.on("click",O),q.$logout.on("click",w),q.$toggle.on("click",s),q.$search.on("click",h),q.$info.on("click",".title-year",S),q.$info.on("click",".title-month",D),q.$info.on("click",".title-week",z),q.$flickView.on("touchstart",k).on("touchmove",v).on("touchend",y)},{initModule:t}}(),zp.day=function(){"use strict";var t,e,a,n,o,r,i,d,l={settable_map:{set_cur_anchor:!0},today:{year:(new Date).getFullYear(),month:(new Date).getMonth()+1,date:(new Date).getDate()},set_cur_anchor:null,tr_h:40},c={day_list:[],update:!1},s={};return t=function(t,e){s={$container:t},s[e]={$container:t,$ddayTable:t.find(".dday-table"),$planTable:t.find(".plan-table")}},r=function(e,a){var r,c={date:parseInt(a.date,10),month:parseInt(a.month,10),year:parseInt(a.year,10)},u=a.month,p=a.date,f=a.year;10>u&&(u="0"+c.month),10>p&&(p="0"+c.date),r=String()+f+u+p,console.log(c.date,"모듈을 로딩합니다."),e.load("/html/zp.day.html",function(){console.log("모듈을 로딩했습니다."),t(e,r),n(a,r),c.date===l.today.date&&c.month===l.today.month&&c.year===l.today.year&&(i(r),setInterval(i(r),6e4)),s[r].$ddayTable.attr("data-date",r),s[r].$planTable.on("click",".todo, .plan, .dday",o),s[r].$planTable.on("click","td",a,d)})},d=function(t){var e=$(this).data("time"),a={year:t.data.year,month:t.data.month,date:t.data.date,time:e};$.gevent.publish("cell",[a])},o=function(){var t=$(this).attr("class");"whole"===t&&(t="plan"),$.gevent.publish("submit",[t])},i=function(t){var e,a,n,o=(new Date).getHours(),r=(new Date).getMinutes(),i=$(".time-indicator");n=s[t].$ddayTable.find("tr").length,a=o*l.tr_h+r*l.tr_h/60+40*n,i.length&&i.remove(),e=$("<div/>").addClass("time-indicator").css({top:a}),s[t].$container.prepend(e)},n=function(t,e){var a,n,o,r,i,d,c,u,p,f,h,m,g,y,v,k,w,b=1;if(n=("0"+t.month).slice(-2),a=("0"+t.date).slice(-2),m=t.year+"-"+n+"-"+a,d=localStorage.todo?JSON.parse(localStorage.todo):"",c=localStorage.plan?JSON.parse(localStorage.plan):"",u=localStorage.dday?JSON.parse(localStorage.dday):"",console.log(e,"일정을 삽입합니다."),u)for(b;b<u.length;b++)h=u[b],h&&h.target===m&&(y=$("<tr/>").attr("data-idx",b).append("<td/>"),y.find("td").addClass("dday").text(h.text),y.prependTo(s[e].$ddayTable));if(d)for(b=1;b<d.length;b++)p=d[b],p&&p.date===m&&(k=p.time.substr(0,2),w=p.time.substr(3,2),v=k*l.tr_h+w*l.tr_h/60+1,g=$("<div/>").addClass("todo").attr("data-idx",b),g.css({top:v}).append($("<div/>")).find("div").addClass("input").text(p.text),g.appendTo(s[e].$planTable));if(c)for(b=1;b<c.length;b++)f=c[b],f&&(o=new Date(f.startdate).getTime(),r=new Date(f.enddate).getTime(),i=new Date(m).getTime(),f.startdate===m?(k=f.starttime.substr(0,2),w=f.starttime.substr(3,2),v=k*l.tr_h+w*l.tr_h/60+1,g=$("<div/>").addClass("plan").attr("data-idx",b),g.css({top:v}).append($("<div/>")).find("div").addClass("input").text(f.text+" 시작"),g.appendTo(s[e].$planTable)):i>o&&r>i?(y=$("<tr/>").attr("data-idx",b).append("<td/>"),y.find("td").addClass("whole").text(f.text),y.prependTo(s[e].$ddayTable)):f.enddate===m&&(k=f.endtime.substr(0,2),w=f.endtime.substr(3,2),v=k*l.tr_h+w*l.tr_h/60+1,g=$("<div/>").addClass("plan").attr("data-idx",b),g.css({top:v}).append($("<div/>")).find("div").addClass("input").text(f.text+"끝"),g.appendTo(s[e].$planTable)));return!0},e=function(t){return zp.util.setConfigMap({input_map:t,settable_map:l.settable_map,config_map:l}),!0},a=function(t,e){var a=e.year+("0"+e.month).slice(-2)+("0"+e.date).slice(-2);return c.day_list[a]=new r(t,e),c.day_list},{configModule:e,initModule:a}}(),zp.dday=function(){"use strict";

var t,e,a,n,o,r,i,d,l,c,s,u,p={settable_map:{set_cur_anchor:!0},set_cur_anchor:null},f={$container:null,taphold:null},h={};return t=function(t){h={$container:t,$main:t.find(".dday-main")}},r=function(t){var e,a=new Date,n=zp.calendar.objectify(String(t)),o=new Date(n.year,n.month-1,n.date),r=o.getTime()-a.getTime();return r=Math.ceil(r/1e3/60/60/24),e=r>0?"D-"+r:0===r?"D-day":"D+"+Math.abs(r)},e=function(){var t,e,a,n,o,i,d,l,c=$(document.createDocumentFragment());return zp.model.getDday(),$.gevent.subscribe(h.$main,"getDday",function(s,u){if(s.preventDefault(),u.length){for(h.$main.html(""),l=0;l<u.length;l++)n=u[l],n&&(d=n.target,e=$("<div/>").addClass("dday-item").attr("data-idx",l),t=$("<div/>").addClass("dday-text").text(n.text),o=$("<div/>").addClass("dday-target").text(d),i=$("<div/>").addClass("dday-left").text(r(d)),a=$("<div/>").addClass("dday-del").html('<i class="fa fa-trash-o"></i>'),e.append(i).append(t).append(o).append(a),c.append(e));h.$main.append(c)}}),h.$main.html('<div style="text-align:center">기념일이나 D-day를 작성해주세요</div>'),!0},o=function(){if(!confirm("삭제하시겠습니까?"))return!1;var t=$(this).closest(".dday-item"),e=t.data("idx"),a=localStorage.change?JSON.parse(localStorage.change):{c:[],u:[],d:[]},n=JSON.parse(localStorage.dday);return delete n[e],t.remove(),localStorage.dday=JSON.stringify(n),a.d.push({cidx:e,type:"dday"}),localStorage.change=JSON.stringify(a),!0},l=function(t){return console.log("holdtap"),t.stopImmediatePropagation(),f.taphold=setTimeout(function(){"dday-text"===t.target.className?d(t.target):"dday-target"===t.target.className&&i(t.target)},1e3),!1},c=function(t){return console.log("holdstop"),t.stopPropagation(),clearTimeout(f.taphold),!1},i=function(t){var e=$(t).text();$(t).empty().append('<input type="text" value="'+e+'"/>'),$(t).find("input").focus().on("blur",{target:t,origin:e},s)},d=function(t){var e=$(t).text();$(t).empty().append('<input type="text" value="'+e+'"/>'),$(t).find("input").focus().on("blur",{target:t,origin:e},u)},s=function(t){var e,a,n,o,r=t.data,i=$(r.target),d=i.find("input").val();return r.origin===d?void i.empty().text(r.origin):(i.empty().text(d),e=JSON.parse(localStorage.change),a=JSON.parse(localStorage.dday),n=i.parent(".dday-item").data("idx"),o=d.substr(0,10),alert(n),a[n].target=o,e.u.push({cidx:n,type:"dday"}),localStorage.dday=JSON.stringify(a),void(localStorage.change=JSON.stringify(e)))},u=function(t){var e,a,n,o=t.data,r=$(o.target),i=r.find("input").val();return o.origin===i?void r.empty().text(o.origin):(r.empty().text(i),e=JSON.parse(localStorage.change),a=JSON.parse(localStorage.dday),n=r.parent(".dday-item").data("idx"),alert(n),a[n].text=i,e.u.push({cidx:n,type:"dday"}),localStorage.dday=JSON.stringify(a),void(localStorage.change=JSON.stringify(e)))},a=function(t){zp.util.setConfigMap({input_map:t,settable_map:p.settable_map,config_map:p})},n=function(a){return a.load("/html/zp.dday.html",function(){f.$container=a,t(a),e(),h.$main.on("click",".dday-del",o),h.$main.on("touchstart",".dday-target, .dday-text",l),h.$main.on("touchend",".dday-target, .dday-text",c)}),a},{configModule:a,initModule:n,calculate:r}}(),zp.modal=function(){"use strict";var t,e,a,n,o,r,i,d,l,c,s,u,p,f,h,m,g,y,v,k,w,b,_,x,S,D,z={settable_map:{set_cur_anchor:!0},set_cur_anchor:null,today:{year:(new Date).getFullYear(),month:(new Date).getMonth()+1,date:(new Date).getDate()}},M={$container:null,year:(new Date).getFullYear(),month:(new Date).getMonth()+1,date:(new Date).getDate(),hour:(new Date).getHours(),minute:(new Date).getMinutes()},N={};return t=function(t){N={$container:t,$close:t.find(".modal-close"),$login:t.find("#login-sbmt"),$todo:t.find(".todo-btn button"),$plan:t.find(".plan-btn button "),$dday:t.find(".dday-btn button "),$join:t.find(".join-btn"),$back:t.find(".modal-back"),$typeTodo:t.find("#type-todo"),$typePlan:t.find("#type-plan"),$typeDday:t.find("#type-dday"),$checkEmailBtn:t.find("#check-email-btn"),$joinSbmt:t.find("#join-sbmt"),$findpw:t.find(".findpw-btn"),$findEmailForm:t.find("#findpw-email-form"),$findEmailBtn:t.find("#findpw-email-sbmt"),$findPwForm:t.find("#findpw-qst-form"),$findPwBtn:t.find("#findpw-ans-sbmt"),$findPwResult:t.find("#findpw-result"),$offline:t.find(".offline-btn"),$repeat:t.find("#plan-input-repeat"),$repeatType:t.find('input[name="repeat-type"]'),$search:t.find("#search-btn"),$today:t.find("#search-today")}},m=function(){$(this).parent().find("output").val($(this).val()+"점")},r=function(t){zp.modal.initModule(N.$container,"todo",t.data)},i=function(t){zp.modal.initModule(N.$container,"plan",t.data)},d=function(t){zp.modal.initModule(N.$container,"dday",t.data)},v=function(){$.gevent.publish("zp-offline",[]),N.$container.hide()},n=function(){N.$container.empty().hide()},o=function(){zp.modal.initModule(N.$container,"login")},_=function(){zp.modal.initModule(N.$container,"findpw")},x=function(t){t.preventDefault();var e={email:N.$findEmailForm.find("#findpw-email").val()};return $.post("/findid",e,function(t){t?(N.$findPwForm.show(),N.$findPwForm.find("#findpw-qst").html(t.qst),N.$findPwForm.find("#findpw-email2").val(e.email),alert("아이디가 있습니다.")):alert("아이디가 없습니다.")}),!1},S=function(t){t.preventDefault();var e={email:N.$findEmailForm.find("#findpw-email").val(),ans:N.$findPwForm.find("#findpw-ans").val()};return $.post("/findpw",e,function(t){alert(JSON.stringify(t)),t?N.$findPwResult.html(t.pw):alert("답이 틀렸습니다.")}).fail(function(t){alert(t.responseText)}),!1},y=function(){zp.modal.initModule(N.$container,"join")},D=function(t){var e,a=$(t.target).prev().val();return""===a?(alert("이메일을 입력해주세요."),!1):k(a)?(e=zp.model.checkEmail(a),e.fail(function(t){return alert("이미 사용하고 있는 이메일입니다.",t),!1}),void e.done(function(t){console.log(t),alert("사용하셔도 좋습니다!"),$("#join-agree").removeAttr("disabled")})):!1},k=function(t){var e=/^[\-A-Za-z0-9_]+[\-A-Za-z0-9_.]*@[\-A-Za-z0-9_]+[\-A-Za-z0-9_.]*\.[A-Za-z]{2,5}$/,a=t.hasOwnProperty("data")?t.data.value.val():t;return t.hasOwnProperty("data")&&""===a?!1:"string"!=typeof a||""===a?(alert("이메일이 문자열이 아니거나 빈칸입니다."),!1):-1===a.search(e)?(alert("이메일 형식에 맞지 않습니다."),!1):!0},b=function(t){t.preventDefault();var e,a=$("#join-email"),n=$("#join-name"),o=$("#join-pw"),r=$("#join-pwc"),i=$("#join-qst"),d=$("#join-ans"),l=$("#join-agree"),c={_id:a.val(),pw:o.val(),name:n.val(),qst:i.val(),ans:d.val(),avatar:"z"};return a.val()?n.val()?o.val()?i.val()?d.val()?o.val()!==r.val()?(alert("비밀번호 확인이 일치하지 않습니다."),o.focus(),!1):(l.prop("disabled")&&alert("중복확인을 해주세요."),l.is(":checked")?(e=zp.model.join(c),e.done(function(t){console.log(t),alert("회원이 되신 것을 축하드립니다!")}),void e.fail(function(t){console.log(t),alert("오류가 발생했습니다. 다시 시도해주세요.")})):(alert("약관에 동의하셔야 합니다."),l.focus(),!1)):(alert("답변을 입력해주세요."),d.focus(),!1):(alert("질문을 입력해주세요."),i.focus(),!1):(alert("비밀번호를 입력해주세요."),o.focus(),!1):(alert("닉네임을 입력해주세요."),n.focus(),!1):(alert("이메일을 입력해주세요."),a.focus(),!1)},g=function(t){t.preventDefault();var e,a,n=$(this).parent().prev(),o=n.find("#login-email"),r=n.find("#login-pw"),i=o.val(),d=r.val();if(""===i.trim())alert("아이디를 입력해주십시오."),o.focus();else if(""===d.trim())return alert("비밀번호를 입력해주십시오."),r.focus(),!1;return k(i)?(e={email:i,pw:d},a=zp.model.login(e),a.done(function(t){alert("로그인 성공!"),N.$container.hide(),$.gevent.publish("login",[t]),confirm("서버의 데이터와 동기화하시겠습니까?")&&zp.model.sync(i)}),void a.fail(function(t){return alert(t),o.empty().focus(),r.empty(),!1})):(o.focus(),!1)},u=function(){$(this).next().toggle()},h=function(){var t=$(".plan-repeat-everyweek"),e=t.find("input[name=repeat-day]");"everyday"===$(this).val()?(e.prop("checked",!0),t.hide()):"everyweek"===$(this).val()&&(e.prop("checked",!1),t.show())},p=function(){var t=$(this).next(".plan-input-enddate");""===t.val()&&t.val($(this).val())},f=function(t){t.preventDefault();var e,a,n,o=$(this).prev("#search-date").val();return o?(e=o.substr(0,4),a=o.substr(5,2),n=o.substr(8,2),""===n||"00"===n?""===a||"00"===a?z.set_cur_anchor("year",e):z.set_cur_anchor("month",e+a):z.set_cur_anchor("day",e+a+n),void N.$container.empty().hide()):(alert("날짜를 입력하세요"),!0)},w=function(t){t.preventDefault();var e,a,n;a=z.today.month,n=z.today.date,10>a&&(a="0"+a),10>n&&(n="0"+n),e=String(z.today.year)+a+n,z.set_cur_anchor("day",e),N.$container.empty().hide()},l=function(t){t.preventDefault();var e,a,n=$(this).parent().prev(),o=n.find("#todo-input-date").val(),r=n.find("#todo-input-time").val(),i=n.find("#todo-input-text").val(),d=n.find("#todo-input-nodue").is(":checked");return""===o||""===r||""===i?(alert("빈칸이 있습니다."),!1):(d===!0&&(o="nodue",r="nodue"),e={_id:new Date(o+" "+r).getTime(),date:o,time:r,text:i,done:!1,type:"todo"},a=zp.model.setTodo(e),a.done(function(){N.$container.empty().hide(),console.log("successfully submit todo",a),$.gevent.publish("submit",["todo"])}),void a.fail(function(){alert("error!")}))},c=function(){var t,e,a,n,o,r,i,d=$(this).parent().prev(),l=d.find("#plan-input-startdate").val(),c=d.find("#plan-input-starttime").val(),s=d.find("#plan-input-enddate").val(),u=d.find("#plan-input-endtime").val(),p=d.find(".plan-input-text").val(),f={};return""===l||""===p?(alert("빈칸이 있습니다"),!1):(s||(n=new Date(l+" "+c),n.setHours(n.getHours()+1),o=("0"+(n.getMonth()+1)).slice(-2),r=("0"+n.getDate()).slice(-2),s=n.getFullYear()+"-"+o+"-"+r,u=n.getHours()+":"+n.getMinutes()),t={_id:new Date(l+" "+c).getTime(),startdate:l,starttime:c,enddate:s,endtime:u,text:p,type:"plan"},console.log(t),i=zp.model.setPlan(t),i.done(function(){if(d.find("#plan-input-repeat").is(":checked"))for(f={num:d.find(".plan-input-number").val(),lastdate:d.find(".plan-input-lastdate").val()},f.day=d.find('input[name="repeat-day"]:checked').map(function(){return $(this).val()}).get(),t.num=f.num,t.lastdate=f.lastdate,t.day=f.day,a=zp.plan.calculate(t),e=0;e<a.length;e++)zp.model.setPlan(a[e]);N.$container.empty().hide()}),!1)},s=function(){var t,e,a=$(this).parent().prev(),n=a.find(".dday-input-target").val(),o=a.find(".dday-input-text").val();return""===n||""===o?(alert("빈칸이 있습니다"),!1):(t={_id:new Date(n).getTime(),target:n,text:o,type:"dday"},e=zp.model.setDday(t),e.done(function(){N.$container.empty().hide(),$.gevent.publish("submit",["dday"]),console.log("dday registered",e)}),e.fail(function(t){alert("error")}),!1)},e=function(t){zp.util.setConfigMap({input_map:t,settable_map:z.settable_map,config_map:z})},a=function(e,a,z){if("string"!=typeof a)throw"initModule argument type error";return""===a&&(a="login"),e.load("/html/zp.modal.html #modal-"+a,function(){if(M.$container=e,t(e),z&&("todo"===a||"plan"===a||"dday"===a)){var O;z.month=z.month<10?"0"+z.month:z.month,z.date=z.date<10?"0"+z.date:z.date,O=z.year+"-"+z.month+"-"+z.date,z.time=4===z.time.length?"0"+z.time:z.time,"todo"===a?(e.find("#todo-input-date").val(O),e.find("#todo-input-time").val(z.time)):"plan"===a?(e.find("#plan-input-startdate").val(O),e.find("#plan-input-starttime").val(z.time)):"dday"===a&&e.find(".dday-input-target").val(O)}return $(document).on("blur","#login-email",{value:$(this).find("#login-email")},k),N.$close.on("click",n),N.$login.on("click",g),N.$repeat.on("click",u),N.$todo.on("click",z,l),N.$plan.on("click",z,c),N.$dday.on("click",z,s),N.$plan.prev().find(".plan-input-startdate").on("change",p),N.$container.find("#todo-input-score").on("input",m),N.$typeTodo.on("click",z,r),N.$typePlan.on("click",z,i),N.$typeDday.on("click",z,d),N.$join.on("click",y),N.$back.on("click",o),N.$joinSbmt.on("click",b),N.$checkEmailBtn.on("click",D),N.$findpw.on("click",_),N.$findEmailBtn.on("click",x),N.$findPwBtn.on("click",S),N.$offline.on("click",v),N.$search.on("click",f),N.$today.on("click",w),N.$repeatType.on("change",h),e}),e},{configModule:e,initModule:a}}(),zp.month=function(){var t,e,a,n,o,r,i,d,l={settable_map:{set_cur_anchor:!0},set_cur_anchor:null},c={month_list:[]},s={};return d=function(t,e){var o,d=e.month,l=e.year;t.load("/html/zp.month.html",function(){10>d&&(d="0"+d),o=String(l)+d,console.log("month",o),a(t,o),n(e.month,e.year),s[o].$month.attr("data-date",o),s[o].$month.find("td").on("click",e,r),s[o].$month.find("tbody th").on("click",e,i)})},a=function(t,e){s.$container=t,s[e]={$month:t.find(".month-calendar")}},n=function(t,e){var a,n={month:t,year:e};return t=10>t?"0"+t:t,a=String(e)+t,zp.calendar.initModule(s[a].$month,n),o(a),!0},o=function(t){var e,a,n,o,r,i,d,l,c,u,p,f,h,m,g,y,v,k,w,b,_,x,S,D,z=parseInt(t.substr(0,4),10),M=parseInt(t.substr(4,2),10);if(localStorage.plan)for(n=JSON.parse(localStorage.plan),d=1;d<n.length;d++)i=n[d],console.log(i),i&&(y=i.startdate,_=new Date(y).getTime(),v=parseInt(y.substr(5,2),10),k=y.substr(8,2),w=i.enddate,x=new Date(w).getTime(),b=parseInt(w.substr(5,2),10),S=(x-_)/1e3/60/60/24,M>=v&&b>=M&&(f=s[t].$month.find("td"),f.each(function(){if($(this).find("div").eq(0).text()===k)for(h=$(this).index(),g=$("<div/>").addClass("month-plan").text(i.text),D=$(this).parent().children(),D.eq(h).append(g.clone()),console.log(h,S,D);S>0;)h++,console.log(D.eq(h)),D.eq(h).length?D.eq(h).append(g.clone()):(h=1,D=D.parent().next().children(),D.eq(h).append(g.clone())),console.log(h,S,D),S--})));if(localStorage.dday)for(a=JSON.parse(localStorage.dday),d=1;d<a.length;d++)r=a[d],r&&(l=r.target,c=parseInt(l.substr(0,4),10),u=parseInt(l.substr(5,2),10),p=l.substr(8,2),c===z&&u===M&&(f=s[t].$month.find("td"),f.each(function(){$(this).find("div").eq(0).text()===p&&(g=$("<div/>").addClass("month-dday").text(r.text),$(this).append(g))})));if(localStorage.todo)for(e=JSON.parse(localStorage.todo),d=1;d<e.length;d++)o=e[d],o&&(m=o.date,c=parseInt(m.substr(0,4),10),u=parseInt(m.substr(5,2),10),p=m.substr(8,2),c===z&&u===M&&(f=s[t].$month.find("td"),f.each(function(){$(this).find("div").eq(0).text()===p&&(g=$("<div/>").addClass("month-todo").text(o.text),o.done?g.addClass("month-done"):new Date(m).getTime()<(new Date).getTime()&&g.addClass("month-due"),$(this).append(g))})));return console.log("plan inserted"),!0},i=function(t){var e,a=parseInt(("0"+parseInt($(this).html(),10)).slice(-2),10),n=t.data.year;return"&nbsp;"===a?!1:("0"===a&&(n=--n,a=zp.calendar.getWeekNum(31,12,n)),e={week:a,year:n},void $.gevent.publish("week",[e]))},r=function(t){var e,a=parseInt($(this).find("div").eq(0).text(),10),n=t.data.month,o=t.data.year;""!=a&&(e={date:a,month:n,year:o},$.gevent.publish("day",[e]))},t=function(t){zp.util.setConfigMap({input_map:t,settable_map:l.settable_map,config_map:l})},e=function(t,e){var a=e.year+("0"+e.month).slice(-2);return console.log("month initiated"),c.month_list[a]=new d(t,e),t},{configModule:t,initModule:e}}(),zp.plan=function(){var t,e,a,n,o,r,i,d,l,c,s,u,p,f,h={settable_map:{set_cur_anchor:!0},set_cur_anchor:null},m={$container:null,taphold:null},g={};return t=function(t){g={$container:t,$main:t.find(".plan-main")}},o=function(t){var e,a,n,o,r,i,d,l=[];if(t.num){for(e=zp.calendar.objectify(t.startdate),a=new Date(e.year,e.month-1,e.date).getDay(),n=0;n<t.day.length;n++)if(t.day[n]===a){o=a;break}for(t.day=t.day.map(function(t,e){return i=e,o=i}),t.day=t.day.map(function(e,a){var n,o;return n=t.day[e+1]||t.day[0],o=n-a,0>o&&(o=7+o),o}),r=t.num-1,n=0;r>n;n++)d=t.day[n],t.cidx++,t.startdate=zp.calendar.getNextString(t.startdate,d),t.enddate=zp.calendar.getNextString(t.enddate,d),l.push(t)}return l},n=function(){var t,e,a,n,o,r,i,d,l,c,s,u,p,f,h,m=$(document.createDocumentFragment());zp.model.getPlan(),$.gevent.subscribe(g.$main,"getPlan",function(y,v){if(y.preventDefault(),v.length){for(g.$main.html(""),r=0;r<v.length;r++)t=v[r],t&&(e=t.startdate,a=t.starttime,n=t.enddate,o=t.endtime,i=e+" "+a,d=n+" "+o,l=$("<div/>").addClass("plan-item").attr("data-idx",r),c=$("<div/>").addClass("plan-option"),s=$("<div/>").addClass("plan-del").html('<i class="fa fa-trash-o"></i>'),u=$('<div/>"').addClass("plan-alarm").html('<i class="fa fa-alarm"></i>'),p=$("<div/>").addClass("plan-text").text(t.text),f=$("<div/>").addClass("plan-start").text(i),h=$("<div/>").addClass("plan-end").text(d),c.append(s).append(u),l.append(f).append(h).append(p).append(c),m.append(l));g.$main.append(m)}}),g.$main.html('<div style="text-align:center">일정을 작성해주세요</div>')},r=function(){if(!confirm("삭제하시겠습니까?"))return!1;var t=$(this).closest(".plan-item"),e=t.data("idx"),a=localStorage.change?JSON.parse(localStorage.change):{c:[],u:[],d:[]},n=JSON.parse(localStorage.plan);return delete n[e],t.remove(),localStorage.plan=JSON.stringify(n),a.d.push({cidx:e,type:"plan"}),localStorage.change=JSON.stringify(a),!0},c=function(t){return console.log("holdtap"),t.stopImmediatePropagation(),m.taphold=setTimeout(function(){"plan-text"===t.target.className?l(t.target):"plan-start"===t.target.className?i(t.target):"plan-end"===t.target.className&&d(t.target)},1e3),!1},s=function(t){return console.log("holdstop"),t.stopPropagation(),clearTimeout(m.taphold),!1},i=function(t){var e=$(t).text();$(t).empty().append('<input type="text" value="'+e+'"/>'),$(t).find("input").focus().on("blur",{target:t,origin:e},u)},d=function(t){var e=$(t).text();$(t).empty().append('<input type="text" value="'+e+'"/>'),$(t).find("input").focus().on("blur",{target:t,origin:e},p)},l=function(t){var e=$(t).text();$(t).empty().append('<input type="text" value="'+e+'"/>'),$(t).find("input").focus().on("blur",{target:t,origin:e},f)},u=function(t){var e,a,n,o,r,i=t.data,d=$(i.target),l=d.find("input").val();return i.origin===l?void d.empty().text(i.origin):(d.empty().text(l),e=JSON.parse(localStorage.change),a=JSON.parse(localStorage.plan),n=d.parent(".plan-item").data("idx"),o=l.substr(0,10),r=l.substr(11,8),alert(n),a[n].startdate=o,a[n].starttime=r,e.u.push({cidx:n,type:"plan"}),localStorage.plan=JSON.stringify(a),void(localStorage.change=JSON.stringify(e)))},p=function(t){var e,a,n,o,r,i=t.data,d=$(i.target),l=d.find("input").val();return i.origin===l?void d.empty().text(i.origin):(d.empty().text(l),e=JSON.parse(localStorage.change),a=JSON.parse(localStorage.plan),n=d.parent(".plan-item").data("idx"),o=l.substr(0,10),r=l.substr(11,8),alert(n),a[n].enddate=o,a[n].endtime=r,e.u.push({cidx:n,type:"plan"}),localStorage.plan=JSON.stringify(a),void(localStorage.change=JSON.stringify(e)))},f=function(t){var e,a,n,o=t.data,r=$(o.target),i=r.find("input").val();return o.origin===i?void r.empty().text(o.origin):(r.empty().text(i),e=JSON.parse(localStorage.change),a=JSON.parse(localStorage.plan),n=r.parent(".todo-item").data("idx"),alert(n),a[n].text=i,e.u.push({cidx:n,type:"plan"}),localStorage.plan=JSON.stringify(a),void(localStorage.change=JSON.stringify(e)))},e=function(t){zp.util.setConfigMap({input_map:t,settable_map:h.settable_map,config_map:h})},a=function(e){e.load("/html/zp.plan.html",function(){m.$container=e,t(e),n(),g.$main.on("click",".plan-del",r),g.$main.on("touchstart",".plan-text, .plan-start, .plan-end",c),g.$main.on("touchend",".plan-text, .plan-start, .plan-end",s)})},{configModule:e,initModule:a,calculate:o}}(),zp.todo=function(){"use strict";var t,e,a,n,o,r,i,d,l,c,s,u,p,f,h={settable_map:{set_cur_anchor:!0},set_cur_anchor:null},m={$container:null},g={};return t=function(t){g={$container:t,$main:t.find(".todo-main")}},e=function(){var t,e,a,n,o,r,i,d,l,c,s,u,p,f,h=$(document.createDocumentFragment());return f=zp.model.getTodo(),f.done(function(f,m){if(f.preventDefault(),console.log(m),m.length){for(g.$main.html(""),p=0;p<m.length;p++)l=m[p],console.log(l),l&&(s=l.date,u=l.time,d=l.done,c=s+" "+u,n=$("<div/>").addClass("todo-item").attr("data-idx",p),a=$("<div/>").addClass("todo-done").append('<input type="checkbox" size="3">'),i=$("<div/>").addClass("todo-option"),o=$("<div/>").addClass("todo-del").html('<i class="fa fa-trash-o"></i>'),r=$("<div/>").addClass("todo-alarm").html('<i class="fa fa-bell-o"></i>'),e=$("<div/>").addClass("todo-text").text(l.text),t=$("<div/>").addClass("todo-due").text(c),new Date(c).getTime()<(new Date).getTime()&&e.addClass("item-due"),d&&(a.find("input").prop("checked",!0),e.addClass("item-done")),i.append(o).append(r),n.append(a).append(e).append(i).append(t),h.append(n));g.$main.append(h)}}),f.fail(function(t){alert(t)}),g.$main.html('<div style="text-align:center">할일을 작성해주세요</div>'),!0},o=function(){var t=$(this).parent().next(),e=JSON.parse(localStorage.todo),a=$(this).closest(".todo-item").data("idx"),n=localStorage.change?JSON.parse(localStorage.change):{c:[],u:[],d:[]};return $(this).is(":checked")?($(this).prop("checked",!0),t.addClass("item-done"),e[a].done=!0):($(this).prop("checked",!1),t.removeClass("item-done"),e[a].done=!1),n.u.push({cidx:a,type:"todo"}),localStorage.todo=JSON.stringify(e),localStorage.change=JSON.stringify(n),!0},r=function(){if(!confirm("삭제하시겠습니까?"))return!1;var t=$(this).closest(".todo-item"),e=t.data("idx"),a=localStorage.change?JSON.parse(localStorage.change):{c:[],u:[],d:[]},n=JSON.parse(localStorage.todo);return delete n[e],t.remove(),localStorage.todo=JSON.stringify(n),a.d.push({cidx:e,type:"todo"}),localStorage.change=JSON.stringify(a),!0},f=function(){var t,e,a={Android:/Android/,iOS:/like Mac OS X/};for(e in a)a.hasOwnProperty(e)&&a[e].test(navigator.userAgent)&&(t=e);return"Android"===t||"iOS"===t},i=function(){return f()?(alert("준비중입니다"),!1):(alert("모바일에서만 가능한 기능입니다"),!1)},c=function(t){return console.log("holdtap"),t.stopImmediatePropagation(),m.taphold=setTimeout(function(){"todo-text"===t.target.className?l(t.target):"todo-due"===t.target.className&&d(t.target)},1e3),!1},s=function(t){return console.log("holdstop"),t.stopPropagation(),clearTimeout(m.taphold),!1},d=function(t){var e=$(t).text();$(t).empty().append('<input type="text" value="'+e+'"/>'),$(t).find("input").focus().on("blur",{target:t,origin:e},u)},l=function(t){var e=$(t).text();$(t).empty().append('<input type="text" value="'+e+'"/>'),$(t).find("input").focus().on("blur",{target:t,origin:e},p)},u=function(t){var e,a,n,o,r,i=t.data,d=$(i.target),l=d.find("input").val();return i.origin===l?void d.empty().text(i.origin):(d.empty().text(l),e=JSON.parse(localStorage.change),a=JSON.parse(localStorage.todo),n=d.parent(".todo-item").data("idx"),o=l.substr(0,10),r=l.substr(11,8),alert(n),a[n].date=o,a[n].time=r,e.u.push({cidx:n,type:"todo"}),localStorage.todo=JSON.stringify(a),void(localStorage.change=JSON.stringify(e)))},p=function(t){var e,a,n,o=t.data,r=$(o.target),i=r.find("input").val();return o.origin===i?void r.empty().text(o.origin):(r.empty().text(i),e=JSON.parse(localStorage.change),a=JSON.parse(localStorage.todo),n=r.parent(".todo-item").data("idx"),alert(n),a[n].text=i,e.u.push({cidx:n,type:"todo"}),localStorage.todo=JSON.stringify(a),void(localStorage.change=JSON.stringify(e)))},a=function(t){zp.util.setConfigMap({input_map:t,settable_map:h.settable_map,config_map:h})},n=function(a){return a.load("/html/zp.todo.html",function(){m.$container=a,t(a),e(),g.$main.on("click","input[type=checkbox]",o),g.$main.on("click",".todo-del",r),g.$main.on("click",".todo-alarm",i),g.$main.on("touchstart",".todo-text, .todo-due",c),g.$main.on("touchend",".todo-text, .todo-due",s)}),a},{configModule:a,initModule:n}}(),zp.week=function(){var t,e,a,n,o,r,i,d={settable_map:{set_cur_anchor:!0},set_cur_anchor:null,tr_h:30},l={week_list:[]},c={};return i=function(t,e){var o,i=e.week,d=e.year;t.load("/html/zp.week.html",function(){o=d+("0"+i).slice(-2),console.log("week",o),a(t,o),n(i,d),c[o].$week.attr("data-week",o),c[o].$thead.on("click",e,r)})},a=function(t,e){c.$container=t,c[e]={$week:t.find(".week-table"),$thead:t.find("thead th"),$info:t.find(".week-info")}},n=function(t,e){var a,n=e+("0"+t).slice(-2),r=zp.calendar.getWeekDay(t,e),i=0;for(i;7>i;i++)a=r[i].month+"."+r[i].date,c[n].$thead.eq(i).text(a);return o(n),!0},o=function(t){var e,a,n,o,r,i,l,s,u,p,f,h,m,g,y=parseInt(t.substr(0,4),10),v=parseInt(t.substr(4,2),10),k=zp.calendar.getWeekDay(v,y),w=localStorage.todo?JSON.parse(localStorage.todo):"",b=localStorage.plan?JSON.parse(localStorage.plan):"",_=localStorage.dday?JSON.parse(localStorage.dday):"";if(console.log(t,"일정을 삽입합니다."),_)for(i=1;i<_.length;i++)if(a=_[i])for(l=0;7>l;l++)s=("0"+k[l].month).slice(-2),u=("0"+k[l].date).slice(-2),o=y+"-"+s+"-"+u,a.target===o&&(g=c[t].$info.children().eq(l),m=$("<div/>").addClass("week-dday").text(a.text).appendTo(g));if(w)for(i=1;i<w.length;i++)if(e=w[i])for(l=0;7>l;l++)s=("0"+k[l].month).slice(-2),u=("0"+k[l].date).slice(-2),o=y+"-"+s+"-"+u,e.date===o&&(f=e.time.substr(0,2),h=e.time.substr(3,2),r=f*d.tr_h+h*d.tr_h/60+61,console.log("top",r),m=$("<div/>").addClass("week-todo").attr("data-idx",i),e.done?m.addClass("week-done"):new Date(e.date).getTime()<(new Date).getTime()&&m.addClass("week-due"),p=14.285714*l+"%",m.css({top:r,left:p}).append($("<div/>")).find("div").addClass("input").text(e.text),m.appendTo(c[t].$week));if(b){var x,S,D,z,M,N,O;for(i=1;i<b.length;i++)if(n=b[i])for(l=0;7>l;l++)s=("0"+k[l].month).slice(-2),u=("0"+k[l].date).slice(-2),o=y+"-"+s+"-"+u,x=new Date(n.startdate).getTime(),S=new Date(n.enddate).getTime(),D=new Date(o),D>=x&&S>=D&&(x===D?(f=n.starttime.substr(0,2),h=n.starttime.substr(3,2),r=f*d.tr_h+h*d.tr_h/60+61,D===S?(M=n.endtime.substr(0,2),N=n.endtime.substr(3,2),O=M*d.tr_h+N*d.tr_h/60+61,z=O-r):z=24*d.tr_h-r,m=$("<div/>").addClass("week-plan").attr("data-idx",i),p=14.285714*l+"%",m.css({top:r,left:p,height:z}).append($("<div/>")).find("div").addClass("input").text(n.text),m.appendTo(c[t].$week)):D>x&&S>D?(g=c[t].$info.children().eq(l),m=$("<div/>").addClass("week-whole").text(n.text).appendTo(g)):D===S&&(f=n.endtime.substr(0,2),h=n.endtime.substr(3,2),r=0,p=14.285714*l+"%",z=f*d.tr_h+h*d.tr_h/60+61,m=$("<div/>").addClass("week-plan").attr("data-idx",i),m.css({top:r,left:p,height:z}).append($("<div/>")).find("div").addClass("input").text(n.text),m.appendTo(c[t].$week)))}return console.log("plan inserted"),!0},r=function(t){var e,a=$(this).text(),n=parseInt(a.split(".")[1],10),o=parseInt(a.split(".")[0],10),r=t.data.year;""!=n&&(e={date:n,month:o,year:r},$.gevent.publish("day",[e]))},t=function(t){zp.util.setConfigMap({input_map:t,settable_map:d.settable_map,config_map:d})},e=function(t,e){var a=e.year+("0"+e.week).slice(-2);return console.log("month initiated"),l.week_list[a]=new i(t,e),l.week_list},{configModule:t,initModule:e}}(),zp.year=function(){"use strict";var t,e,a,n,o,r,i={settable_map:{set_cur_anchor:!0},set_cur_anchor:null},d={$container:null,year_list:[]},l={};return r=function(t,a){t.load("/html/zp.year.html",function(){console.log(a.year),e(t,a.year),n(a.year),l[a.year].$calendar.on("click",a,o)})},n=function(t){var e,a=0,n={year:t};for(a;12>a;a++)e=l[t].$calendar.eq(a),n.month=parseInt(e.data("month"),10),zp.calendar.initModule(e,n)},e=function(t,e){l.$container=t,l[e]={$calendar:t.find(".year-calendar")}},o=function(t){var e=$(this).data("month"),a=t.data.year,n={month:e,year:a};$.gevent.publish("month",[n])},a=function(t){zp.util.setConfigMap({input_map:t,settable_map:i.settable_map,config_map:i})},t=function(t,e){e.year=parseInt(e.year,10),d.$container=t,d.year_list[e.year]=new r(t,e)},{configModule:a,initModule:t}}();
>>>>>>> bd0d0ad4dd6dc3d4c1b8a7183b6ab8c47032bd6c
