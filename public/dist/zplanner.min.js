var zp=function(){"use strict";var e=function(e){zp.model.initModule(),zp.shell.initModule(e)};return{initModule:e}}();$(function(){zp.initModule($("#zplanner"))}),zp.model=function(){"use strict";var e,t,n,a,o,i,r,d,l,s,c,u,p,f,m,h,g,y,v,k,w,b,_={local_db:null,remote_db:null,dbhost:null};return l=function(e){var t=$.Deferred(),n=_.remote_db;return n.login(e.id,e.pw).then(function(){return n.getUser(e.id)}).then(function(e){t.resolve(e),console.log(e)})["catch"](function(e){t.reject(e)}),t.promise()},u=function(){var e=$.Deferred(),n=_.remote_db;return n.logout().then(function(n){e.resolve(n),t(),console.log(n)})["catch"](function(t){e.reject(t)}),e.promise()},c=function(e){var t=_.remote_db,n=$.Deferred();return t.getUser(e).then(function(e){console.log(e),n.reject(e)})["catch"](function(e){console.log(e),n.resolve(e)}),n.promise()},s=function(e){var t=_.remote_db,n=$.Deferred();return t.signup(e.id,e.pw,{metadata:{email:e.email,nick:e.nick,qst:e.qst,ans:e.ans,avatar:e.avatar}}).then(function(e){console.log(e),n.resolve(e)})["catch"](function(e){console.log(e),n.reject(e)}),n.promise()},p=function(e){var t=$.Deferred(),n=_.remote_db;return n.getUser(e).then(function(e){console.log(e),t.resolve(e)})["catch"](function(e){console.log(e),t.reject(e)}),t.promise()},b=function(e){var t=$.Deferred(),n=_.remote_db;return n.getUser(e.id).then(function(n){e.ans===n.ans?t.resolve(n):t.reject("wrong answer")})["catch"](function(e){t.reject(e)}),t.promise()},f=function(e){var t=$.Deferred(),n=_.remote_db;return n.login("pwchanger","pwchanger").then(function(){return n.changePassword(e.id,e.pw)}).then(function(){return n.logout()}).then(function(e){t.resolve(e),console.log(e)})["catch"](function(e){console.log(e),t.reject(e)}),t.promise()},m=function(e){var t=$.Deferred();return _.local_db.put(e).then(function(e){t.resolve(e)})["catch"](function(e){console.log(e),t.reject(e)}),t.promise()},g=function(e,t){var n,a,o=[],i=0,r=$.Deferred();return e||t||(e=0,t=1e18),_.local_db.query(function(n,a){"dateless"===e?"todo"===n.type&&"dateless"===n.date&&a(n):"todo"===n.type&&n._id>e&&n._id<t&&a(n)}).then(function(e){for(0===e.total_rows&&r.reject("not_found"),n=e.rows,a=n.length,i;a>i;i++)o.push(n[i].key);r.resolve(o)})["catch"](function(e){r.reject(e)}),r.promise()},o=function(e,t){_.local_db.get(e).then(function(e){var n;for(n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return _.local_db.put(e)}).then(function(e){console.log("업데이트 완료!",e)})["catch"](function(e){console.log(e)})},h=function(e){var t=$.Deferred();return _.local_db.bulkDocs(e).then(function(e){t.resolve(e)})["catch"](function(e){console.log(e),t.reject(e),alert("error!")}),t.promise()},y=function(e,t){var n,a,o=[],i=0,r=$.Deferred();return e||t||(e=0,t=1e19),_.local_db.query(function(n,a){"plan"===n.type&&n._id>e&&n._id<t&&a(n)}).then(function(e){for(0===e.total_rows&&r.reject("not_found"),n=e.rows,a=n.length,i;a>i;i++)console.log(n[i]),o.push(n[i].key);r.resolve(o)})["catch"](function(e){console.log("plan",e),r.reject(e)}),r.promise()},i=function(e){var t=$.Deferred();return _.local_db.put(e).then(function(e){t.resolve(e)})["catch"](function(e){t.reject(e)}),t.promise()},r=function(e,t){var n,a,o=[],i=0,r=$.Deferred();return e||t||(e=0,t=1e19),_.local_db.query(function(n,a){"dday"===n.type&&n._id>e&&n._id<t&&a(n)}).then(function(e){for(0===e.total_rows&&r.reject("not_found"),n=e.rows,a=n.length,i;a>i;i++)o.push(n[i].key);r.resolve(o)})["catch"](function(e){console.log("dday",e),r.reject(e)}),r.promise()},n=function(e){var t=$.Deferred();return _.local_db.get(e).then(function(e){return console.log(e),_.local_db.remove(e)}).then(function(e){t.resolve(e)})["catch"](function(e){t.reject(e)}),t.promise()},a=function(e){var t=$.Deferred();return _.local_db.query(function(t,n){"plan"===t.type&&t.plan_idx===e&&n(t)}).then(function(e){var t=e.rows.map(function(e){return{_id:e.id,_rev:e.rev,_deleted:!0}});return _.local_db.bulkDocs(t)}).then(function(e){console.log(e),t.resolve(e)})["catch"](function(e){t.reject(e)}),t.promise()},v=function(){return!0},d=function(e){var t=$.Deferred(),n=_.local_db,a={live:!0};return n.replicate.to(_.dbhost+e,a,function(e){console.log(e)}),n.replicate.from(_.dbhost+e,a,function(e){console.log(e)}),t.promise()},k=function(e){var t=$.Deferred(),n=_.local_db;return n.replicate.to(_.dbhost+e,function(e){e?(console.log(e),t.reject(e)):t.resolve()}),t.promise()},w=function(e){var t=$.Deferred(),n=_.local_db;return n.replicate.from(_.dbhost+e,function(e){e?(console.log(e),t.reject(e)):t.resolve()}),t.promise()},t=function(e,t){var n={auto_compaction:!0};(null===t||void 0===t)&&(t="http://zerohch0.iriscouch.com/"),_.remote_db=e?new PouchDB(t+e,n):new PouchDB(t+"/zerohch0",n),_.dbhost=t},e=function(){var e={auto_compaction:!0};return t(),_.local_db=new PouchDB("local",e),!0},{configModule:t,initModule:e,login:l,logout:u,setTodo:m,getTodo:g,updateItem:o,setPlan:h,getPlan:y,getInfo:v,setDday:i,getDday:r,sync:d,join:s,checkId:c,upload:k,download:w,findId:p,changePw:f,checkAnswer:b,deleteItem:n,deletePlans:a}}(),zp.util=function(){var e,t;return e=function(e,t,n){var a=new Error;return a.name=e,a.message=t,n&&(a.data=n),a},t=function(t){var n,a,o=t.input_map,i=t.settable_map,r=t.config_map;for(n in o)if(o.hasOwnProperty(n)){if(!i.hasOwnProperty(n))throw a=e("Bad Input","Setting config key |"+n+"| is not supported");r[n]=o[n]}},{makeError:e,setConfigMap:t}}(),zp.util_b=function(){"use strict";var e,t,n,a={regex_encode_html:/[&"'><]/g,regex_encode_noamp:/["'><]/g,html_encode_map:{"&":"&#38;",'"':"&#34;","'":"&#39;",">":"&#62;","<":"&#60;"}};return a.encode_noamp_map=$.extend({},a.html_encode_map),delete a.encode_noamp_map["&"],e=function(e){return $("<div/>").html(e||"").text()},t=function(e,t){var n,o,i=String(e);return t?(o=a.encode_noamp_map,n=a.regex_encode_noamp):(o=a.html_encode_map,n=a.regex_encode_html),i.replace(n,function(e){return o[e]||""})},n=function(e){return Number(getComputedStyle(e,"").fontSize.match(/\d*\.?\d*/)[0])},{decodeHtml:e,encodeHtml:t,getEmSize:n}}(),zp.calendar=function(){"use strict";var e,t,n,a,o,i,r,d,l,s,c,u,p,f,m,h,g={dayMap:["일","월","화","수","목","금","토"]},y={$container:null},v={};return t=function(e){var t=0;for(v={$container:e,$table:e.find("table"),$caption:e.find("caption")},t;6>=t;t++)v["$tr"+t]=e.find("tr:eq("+t+")")},e=function(e,n){var o=n.month,i=n.year;y.$container=e,e.html($("#zp-calendar").html()),t(e),a(o,i)},a=function(e,t){var a,i,r,d,l,s=new Date,c=1,u=2,p=new Date;for(t=parseInt(t,10),e=parseInt(e,10),s.setYear(t),s.setMonth(e-1),s.setDate(1),a=s.getDay(),s.setMonth(e),s.setDate(s.getDate()-1),i=s.getDate(),v.$caption.html(e+"월"),d=o(c,e,t),r=a;7>r;r++)v.$tr1.find("th").html(d+"주"),v.$tr1.find("td").eq(r).append("<div>"+c+"</div>"),c++;for(d++;i-7>=c;){for(r=0;7>r;r++)v["$tr"+String(u)].find("th").html(d+"주"),v["$tr"+String(u)].find("td").eq(r).append("<div>"+c+"</div>"),c++;u++,d++}for(r=0;i>=c;r++)v["$tr"+String(u)].find("th").html(d+"주"),v["$tr"+String(u)].find("td").eq(r).append("<div>"+c+"</div>"),c++;switch(u){case 4:v.$tr5.addClass("hidden"),v.$tr6.addClass("hidden");break;case 5:v.$tr6.addClass("hidden")}t===p.getFullYear()&&e===p.getMonth()+1&&(l=v.$table.find("td"),l.each(function(){parseInt($(this).find("div").eq(0).html(),10)===p.getDate()&&$(this).addClass("td-today")})),n(e,t)},n=function(e,t){var n,a=v.$table.find("td"),o=c(t+"0101","ltos"),i=c(t+"0408","ltos"),r=c(t+"0815","ltos");switch(e===o.month?a.each(function(){n=parseInt($(this).text(),10),(n===o.day||n===o.day-1||n===o.day+1)&&$(this).css("color","red")}):e===i.month?a.each(function(){n=parseInt($(this).text(),10),n===i.day&&$(this).css("color","red")}):e===r.month&&a.each(function(){n=parseInt($(this).text(),10),(n===r.day||n===r.day-1||n===r.day+1)&&$(this).css("color","red")}),e){case 1:a.each(function(){1===parseInt($(this).text(),10)&&$(this).css("color","red")});break;case 3:a.each(function(){1===parseInt($(this).text(),10)&&$(this).css("color","red")});break;case 5:a.each(function(){5===parseInt($(this).text(),10)&&$(this).css("color","red")});break;case 6:a.each(function(){6===parseInt($(this).text(),10)&&$(this).css("color","red")});break;case 8:a.each(function(){15===parseInt($(this).text(),10)&&$(this).css("color","red")});break;case 10:a.each(function(){(3===parseInt($(this).text(),10)||9===parseInt($(this).text(),10))&&$(this).css("color","red")});break;case 12:a.each(function(){25===parseInt($(this).text(),10)&&$(this).css("color","red")})}return!0},c=function(e,t){if("ltos"!==t&&"stol"!==t)return!1;var n,a,o,r,d,l,s,c,u,p,f,m,h,g,$,y,v,k,w,b,_,D,x,z,S=[[1,2,4,1,1,2,1,2,1,2,2,1],[2,2,1,2,1,1,2,1,2,1,2,1],[2,2,2,1,2,1,4,1,2,1,2,1],[2,2,1,2,1,2,1,2,1,2,1,2],[1,2,1,2,2,1,2,1,2,1,2,1],[2,1,2,1,5,2,1,2,2,1,2,1],[2,1,1,2,1,2,1,2,2,2,1,2],[1,2,1,1,2,1,2,1,2,2,2,1],[2,1,2,3,2,1,2,1,2,1,2,2],[2,1,2,1,1,2,1,1,2,2,1,2],[2,2,1,2,1,1,2,1,2,1,5,2],[2,1,2,2,1,1,2,1,2,1,1,2],[2,1,2,2,1,2,1,2,1,2,1,2],[1,2,1,2,1,2,5,2,1,2,1,2],[1,1,2,1,2,2,1,2,2,1,2,1],[2,1,1,2,1,2,1,2,2,2,1,2],[1,2,1,1,5,2,1,2,1,2,2,2],[1,2,1,1,2,1,1,2,2,1,2,2],[2,1,2,1,1,2,1,1,2,1,2,2],[2,1,6,1,1,2,1,1,2,1,2,2],[1,2,2,1,2,1,2,1,2,1,1,2],[2,1,2,1,2,2,1,2,2,3,1,2],[1,2,2,1,2,1,2,2,1,2,1,2],[1,1,2,1,2,1,2,2,1,2,2,1],[2,1,1,2,4,1,2,2,1,2,2,1],[2,1,1,2,1,1,2,2,1,2,2,2],[1,2,1,1,2,1,1,2,1,2,2,2],[1,2,2,3,2,1,1,2,1,2,2,1],[2,2,2,1,1,2,1,1,2,1,2,1],[2,2,2,1,2,1,2,1,1,5,2,1],[2,2,1,2,2,1,2,1,2,1,1,2],[1,2,1,2,2,1,2,1,2,2,1,2],[1,1,2,1,2,4,2,1,2,2,1,2],[1,1,2,1,2,1,2,1,2,2,2,1],[2,1,1,2,1,1,2,1,2,2,2,1],[2,2,1,1,5,1,2,1,2,2,1,2],[2,2,1,1,2,1,1,2,1,2,1,2],[2,2,1,2,1,2,1,1,2,1,2,1],[2,2,4,2,1,2,1,1,2,1,2,1],[2,1,2,2,1,2,2,1,2,1,1,2],[1,2,1,2,1,2,5,2,2,1,2,1],[1,2,1,2,1,2,1,2,2,1,2,2],[1,1,2,1,1,2,1,2,2,2,1,2],[2,1,1,2,3,2,1,2,2,1,2,2],[2,1,1,2,1,1,2,1,2,1,2,2],[2,1,2,1,2,1,1,2,1,2,1,2],[2,2,1,5,2,1,1,2,1,2,1,2],[2,1,2,2,1,2,1,1,2,1,2,1],[2,1,2,2,1,2,1,2,1,2,1,2],[1,5,2,1,2,2,1,2,1,2,1,2],[1,2,1,2,1,2,1,2,2,1,2,2],[1,1,2,1,1,5,2,2,1,2,2,2],[1,1,2,1,1,2,1,2,1,2,2,2],[1,2,1,2,1,1,2,1,2,1,2,2],[2,1,2,1,5,1,2,1,2,1,2,1],[2,2,2,1,2,1,1,2,1,2,1,2],[1,2,2,1,2,1,2,1,2,1,2,1],[2,1,5,2,2,1,2,1,2,1,2,1],[2,1,2,1,2,1,2,2,1,2,1,2],[1,2,1,1,2,1,2,5,2,2,1,2],[1,2,1,1,2,1,2,1,2,2,2,1],[2,1,2,1,1,2,1,2,1,2,2,2],[1,2,1,2,3,2,1,1,2,2,1,2],[2,2,1,2,1,1,2,1,1,2,2,1],[2,2,1,2,2,1,1,2,1,2,1,2],[1,2,2,4,1,2,1,2,1,2,1,2],[1,2,1,2,1,2,2,1,2,1,2,1],[2,1,1,2,2,1,2,1,2,2,1,2],[1,5,1,2,1,2,1,2,2,2,1,2],[1,2,1,1,2,1,2,1,2,2,2,1],[2,1,2,1,1,5,1,2,2,1,2,2],[2,1,2,1,1,2,1,1,2,2,1,2],[2,2,1,2,1,1,2,1,1,2,1,2],[2,2,1,2,5,1,2,1,2,1,1,2],[2,1,2,2,1,2,1,2,1,2,1,2],[1,2,1,2,1,2,2,1,2,1,2,1],[2,3,2,1,2,2,1,2,2,1,2,1],[2,1,1,2,1,2,1,2,2,2,1,2],[1,2,1,1,2,1,5,2,2,1,2,2],[1,2,1,1,2,1,1,2,2,1,2,2],[2,1,2,1,1,2,1,1,2,1,2,2],[2,1,2,2,3,2,1,1,2,1,2,2],[1,2,2,1,2,1,2,1,2,1,1,2],[2,1,2,1,2,2,1,2,1,2,1,1],[2,1,2,5,2,1,2,2,1,2,1,2],[1,1,2,1,2,1,2,2,1,2,2,1],[2,1,1,2,1,2,1,2,2,1,2,2],[1,5,1,2,1,1,2,2,1,2,2,2],[1,2,1,1,2,1,1,2,1,2,2,2],[1,2,2,1,1,5,1,2,1,2,2,1],[2,2,2,1,1,2,1,1,2,1,2,1],[2,2,2,1,2,1,2,1,1,2,1,2],[1,2,2,1,6,1,2,1,2,1,1,2],[1,2,1,2,2,1,2,2,1,2,1,2],[1,1,2,1,2,1,2,2,1,2,2,1],[2,1,4,1,2,1,2,1,2,2,2,1],[2,1,1,2,1,1,2,1,2,2,2,1],[2,2,1,1,2,1,4,1,2,2,1,2],[2,2,1,1,2,1,1,2,1,2,1,2],[2,2,1,2,1,2,1,1,2,1,2,1],[2,2,1,2,2,4,1,1,2,1,2,1],[2,1,2,2,1,2,2,1,2,1,1,2],[1,2,1,2,1,2,2,1,2,2,1,2],[1,1,2,4,1,2,1,2,2,1,2,2],[1,1,2,1,1,2,1,2,2,2,1,2],[2,1,1,2,1,1,2,1,2,2,1,2],[2,5,1,2,1,1,2,1,2,1,2,2],[2,1,2,1,2,1,1,2,1,2,1,2],[2,2,1,2,1,2,3,2,1,2,1,2],[2,1,2,2,1,2,1,1,2,1,2,1],[2,1,2,2,1,2,1,2,1,2,1,2],[1,2,1,2,4,2,1,2,1,2,1,2],[1,2,1,1,2,2,1,2,2,1,2,2],[1,1,2,1,1,2,1,2,2,1,2,2],[2,1,4,1,1,2,1,2,1,2,2,2],[1,2,1,2,1,1,2,1,2,1,2,2],[2,1,2,1,2,1,1,5,2,1,2,2],[1,2,2,1,2,1,1,2,1,2,1,2],[1,2,2,1,2,1,2,1,2,1,2,1],[2,1,2,1,2,5,2,1,2,1,2,1],[2,1,2,1,2,1,2,2,1,2,1,2],[1,2,1,1,2,1,2,2,1,2,2,1],[2,1,2,3,2,1,2,1,2,2,2,1],[2,1,2,1,1,2,1,2,1,2,2,2],[1,2,1,2,1,1,2,1,1,2,2,1],[2,2,5,2,1,1,2,1,1,2,2,1],[2,2,1,2,2,1,1,2,1,2,1,2],[1,2,2,1,2,1,5,2,1,2,1,2],[1,2,1,2,1,2,2,1,2,1,2,1],[2,1,1,2,2,1,2,1,2,2,1,2],[1,2,1,1,5,2,1,2,2,2,1,2],[1,2,1,1,2,1,2,1,2,2,2,1],[2,1,2,1,1,2,1,1,2,2,2,1],[2,2,1,5,1,2,1,1,2,2,1,2],[2,2,1,2,1,1,2,1,1,2,1,2],[2,2,1,2,1,2,1,5,2,1,1,2],[2,1,2,2,1,2,1,2,1,2,1,1],[2,2,1,2,1,2,2,1,2,1,2,1],[2,1,1,2,1,6,1,2,2,1,2,1],[2,1,1,2,1,2,1,2,2,1,2,2],[1,2,1,1,2,1,1,2,2,1,2,2],[2,1,2,3,2,1,1,2,2,1,2,2],[2,1,2,1,1,2,1,1,2,1,2,2],[2,1,2,2,1,1,2,1,1,5,2,2],[1,2,2,1,2,1,2,1,1,2,1,2],[1,2,2,1,2,2,1,2,1,2,1,1],[2,1,2,2,1,5,2,2,1,2,1,2],[1,1,2,1,2,1,2,2,1,2,2,1],[2,1,1,2,1,2,1,2,2,1,2,2],[1,2,1,1,5,1,2,1,2,2,2,2],[1,2,1,1,2,1,1,2,1,2,2,2],[1,2,2,1,1,2,1,1,2,1,2,2],[1,2,5,2,1,2,1,1,2,1,2,1],[2,2,2,1,2,1,2,1,1,2,1,2],[1,2,2,1,2,2,1,5,2,1,1,2],[1,2,1,2,2,1,2,1,2,2,1,2],[1,1,2,1,2,1,2,2,1,2,2,1],[2,1,1,2,3,2,2,1,2,2,2,1],[2,1,1,2,1,1,2,1,2,2,2,1],[2,2,1,1,2,1,1,2,1,2,2,1],[2,2,2,3,2,1,1,2,1,2,1,2],[2,2,1,2,1,2,1,1,2,1,2,1],[2,2,1,2,2,1,2,1,1,2,1,2],[1,5,2,2,1,2,1,2,2,1,1,2],[1,2,1,2,1,2,2,1,2,2,1,2],[1,1,2,1,2,1,5,2,2,1,2,2],[1,1,2,1,1,2,1,2,2,2,1,2],[2,1,1,2,1,1,2,1,2,2,1,2],[2,2,1,1,5,1,2,1,2,1,2,2],[2,1,2,1,2,1,1,2,1,2,1,2],[2,1,2,2,1,2,1,1,2,1,2,1],[2,1,6,2,1,2,1,1,2,1,2,1],[2,1,2,2,1,2,1,2,1,2,1,2],[1,2,1,2,1,2,1,2,5,2,1,2],[1,2,1,1,2,1,2,2,2,1,2,2],[1,1,2,1,1,2,1,2,2,1,2,2],[2,1,1,2,3,2,1,2,1,2,2,2],[1,2,1,2,1,1,2,1,2,1,2,2],[2,1,2,1,2,1,1,2,1,2,1,2],[2,1,2,5,2,1,1,2,1,2,1,2],[1,2,2,1,2,1,2,1,2,1,2,1],[2,1,2,1,2,2,1,2,1,2,1,2],[1,5,2,1,2,1,2,2,1,2,1,2],[1,2,1,1,2,1,2,2,1,2,2,1],[2,1,2,1,1,5,2,1,2,2,2,1],[2,1,2,1,1,2,1,2,1,2,2,2],[1,2,1,2,1,1,2,1,1,2,2,2],[1,2,2,1,5,1,2,1,1,2,2,1],[2,2,1,2,2,1,1,2,1,1,2,2],[1,2,1,2,2,1,2,1,2,1,2,1],[2,1,5,2,1,2,2,1,2,1,2,1],[2,1,1,2,1,2,2,1,2,2,1,2],[1,2,1,1,2,1,5,2,2,2,1,2],[1,2,1,1,2,1,2,1,2,2,2,1],[2,1,2,1,1,2,1,1,2,2,1,2],[2,2,1,2,1,4,1,1,2,1,2,2],[2,2,1,2,1,1,2,1,1,2,1,2],[2,2,1,2,1,2,1,2,1,1,2,1],[2,2,1,2,5,2,1,2,1,2,1,1],[2,1,2,2,1,2,2,1,2,1,2,1],[2,1,1,2,1,2,2,1,2,2,1,2],[1,5,1,2,1,2,1,2,2,2,1,2],[1,2,1,1,2,1,1,2,2,1,2,2]],M=[31,0,31,30,31,30,31,31,30,31,30,31],C=e.substring(0,4),I=e.substring(4,6),P=e.substring(6,8),T=[203];if("stol"===t){for(x=672069.2,w=C,_=I,M[1]=i(2,w),D=P||M[_-1],b=w-1,z=365*b+b/4-b/100+b/400+parseInt(D,10),h=0;_-1>h;h++)z+=M[h];for($=z-x+1,h=0;w-1841>=h;h++)for(T[h]=0,g=0;12>g;g++){switch(S[h][g]){case 1:c=29;break;case 2:c=30;break;case 3:c=58;break;case 4:c=59;break;case 5:c=59;break;case 6:c=60}T[h]=T[h]+c}for(y=0;;){if(!($>T[y]))break;$-=T[y],y+=1}for(v=0;;)if(S[y][v]<=2){if(c=S[y][v]+28,!($>c))break;$-=c,v+=1}else{switch(S[y][v]){case 3:f=29,m=29;break;case 4:f=29,m=30;break;case 5:f=30,m=29;break;case 6:f=30,m=30}if(!($>f))break;if($-=f,!($>m))break;$-=m,v+=1}return y+=1841,v+=1,k=$,{year:y,month:v,day:k}}if("ltos"===t){if(n=C,a=I,u=n-1841,f=a-1,r=0,S[u][f]>2)switch(S[u][f]){case 1:case 3:case 4:c=29;break;case 2:case 5:case 6:c=30}for(o=P,$=0,h=0;u>h;h++)for(g=0;12>g;g++)switch(S[h][g]){case 1:$+=29;break;case 2:$+=30;break;case 3:$+=58;break;case 4:$+=59;break;case 5:$+=59;break;case 6:$+=60}for(g=0;f>g;g++)switch(S[u][g]){case 1:$+=29;break;case 2:$+=30;break;case 3:$+=58;break;case 4:$+=59;break;case 5:$+=59;break;case 6:$+=60}if(1===r)switch(S[u][f]){case 3:case 4:$+=29;break;case 5:case 6:$+=30}for($=$+parseFloat(o)+22,u=1840;;){if(u+=1,p=u%400===0||u%100!==0&&u%4===0?366:365,p>=$)break;$-=p}for(d=u,M[1]=parseInt(p,10)-337,f=0;;){if(f+=1,$<=M[f-1])break;$-=M[f-1]}return l=parseInt(f,10),s=parseInt($,10),{year:d,month:l,day:s}}},p=function(e,t){var n,a;return t||(t=1),n=new Date(e.year,e.month-1,parseInt(e.date,10)+t),a={date:n.getDate(),month:n.getMonth()+1,year:n.getFullYear()},a.week=o(a.date,a.month,a.year),a.day=new Date(a.year,a.month-1,a.date).getDay(),a},u=function(e,t){var n,a;return t||(t=1),n=new Date(e.year,e.month-1,e.date-t),a={date:n.getDate(),month:n.getMonth()+1,year:n.getFullYear()},a.week=o(a.date,a.month,a.year),a.day=new Date(a.year,a.month-1,a.date).getDay(),a},m=function(e,t){t||(t=1);var n=u(e,t);return l(n)},f=function(e,t){t||(t=1);var n=p(e,t);return l(n)},l=function(e,t){var n,a="",o=e.date,i=e.month,r=e.year;return t||(t=""),a+=r,e.week?(n=e.week,a=a+t+n):i&&(10>i&&(a+=0),a=a+t+i),o&&(10>o&&(a+=0),a=a+t+o),a},d=function(e){var t,n,a,i;return"string"!=typeof e?(console.warn("인자는 문자열이어야 합니다."),!1):(8===e.length?(n=e.substr(0,4),a=e.substr(4,2),i=e.substr(6,2)):10===e.length&&(n=e.substr(0,4),a=e.substr(5,2),i=e.substr(8,2)),t={year:parseInt(n,10),month:parseInt(a,10),date:parseInt(i,10),week:o(n,a,i)})},h=function(e,t,n){n||(n=(new Date).getFullYear());var a=new Date(n,t-1,e).getDay();return g.dayMap[a]},r=function(e,t,n){var a=[31,28,31,30,31,30,31,31,30,31,30,31],o=0,r=0;if(n||(n=(new Date).getFullYear()),29===i(2,n)&&(a[1]=29),t){for(;t-1>o;)r+=a[o],o++;return r+=e}for(;e>0;)e-=a[o],o++;return t=o,e+=a[o-1],{month:t,date:e,year:n}},i=function(e,t){return t||(t=(new Date).getFullYear()),new Date(t,e,0).getDate()},s=function(e,t){var n,a,o,i=0,d=[];for(t||(t=(new Date).getFullYear()),n=new Date(t,0,1).getDay(),a=7*e-n-6,i;7>i;i++)o=r(a),d[i]={month:o.month,date:o.date},a++;return d},o=function(e,t,n){var a,o,i=new Date(n,0,1).getDay(),d=new Date(n,t-1,e).getDay(),l=6-d;return n||(n=(new Date).getFullYear()),o=r(e,t,n)+i+l,a=Math.floor(o/7),i>4&&(a-=1),a},{initModule:e,getWeekNum:o,dayOfYear:r,getWeekDay:s,daysInMonth:i,dayOfWeek:h,stringify:l,objectify:d,lunarSolar:c,getPrevDate:u,getNextDate:p,getPrevString:m,getNextString:f}}(),zp.shell=function(){"use strict";var e,t,n,a,o,i,r,d,l,s,c,u,p,f,m,h,g,y,v,k,w,b,_,D,x,z,S,M,C,I,P,T,q,j,N,O,F,J={anchor_schema_map:{current:{year:!0,month:!0,week:!0,day:!0,plan:!0,todo:!0,dday:!0},date:!0},today:{year:(new Date).getFullYear(),month:(new Date).getMonth()+1,date:(new Date).getDate(),week:zp.calendar.getWeekNum((new Date).getDate(),(new Date).getMonth()+1),day:(new Date).getDay()},day:["일","월","화","수","목","금","토"]},A={$container:null,anchor_map:{},current:"day",act:"reload",date_info:{year:J.today.year,month:J.today.month,date:J.today.date,week:J.today.week,day:J.today.day},state:"static",fidx:0,container_height:960},B={};return b=function(e){B={$container:e,$header:e.find("header"),$user:e.find(".user"),$avatar:e.find(".avatar"),$info:e.find(".info"),$name:e.find(".name"),$menu:e.find(".menu"),$logout:e.find("#menu-logout"),$profile:e.find("#menu-profile"),$upload:e.find("#menu-upload"),$download:e.find("#menu-download"),$option:e.find("#menu-option"),$report:e.find("#menu-report"),$main:e.find("main"),$flickView:e.find("#flick-view"),$flickCon:e.find("#flick-con"),$flickPanel:e.find(".flick-panel"),$toggle:e.find(".tool-toggle"),$search:e.find(".tool-search"),$modal:e.find(".modal"),$intro:e.find(".intro")}},D=function(e,t){var n;e.preventDefault(),"static"===A.state?(n=String(t.year)+("0"+t.month).slice(-2)+("0"+t.date).slice(-2),v("day",n),I()):A.state="static"},x=function(e,t){var n;e.preventDefault(),"static"===A.state?(n=t.year+("0"+t.week).slice(-2),v("week",n),I()):A.state="static"},z=function(e,t){var n;e.preventDefault(),"static"===A.state?(n=t.year+("0"+t.month).slice(-2),v("month",n),I()):A.state="static"},S=function(e,t){var n;e.preventDefault(),"static"===A.state?(n=String(t.year),v("year",n),I()):A.state="static"},_=function(e,t){var n={};switch(console.log("현재 mod: "+e),t.week=t.week||zp.calendar.getWeekNum(t.date,t.month,t.year),zp[e].initModule(B.$flickPanel.eq(0),t),e){case"day":n=zp.calendar.getNextDate(t),zp.day.initModule(B.$flickPanel.eq(1),n),n=zp.calendar.getPrevDate(t),zp.day.initModule(B.$flickPanel.eq(2),n);break;case"week":n.week=t.week+1,n.year=t.year,54===n.week&&(n.week=1,n.year+=1),zp.week.initModule(B.$flickPanel.eq(1),n),n.week=t.week-1,0===n.week&&(n.week=53,n.year-=1),zp.week.initModule(B.$flickPanel.eq(2),n);break;case"month":n={year:t.year,month:t.month+1},13===n.month&&(n.month=1,n.year+=1),zp.month.initModule(B.$flickPanel.eq(1),n),n={year:t.year,month:t.month-1},0===n.month&&(n.month=12,n.year-=1),zp.month.initModule(B.$flickPanel.eq(2),n);break;case"year":n={year:t.year+1},zp.year.initModule(B.$flickPanel.eq(1),n),n={year:t.year-1},zp.year.initModule(B.$flickPanel.eq(2),n);break;default:throw"initMain error!"}A.current=e,I(),p(t)},p=function(e){var t="",n="",a=A.current;switch(a){case"day":0===e.day?n='style="color:yellow;"':6===e.day&&(n='style="color:blue;"'),t='<span class="title-year">'+e.year+'</span>.<span class="title-month">'+e.month+'</span>.<span class="title-date">'+e.date+'</span> <span class="title-day" '+n+">"+J.day[e.day]+'</span> <span class="title-week">'+e.week+"주차</span>";break;case"week":e.week=e.week||zp.calendar.getWeekNum(e.date,e.month,e.year),t='<span class="title-year">'+e.year+'</span>년 <span class="title">'+e.week+"주차</span>";break;case"month":t='<span class="title-year">'+e.year+'년</span> <span class="title">'+e.month+"월</span>";break;case"year":t='<span class="title">'+e.year+"년</span>";break;case"todo":t='<span class="title">할일</span>';break;case"plan":t='<span class="title">일정</span>';break;case"dday":t='<span class="title">D-day / 기념일</span>';break;default:throw"setTitle Error!"}return B.$info.html(t),e&&(e.hasOwnProperty("date")&&(A.date_info.date=e.date),e.hasOwnProperty("month")&&(A.date_info.month=e.month),e.hasOwnProperty("year")&&(A.date_info.year=e.year),e.hasOwnProperty("week")&&(A.date_info.week=e.week)),$.extend({},e)},u=function(){alert("처음이시군요!"),B.$intro.show(),confirm("다음 실행 때도 보시겠습니까?")||(localStorage.first="false")},a=function(e){return e.stopPropagation(),JSON.parse(localStorage.online)===!1?(zp.modal.initModule(B.$modal,"login").show(),!1):confirm("로그아웃하시겠습니까?")?(B.$name.html("로그인"),B.$avatar.html(""),localStorage.removeItem("user"),zp.model.logout(),localStorage.online=JSON.stringify(!1),alert("로그아웃되었습니다!"),B.$menu.hide(),zp.modal.initModule(B.$modal,"login").show(),void B.$modal.find("#login-id").focus()):!1},o=function(){var e;confirm("업로드하시겠습니까?")&&(e=zp.model.upload()),e.done(function(e){console.log(e)})},i=function(){var e;confirm("다운로드하시겠습니까?")&&(e=zp.model.download()),e.done(function(e){console.log(e)})},t=function(){zp.modal.initModule(B.$modal,"option").show()},n=function(){zp.modal.initModule(B.$modal,"profile").show()},e=function(){zp.modal.initModule(B.$modal,"report").show()},f=function(){I(),v("year",A.date_info.year),A.current="year",p(A.date_info)},m=function(){I(),v("month",A.date_info.year+("0"+A.date_info.month).slice(-2)),A.current="month",p(A.date_info)},h=function(){I(),v("week",A.date_info.year+("0"+A.date_info.week).slice(-2)),A.current="week",p(A.date_info)},C=function(e,t){var n,a,o=A.current;if(A.act="swipe",t.year=parseInt(t.year,10),t.month=parseInt(t.month,10),t.week=parseInt(t.week,10),"left"===e)switch(P(e),F(),a=(A.fidx+1)%3,o){case"day":t=p(zp.calendar.getNextDate(t)),n=zp.calendar.getNextDate(t),zp[o].initModule(B.$flickPanel.eq(a),n),v(o,t.year+("0"+t.month).slice(-2)+("0"+t.date).slice(-2));break;case"week":t.week+=1,54===t.week&&(t.week=1,t.year+=1),n=p(t),n.week+=1,54===n.week&&(n.week=1,n.year+=1),zp.week.initModule(B.$flickPanel.eq(a),n),v("week",t.year+("0"+t.week).slice(-2));break;case"month":t.month+=1,13===t.month&&(t.month=1,t.year+=1),n=p(t),n.month+=1,13===n.month&&(n.month=1,n.year+=1),zp.month.initModule(B.$flickPanel.eq(a),n),v("month",t.year+("0"+t.month).slice(-2));break;case"year":t.year+=1,t=p(t),n=$.extend({},t),n.year+=1,zp.year.initModule(B.$flickPanel.eq(a),n),v("year",t.year);break;case"todo":A.current="plan",p();break;case"plan":A.current="dday",p();break;case"dday":A.current="todo",p();break;default:throw"onSwipe left error!"}else switch(P(e),F(),a=(A.fidx-1)%3,o){case"day":t=p(zp.calendar.getPrevDate(t)),n=zp.calendar.getPrevDate(t),zp[o].initModule(B.$flickPanel.eq(a),n),v(o,t.year+("0"+t.month).slice(-2)+("0"+t.date).slice(-2));break;case"week":t.week-=1,0===t.week&&(t.week=53,t.year-=1),n=p(t),n.week-=1,0===n.week&&(n.week=53,n.year-=1),zp.week.initModule(B.$flickPanel.eq(a),n),v("week",t.year+("0"+t.week).slice(-2));break;case"month":t.month-=1,0===t.month&&(t.month=12,t.year-=1),n=p(t),n.month-=1,0===n.month&&(n.month=12,n.year-=1),zp[o].initModule(B.$flickPanel.eq(a),n),v(o,t.year+("0"+t.month).slice(-2));break;case"year":t.year-=1,n=p(t),n.year-=1,zp[o].initModule(B.$flickPanel.eq(a),n),v(o,t.year);break;case"todo":A.current="dday",p();break;case"plan":A.current="todo",p();break;case"dday":A.current="plan",p();break;default:throw"onSwipe right error!"}return B.$flickPanel.eq(a).css("top",0),A.date_info=t,t},c=function(){return"true"!==localStorage.online?(zp.modal.initModule(B.$modal,"login").show(),!1):(B.$menu.toggle(),!1)},d=function(e,t){e&&e.preventDefault(),localStorage.online="true",B.$name.html(t.nick||t.name),B.$avatar.html(t.avatar||""),localStorage.user=JSON.stringify(t),zp.model.configModule(t.name),console.log("online mode")},r=function(){zp.modal.configModule({set_cur_anchor:v}),zp.modal.initModule(B.$modal,"search").show(),I()},s=function(e,t){e.preventDefault(),v(t)},l=function(e,t){e.preventDefault(),zp.modal.initModule(B.$modal,"type",t).show()},M=function(){var e=y().current;A.act="reload","todo"===e||"plan"===e||"dday"===e?(v("day"),B.$toggle.html('<i class="fa fa-list"></i>')):(v("todo"),B.$toggle.html('<i class="fa fa-calendar"></i>'))},y=function(){return $.extend(!0,{},A.anchor_map)},g=function(e){var t,n,a=y(),o=!0;for(t in e)if(e.hasOwnProperty(t)){if(0===t.indexOf("_"))continue;a[t]=e[t],void 0===e[t]&&(delete e[t],delete a[t]),n="_"+t,e[n]?a[n]=e[n]:(delete a[n],delete a["_s"+n])}try{$.uriAnchor.setAnchor(a)}catch(i){console.warn("changeanchorpart",i),$.uriAnchor.setAnchor(A.anchor_map,null,!0),o=!1}return o},v=function(e,t){var n={current:e,date:t};return g(n)},k=function(){var e,t,n,a,o,i,r=y(),d={};console.info((new Date).getHours(),(new Date).getMinutes(),(new Date).getSeconds(),"해시 변경.");try{e=$.uriAnchor.makeAnchorMap()}catch(l){return console.warn("anchor_map_error",l),$.uriAnchor.setAnchor(r,null,!0),!1}if(void 0===e.current&&(e.current="day"),A.anchor_map=e,o=r._s_date,i=e._s_date,t=r._s_current,n=e._s_current,!Object.keys(r).length||t!==n||o!==i)switch(a=e.current){case"year":"reload"===A.act?(i&&(d.year=A.date_info.year=parseInt(i.substr(0,4),10)),_("year",d)):A.act="reload";break;case"month":"reload"===A.act?(i&&(d.year=A.date_info.year=parseInt(i.substr(0,4),10),d.month=A.date_info.month=parseInt(i.substr(4,2),10)),_("month",d)):A.act="reload";break;case"week":"reload"===A.act?(i&&(d.year=A.date_info.year=parseInt(i.substr(0,4),10),d.week=A.date_info.week=parseInt(i.substr(4,2),10)),_("week",d)):A.act="reload";break;case"day":"reload"===A.act?(i?(d.year=A.date_info.year=parseInt(i.substr(0,4),10),d.month=A.date_info.month=parseInt(i.substr(4,2),10),d.date=A.date_info.date=parseInt(i.substr(6,2),10)):(d.year=A.date_info.year,d.month=A.date_info.month,d.date=A.date_info.date),d.day=new Date(d.year,d.month-1,d.date).getDay(),d.week=zp.calendar.getWeekNum(d.date,d.month,d.year),_("day",d)):A.act="reload";break;case"plan":zp.plan.initModule(B.$flickPanel.eq(0)),zp.dday.initModule(B.$flickPanel.eq(1)),zp.todo.initModule(B.$flickPanel.eq(2)),A.current="plan",I(),p();break;case"todo":zp.todo.initModule(B.$flickPanel.eq(0)),zp.plan.initModule(B.$flickPanel.eq(1)),zp.dday.initModule(B.$flickPanel.eq(2)),A.current="todo",I(),p();break;case"dday":zp.dday.initModule(B.$flickPanel.eq(0)),zp.todo.initModule(B.$flickPanel.eq(1)),zp.plan.initModule(B.$flickPanel.eq(2)),A.current="dday",I(),p();break;default:delete e.current,delete e.date,$.uriAnchor.setAnchor(e,null,!0)}},I=function(){B.$flickPanel.eq(0).css("transform","translate3d(100%,0,0)"),B.$flickPanel.eq(1).css("transform","translate3d(200%,0,0)"),B.$flickPanel.eq(2).css("transform","translate3d(0%,0,0)"),A.fidx=0,F(),console.log("init")},F=function(){var e=B.$flickPanel.eq(A.fidx),t=e.height(),n=$(window).height()-B.$header.height()-1;B.$flickPanel.css({minHeight:n}),n>t&&(t=n),console.log("adjust",e,n,t),B.$flickView.css("height",t)},P=function(e){var t,n,a;A.fidx%=3,t=A.fidx,n=t+1,a=t-1,0===t&&(a=2),2===t&&(n=0),"left"===e?setTimeout(function(){B.$flickPanel.eq(a).css("transform","translate3d(0%,0,0)"),B.$flickCon.css({transform:"translate3d(0,0,0)",webkitTransition:"0ms"}),B.$flickPanel.eq(t).css("transform","translate3d(100%,0,0)"),B.$flickPanel.eq(n).css("transform","translate3d(200%,0,0)")},300):"right"===e&&setTimeout(function(){B.$flickPanel.eq(n).css("transform","translate3d(200%,0,0)"),B.$flickCon.css({transform:"translate3d(0,0,0)",webkitTransition:"0ms"}),B.$flickPanel.eq(t).css("transform","translate3d(100%,0,0)"),B.$flickPanel.eq(a).css("transform","translate3d(0%,0,0)")},300)},T=function(e,t){var n,a=Math.abs(t/e)>1;return n=a?1:0},N=function(e){return A.direction=void 0,A.gap_x=0,B.$flickCon.css({webkitTransition:"0ms",transition:"0ms"}),A.touch_start_x=e.originalEvent.touches[0].clientX,A.touch_x=e.originalEvent.touches[0].clientX,A.touch_start_y=e.originalEvent.touches[0].clientY,A.touch_y=e.originalEvent.touches[0].clientY,!0},j=function(e){B.$flickCon.css("pointer-events","none"),A.touch_x=e.originalEvent.touches[0].clientX,A.touch_y=e.originalEvent.touches[0].clientY,A.gap_x=A.touch_x-A.touch_start_x,A.gap_y=A.touch_y-A.touch_start_y,A.direction=A.direction||T(A.gap_x,A.gap_y),A.state="drag",0===A.direction?(B.$flickCon.css({transform:"translate3d("+A.gap_x+"px,0,0)"}),$("body").css({overflow:"hidden"}),e.preventDefault()):A.gap_x=0},q=function(){var e=$(window).width();$("body").css({overflow:"auto"}),B.$flickCon.css({"pointer-events":"auto"}),Math.abs(A.gap_x)>e/2.5?A.gap_x<0?(B.$flickCon.css({transform:"translate3d("+-e+"px,0,0)",transition:"300ms"}),A.fidx++,C("left",A.date_info)):(B.$flickCon.css({transform:"translate3d("+e+"px,0,0)",transition:"300ms"}),A.fidx--,C("right",A.date_info)):B.$flickCon.css({transform:"translate3d(0,0,0)",transition:"300ms"})},O=function(e,t,n,a,o){"string"==typeof e&&e.indexOf("Script error.")>-1||console.log("Error: ",e," Script: "+t+" Line: "+n+" Column: "+a+" StackTrace: "+o)},w=function(p){var g=localStorage.online?JSON.parse(localStorage.online):!1,y=localStorage.first?JSON.parse(localStorage.first):!1;$.uriAnchor.configModule({schema_map:J.anchor_schema_map}),localStorage.first=localStorage.first?JSON.parse(localStorage.first):JSON.stringify(!1),A.$container=p,b(p),g?d(window.event,JSON.parse(localStorage.user)):localStorage.user="anon",$(window).on("error",O).on("hashchange",k).trigger("hashchange").on("orientationchange resize",F),y&&u(),$.gevent.subscribe(B.$user,"login",d),$.gevent.subscribe(B.$container,"submit",s),$.gevent.subscribe(B.$main,"day",D),$.gevent.subscribe(B.$main,"week",x),$.gevent.subscribe(B.$main,"month",z),$.gevent.subscribe(B.$main,"year",S),$.gevent.subscribe(B.$modal,"cell",l),$.gevent.subscribe(B.$container,"panelLoaded",F),B.$user.on("click",c),B.$logout.on("click",a),B.$upload.on("click",o),B.$download.on("click",i),B.$option.on("click",t),B.$profile.on("click",n),B.$report.on("click",e),B.$toggle.on("click",M),B.$search.on("click",r),B.$info.on("click",".title-year",f),B.$info.on("click",".title-month",m),B.$info.on("click",".title-week",h),B.$flickView.on("touchstart",N).on("touchmove",j).on("touchend",q)},{initModule:w}}(),zp.day=function(){"use strict";var e,t,n,a={settable_map:{set_cur_anchor:!0},today:{year:(new Date).getFullYear(),month:(new Date).getMonth()+1,date:(new Date).getDate()},set_cur_anchor:null,tr_h:40},o={dayList:[],dayMap:{},update:!1,load_state:0},i={};return n=function(e,t,n){this.date=parseInt(t.date,10),this.month=parseInt(t.month,10),this.year=parseInt(t.year,10),this.dateStr=n,this.loadState=0,this.initiate(e,t)},n.prototype.initiate=function(e,t){e.html($("#zp-day").html()),this.setJqueryMap(e,this.dateStr),this.insertSchedule(t,this.dateStr),i[this.dateStr].$ddayTable.attr("data-date",this.dateStr),i[this.dateStr].$planTable.on("click",".todo, .plan, .dday",this.onClickPlan),i[this.dateStr].$planTable.on("click","td",t,this.onClickCell),console.log(this),console.info(this.dateStr,"object loaded.")},n.prototype.setJqueryMap=function(e,t){i[t]={$container:e,$ddayTable:e.find(".dday-table"),$planTable:e.find(".plan-table")}},n.prototype.checkLoadState=function(){
this.loadState++,console.log(this.loadState),4===this.loadState&&($.gevent.publish("panelLoaded"),this.loadState=0,o.dayList.push(this.dateStr),o.dayMap[this.dateStr]=i[this.dateStr],o.dayList.length>10&&delete o.dayMap[o.dayList.shift()])},n.prototype.addTimeIndicator=function(e){var t,n,o,r=(new Date).getHours(),d=(new Date).getMinutes(),l=$(".time-indicator");o=i[e].$ddayTable.find("tr").length,n=r*a.tr_h+d*a.tr_h/60+40*o,l.length&&l.remove(),t=$("<div/>").addClass("time-indicator").css({top:n}),i[e].$container.prepend(t)},n.prototype.insertSchedule=function(e,t){var n,o,r,d,l,s,c,u,p,f,m,h,g,y,v,k,w,b,_,D,x,z,S=$(document.createDocumentFragment()),M=this;return o=("0"+e.month).slice(-2),n=("0"+e.date).slice(-2),w=e.year+"-"+o+"-"+n,u=new Date(w),s=u.getTime(),u.setDate(u.getDate()+1),c=u.getTime(),y=zp.model.getTodo(s+"00000",c+"00000"),v=zp.model.getPlan(s+"00000",c+"00000"),k=zp.model.getDday(s+"00000",c+"00000"),k.done(function(e){for(g=0;g<e.length;g++)m=e[g],m&&(_=$("<tr/>").attr("data-id",m._id).append("<td/>"),_.find("td").addClass("dday").text(m.text),_.prependTo(S));S.appendTo(i[t].$ddayTable)}),k.fail(function(e){"not_found"!==e&&console.warn(e)}),k.always(function(){M.checkLoadState()}),y.done(function(e){for(g=0;g<e.length;g++)p=e[g],p&&(x=p.time.substr(0,2),z=p.time.substr(3,2),D=x*a.tr_h+z*a.tr_h/60+1,b=$("<div/>").addClass("todo").attr("data-id",p._id),b.css({top:D}).append($("<div/>")).find("div").addClass("input").text(p.text),b.appendTo(S));S.appendTo(i[t].$planTable)}),y.fail(function(e){"not_found"!==e&&console.warn(e)}),y.always(function(){M.checkLoadState()}),v.done(function(e){for(g=0;g<e.length;g++)f=e[g],f&&(r=new Date(f.startdate).getTime(),d=new Date(f.enddate).getTime(),l=new Date(w).getTime(),console.log(f,r,d,l,f.startdate,w),f.startdate===w?(console.log("startday"),x=f.starttime.substr(0,2),z=f.starttime.substr(3,2),D=x*a.tr_h+z*a.tr_h/60+1,b=$("<div/>").addClass("plan").attr("data-id",f._id),b.css({top:D}).append($("<div/>")).find("div").addClass("input").text(f.text+" 시작"),b.appendTo(i[t].$planTable)):l>r&&d>l?(console.log("between"),_=$("<tr/>").attr("data-id",f._id).append("<td/>"),_.find("td").addClass("whole").text(f.text),_.prependTo(i[t].$ddayTable)):f.enddate===w&&(console.log("endday"),x=f.endtime.substr(0,2),z=f.endtime.substr(3,2),D=x*a.tr_h+z*a.tr_h/60+1,b=$("<div/>").addClass("plan").attr("data-id",f._id),b.css({top:D}).append($("<div/>")).find("div").addClass("input").text(f.text+"끝"),b.appendTo(S)));S.appendTo(i[t].$planTable)}),v.fail(function(e){"not_found"!==e&&console.warn(e)}),v.always(function(){M.checkLoadState()}),w===a.today.year+"-"+("0"+a.today.month).slice(-2)+"-"+("0"+a.today.date).slice(-2)?(h=zp.model.getTodo("dateless"),h.done(function(e){for(g=0;g<e.length;g++)p=e[g],p&&(_=$("<tr/>").attr("data-id",p._id).append("<td/>"),_.find("td").addClass("dateless").text(p.text),_.prependTo(S));S.appendTo(i[t].$ddayTable),setInterval(M.addTimeIndicator(t),6e4)}),h.fail(function(e){"not_found"!==e&&console.warn(e)}),h.always(function(){M.checkLoadState()})):M.checkLoadState(),!0},n.prototype.onClickCell=function(e){var t=$(this).data("time"),n={year:e.data.year,month:e.data.month,date:e.data.date,time:t};$.gevent.publish("cell",[n])},n.prototype.onClickPlan=function(){var e=$(this).attr("class");"whole"===e&&(e="plan"),$.gevent.publish("submit",[e])},e=function(e){return zp.util.setConfigMap({input_map:e,settable_map:a.settable_map,config_map:a}),!0},t=function(e,t){var a=t.year+("0"+t.month).slice(-2)+("0"+t.date).slice(-2);return console.log(o.dayMap),new n(e,t,a)},{configModule:e,initModule:t}}(),zp.dday=function(){"use strict";var e,t,n,a,o,i,r,d,l,s,c,u,p={settable_map:{set_cur_anchor:!0},set_cur_anchor:null},f={$container:null,taphold:null},m={};return e=function(e){m={$container:e,$main:e.find("#dday-main")}},i=function(e){var t,n=new Date,a=zp.calendar.objectify(String(e)),o=new Date(a.year,a.month-1,a.date),i=o.getTime()-n.getTime();return i=Math.ceil(i/1e3/60/60/24),t=i>0?"D-"+i:0===i?"D-day":"D+"+Math.abs(i)},t=function(){var e,t,n,a,o,r,d,l,s,c,u=$(document.createDocumentFragment()),p=zp.model.getDday();return p.done(function(p){if($(c.el).remove(),p.length){for(m.$main.html(""),s=0;s<p.length;s++)a=p[s],a&&(l=a.target,t=$("<div/>").addClass("dday-item").attr("data-id",a._id),e=$("<div/>").addClass("dday-text").text(a.text),o=$("<div/>").addClass("dday-target").text(l),r=$("<div/>").addClass("dday-left").text(i(l)),n=$("<div/>").addClass("item-del").html('<i class="fa fa-trash-o"></i>'),d=$("<div/>").addClass("dday-option").append(n),t.append(r).append(e).append(o).append(d),u.append(t));m.$main.append(u)}}),p.fail(function(e){$(c.el).remove(),"not_found"===e?m.$main.html('<div class="no-content">기념일이나 D-day를 작성해주세요</div>'):alert(e)}),c=(new Spinner).spin(),m.$main.append(c.el),!0},o=function(){var e,t=$(this).closest(".dday-item"),n=t.data("id");return confirm("삭제하시겠습니까?")?(e=zp.model.deleteItem(n),e.done(function(){t.remove()}),e.fail(function(){alert("오류 발생")}),!0):!1},l=function(e){return console.log("holdtap"),e.stopImmediatePropagation(),f.taphold=setTimeout(function(){"dday-text"===e.target.className?d(e.target):"dday-target"===e.target.className&&r(e.target)},1e3),!1},s=function(e){return console.log("holdstop"),e.stopPropagation(),clearTimeout(f.taphold),!1},r=function(e){var t=$(e).text();$(e).empty().append('<input type="text" value="'+t+'"/>'),$(e).find("input").focus().on("blur",{target:e,origin:t},c)},d=function(e){var t=$(e).text();$(e).empty().append('<input type="text" value="'+t+'"/>'),$(e).find("input").focus().on("blur",{target:e,origin:t},u)},c=function(e){var t,n,a=e.data,o=$(a.target),i=o.find("input").val();return a.origin===i?void o.empty().text(a.origin):(o.empty().text(i),t=o.parent(".dday-item").data("id"),void(n=i.substr(0,10)))},u=function(e){var t,n,a,o=e.data,i=$(o.target),r=i.find("input").val();return o.origin===r?void i.empty().text(o.origin):(i.empty().text(r),t=JSON.parse(localStorage.change),n=JSON.parse(localStorage.dday),a=i.parent(".dday-item").data("id"),alert(a),n[a].text=r,t.u.push({cidx:a,type:"dday"}),localStorage.dday=JSON.stringify(n),void(localStorage.change=JSON.stringify(t)))},n=function(e){zp.util.setConfigMap({input_map:e,settable_map:p.settable_map,config_map:p})},a=function(n){return n.html($("#zp-dday").html()),f.$container=n,e(n),t(),m.$main.on("click",".item-del",o),m.$main.on("touchstart",".dday-target, .dday-text",l),m.$main.on("touchend",".dday-target, .dday-text",s),n},{configModule:n,initModule:a,calculate:i}}(),zp.modal=function(){"use strict";var e,t,n,a,o,i,r,d,l,s,c,u,p,f,m,h,g,y,v,k,w,b,_,D,x,z,S,M,C={settable_map:{set_cur_anchor:!0},set_cur_anchor:null,today:{year:(new Date).getFullYear(),month:(new Date).getMonth()+1,date:(new Date).getDate()}},I={$container:null,year:(new Date).getFullYear(),month:(new Date).getMonth()+1,date:(new Date).getDate(),hour:(new Date).getHours(),minute:(new Date).getMinutes()},P={};return e=function(e){P={$container:e,$closeBtn:e.find(".modal-close"),$backBtn:e.find(".modal-back"),$loginSbmt:e.find("#login-sbmt"),$todoSbmt:e.find("#todo-sbmt"),$planSbmt:e.find("#plan-sbmt"),$ddaySbmt:e.find("#dday-sbmt"),$joinBtn:e.find("#join-btn"),$findPassBtn:e.find("#findpw-btn"),$offlineBtn:e.find("#offline-btn"),$typeTodo:e.find("#type-todo"),$datelessChkbx:e.find("#todo-input-dateless"),$typePlan:e.find("#type-plan"),$typeDday:e.find("#type-dday"),$checkIdBtn:e.find("#check-id-btn"),$joinSbmt:e.find("#join-sbmt"),$findIdForm:e.find("#findpw-id-form"),$findIdBtn:e.find("#findpw-id-sbmt"),$answerChkForm:e.find("#findpw-qst-form"),$answerChkBtn:e.find("#findpw-ans-sbmt"),$newPassForm:e.find("#findpw-newpw-form"),$newPassBtn:e.find("#findpw-newpw-sbmt"),$repeat:e.find("#plan-input-repeat"),$repeatType:e.find('input[name="repeat-type"]'),$search:e.find("#search-btn"),$today:e.find("#search-today")}},g=function(e){var t,n,a,o=$(this).parent(),i=o.find("#login-id"),r=o.find("#login-pw"),d=i.val(),l=r.val();return e.preventDefault(),""===d.trim()?(alert("아이디를 입력해주십시오."),i.focus(),!1):""===l?(alert("비밀번호를 입력해주십시오."),r.focus(),!1):(t={id:d,pw:l},n=zp.model.login(t),n.done(function(e){$(a.el).remove(),alert("로그인 성공!"),P.$container.hide(),$.gevent.publish("login",[e]),confirm("서버의 데이터와 동기화하시겠습니까?")&&zp.model.sync(d)}),n.fail(function(){return $(a.el).remove(),alert("아이디가 없거나 패스워드가 틀렸습니다."),i.val("").focus(),r.val(""),!1}),a=(new Spinner).spin(),void P.$container.append(a.el))},i=function(e){zp.modal.initModule(P.$container,"todo-modal",e.data)},r=function(e){zp.modal.initModule(P.$container,"plan-modal",e.data)},d=function(e){zp.modal.initModule(P.$container,"dday-modal",e.data)},v=function(){$.gevent.publish("zp-offline",[]),P.$container.hide()},a=function(){P.$container.empty().hide()},o=function(){zp.modal.initModule(P.$container,"login")},D=function(){zp.modal.initModule(P.$container,"findpw")},x=function(e){var t,n={id:P.$findIdForm.find("#findpw-id").val()};return e.preventDefault(),t=zp.model.findId(n.id),t.done(function(e){P.$findIdForm.find("#findpw-id").prop("readonly",!0),P.$answerChkForm.show(),P.$answerChkForm.find("#findpw-ans").focus(),P.$answerChkForm.find("#findpw-qst").html(e.qst)}),t.fail(function(){alert("아이디가 없습니다.")}),!1},z=function(e){var t,n={id:P.$findIdForm.find("#findpw-id").val(),ans:P.$answerChkForm.find("#findpw-ans").val()};e.preventDefault(),n.ans||(alert("답변을 입력해주세요"),P.$answerChkForm.find("#findpw-ans").focus()),t=zp.model.checkAnswer(n),t.done(function(){P.$newPassForm.show(),P.$newPassForm.find("#findpw-newpw").focus()}),t.fail(function(e){"wrong answer"===e&&(alert("답변이 틀렸습니다."),P.$answerChkForm.find("#findpw-ans").val("").focus())})},M=function(e){var t,n,a=P.$newPassForm.find("#findpw-newpw"),o=P.$newPassForm.find("#findpw-newpwchk");return e.preventDefault(),t={id:P.$findIdForm.find("#findpw-id").val(),pw:a.val()},t.pw!==o.val()?(alert("비밀번호와 비밀번호 확인이 일치하지 않습니다"),void a.focus()):(n=zp.model.changePw(t),n.done(function(){alert("변경되었습니다!"),zp.modal.initModule(P.$container,"login")}),void n.fail(function(e){console.log(e),"not_found"===e.name&&alert("권한 오류!")}))},y=function(){zp.modal.initModule(P.$container,"join")},S=function(e){var t,n=$(e.target).prev().val();return""===n?(alert("아이디를 입력해주세요."),!1):(t=zp.model.checkId(n),t.fail(function(){return alert("이미 사용하고 있는 아이디입니다."),!1}),void t.done(function(e){console.log(e),"not_found"===e.name?(alert("사용하셔도 좋습니다!"),$("#join-agree").removeAttr("disabled")):alert("오류가 발생했습니다. 다시 시도해주세요.")}))},k=function(e){var t=/^[\-A-Za-z0-9_]+[\-A-Za-z0-9_.]*@[\-A-Za-z0-9_]+[\-A-Za-z0-9_.]*\.[A-Za-z]{2,5}$/,n=e||$(this).val();return""===n?!1:"string"!=typeof n||""===n?(alert("이메일이 문자열이 아니거나 빈칸입니다."),!1):-1===n.search(t)?(alert("이메일 형식에 맞지 않습니다."),!1):!0},_=function(e){var t,n,a=$("#join-id"),o=$("#join-email"),i=$("#join-name"),r=$("#join-pw"),d=$("#join-pwc"),l=$("#join-qst"),s=$("#join-ans"),c=$("#join-agree"),u={id:a.val(),email:o.val(),pw:r.val(),nick:i.val(),qst:l.val(),ans:s.val(),avatar:"z"};return e.preventDefault(),u.id.trim()?u.email.trim()?u.nick.trim()?u.pw?u.qst.trim()?u.ans?u.pw!==d.val()?(alert("비밀번호 확인이 일치하지 않습니다."),r.focus(),!1):(c.prop("disabled")&&alert("중복확인을 해주세요."),c.is(":checked")?(t=zp.model.join(u),t.done(function(e){$(n.el).remove(),console.log(e),alert("회원이 되신 것을 축하드립니다!")}),t.fail(function(e){$(n.el).remove(),console.log(e),alert("오류가 발생했습니다. 다시 시도해주세요.")}),n=(new Spinner).spin(),void P.$container.append(n.el)):(alert("약관에 동의하셔야 합니다."),c.focus(),!1)):(alert("답변을 입력해주세요."),s.focus(),!1):(alert("질문을 입력해주세요."),l.focus(),!1):(alert("비밀번호를 입력해주세요."),r.focus(),!1):(alert("닉네임을 입력해주세요."),i.focus(),!1):(alert("이메일을 입력해주세요."),o.focus(),!1):(alert("아이디를 입력해주세요."),a.focus(),!1)},f=function(e){var t,n,a,o=$(this).prev("#search-date").val();return e.preventDefault(),o?(t=o.substr(0,4),n=o.substr(5,2),a=o.substr(8,2),""===a||"00"===a?""===n||"00"===n?C.set_cur_anchor("year",t):C.set_cur_anchor("month",t+n):C.set_cur_anchor("day",t+n+a),void P.$container.empty().hide()):(alert("날짜를 입력하세요"),!0)},w=function(e){var t,n,a;e.preventDefault(),n=C.today.month,a=C.today.date,10>n&&(n="0"+n),10>a&&(a="0"+a),t=String(C.today.year)+n+a,C.set_cur_anchor("day",t),P.$container.empty().hide()},u=function(){$(this).next().toggle()},m=function(){var e=$("#plan-repeat-everyweek"),t=$("#plan-repeat-everymonth"),n=e.find("input[name=repeat-day]");"everyday"===$(this).val()?(n.prop("checked",!0),e.hide()):"everyweek"===$(this).val()?(n.prop("checked",!1),e.show()):"everymonth"===$(this).val()&&(n.prop("checked",!1),t.show())},p=function(){var e=$(this).parent().find("#plan-input-enddate");""===e.val()&&e.val($(this).val())},b=function(){return("0000"+Math.floor(1e4*Math.random()+1)).slice(-5)},h=function(){var e=$(this).is(":checked");e?(P.$container.find("#todo-input-date").prop("disabled",!0),P.$container.find("#todo-input-time").prop("disabled",!0)):(P.$container.find("#todo-input-date").prop("disabled",!1),P.$container.find("#todo-input-time").prop("disabled",!1))},l=function(e){var t,n,a=$(this).parent(),o=a.find("#todo-input-date").val(),i=a.find("#todo-input-time").val(),r=a.find("#todo-input-text").val(),d=a.find("#todo-input-dateless").is(":checked");return e.preventDefault(),""===o||""===i||""===r?(alert("빈칸이 있습니다."),!1):(t={_id:new Date(o+" "+i).getTime()+b(),date:o,time:i,text:r,done:!1,alarm:!1,type:"todo"},d===!0&&(t.date="dateless",t.time="dateless",t._id=(new Date).getTime()+b()),n=zp.model.setTodo(t),n.done(function(){P.$container.empty().hide(),console.log("successfully submit todo",n),$.gevent.publish("submit",["todo"])}),void n.fail(function(){alert("error!")}))},s=function(e){var t,n,a,o,i,r,d,l,s,c,u,p,f,m,h,g,y,v,k,w,_,D,x,z,S,M=$(this).parent(),C=M.find("#plan-input-startdate").val(),I=M.find("#plan-input-starttime").val(),P=M.find("#plan-input-enddate").val(),T=M.find("#plan-input-endtime").val(),q=M.find("#plan-input-text").val(),j=[];if(e.preventDefault(),""===C||""===q)return alert("빈칸이 있습니다"),!1;if(T||(n=new Date(C+" "+I),n.setHours(n.getHours()+1),a=("0"+(n.getMonth()+1)).slice(-2),o=("0"+n.getDate()).slice(-2),i=("0"+n.getHours()).slice(-2),r=("0"+n.getMinutes()).slice(-2),P=n.getFullYear()+"-"+a+"-"+o,T=i+":"+r),t={_id:new Date(C+" "+I).getTime()+b(),startdate:C,starttime:I,enddate:P,endtime:T,text:q,plan_idx:b(),type:"plan"},u=$.extend({},t),j.push(u),M.find("#plan-input-repeat").is(":checked"))if(M.find("#repeat-type-everymonth").is(":selected"))t.week=M.find('input[name="repeat-month"]:checked').map(function(){return parseInt($(this).val(),10)}).get();else{for(t.num=M.find("#plan-input-number").val(),t.lastdate=M.find("#plan-input-lastdate").val(),t.day=M.find('input[name="repeat-day"]:checked').map(function(){return parseInt($(this).val(),10)}).get(),d=zp.calendar.objectify(t.startdate),p=new Date(d.year,d.month-1,d.date).getDay(),f=t.day.length,l=0;f>l;l++)if(p===t.day[l]){c=l;break}if(m=t.day.slice(0,c),t.day=t.day.slice(c,f).concat(m),t.day=t.day.map(function(e,n){var a,o=t.day[n+1]||t.day[0];return a=o-e,0>a&&(a+=7),a}),t.lastdate)for(h=new Date(t.startdate+" "+t.starttime),S=new Date(t.lastdate+" 00:00:00");h.getTime()<S.getTime();)console.log(h.toISOString(),S.toISOString()),h=new Date(t.startdate+" "+t.starttime),h.setDate(h.getDate()+t.day[l%f]),v=("0"+(h.getMonth()+1)).slice(-2),k=("0"+h.getDate()).slice(-2),y=("0"+h.getHours()).slice(-2),w=("0"+h.getMinutes()).slice(-2),g=new Date(t.enddate+" "+t.endtime),g.setDate(g.getDate()+t.day[l%f]),D=("0"+(g.getMonth()+1)).slice(-2),x=("0"+g.getDate()).slice(-2),_=("0"+g.getHours()).slice(-2),z=("0"+g.getMinutes()).slice(-2),s=Object.create(t),s.text=t.text,s.type="plan",s.plan_idx=t.plan_idx,s._id=h.getTime()+b(),t.startdate=s.startdate=h.getFullYear()+"-"+v+"-"+k,t.starttime=s.starttime=y+":"+w,t.enddate=s.enddate=g.getFullYear()+"-"+D+"-"+x,t.endtime=s.endtime=_+":"+z,j.push(s);if(t.num)for(l=0;l<t.num;l++)h=new Date(t.startdate+" "+t.starttime),h.setDate(h.getDate()+t.day[l%f]),v=("0"+(h.getMonth()+1)).slice(-2),k=("0"+h.getDate()).slice(-2),y=("0"+h.getHours()).slice(-2),w=("0"+h.getMinutes()).slice(-2),g=new Date(t.enddate+" "+t.endtime),g.setDate(g.getDate()+t.day[l%f]),D=("0"+(g.getMonth()+1)).slice(-2),x=("0"+g.getDate()).slice(-2),_=("0"+g.getHours()).slice(-2),z=("0"+g.getMinutes()).slice(-2),s=Object.create(t),s.text=t.text,s.type="plan",s.plan_idx=t.plan_idx,s._id=h.getTime()+b(),t.startdate=s.startdate=h.getFullYear()+"-"+v+"-"+k,t.starttime=s.starttime=y+":"+w,t.enddate=s.enddate=g.getFullYear()+"-"+D+"-"+x,t.endtime=s.endtime=_+":"+z,console.log(s.text,s.plan,s),j.push(s)}return console.log(j),!1},c=function(e){var t,n,a=$(this).parent(),o=a.find("#dday-input-target").val(),i=a.find("#dday-input-text").val(),r=a.find("#dday-input-repeat").is(":checked");return e.preventDefault(),""===o||""===i?(alert("빈칸이 있습니다"),!1):(t={_id:new Date(o).getTime()+b(),target:o,text:i,repeat:r,type:"dday"},n=zp.model.setDday(t),n.done(function(e){console.log(e),P.$container.empty().hide(),$.gevent.publish("submit",["dday"]),console.log("dday registered",n)}),n.fail(function(e){console.log(e),alert("오류 발생")}),!1)},t=function(e){zp.util.setConfigMap({input_map:e,settable_map:C.settable_map,config_map:C})},n=function(t,n,b){var C;if("string"!=typeof n)throw"initModule argument type error";return""===n&&(n="login"),t.html($("#zp-"+n).html()),I.$container=t,e(t),b&&("type"===n&&t.find("h2").html(b.year+"-"+b.month+"-"+b.date+" "+b.time),("todo-modal"===n||"plan-modal"===n||"dday-modal"===n)&&(b.month=b.month<10?"0"+b.month:b.month,b.date=b.date<10?"0"+b.date:b.date,C=b.year+"-"+b.month+"-"+b.date,b.time=4===b.time.length?"0"+b.time:b.time,"todo-modal"===n?(t.find("#todo-input-date").val(C),t.find("#todo-input-time").val(b.time)):"plan-modal"===n?(t.find("#plan-input-startdate").val(C),t.find("#plan-input-starttime").val(b.time)):"dday-modal"===n&&t.find(".dday-input-target").val(C))),$(document).on("blur","#join-email",k),P.$closeBtn.on("click",a),P.$loginSbmt.on("click",g),P.$repeat.on("click",u),P.$todoSbmt.on("click",b,l),P.$planSbmt.on("click",b,s),P.$ddaySbmt.on("click",b,c),P.$datelessChkbx.on("click",h),P.$planSbmt.parent().find("#plan-input-startdate").on("blur",p),P.$typeTodo.on("click",b,i),P.$typePlan.on("click",b,r),P.$typeDday.on("click",b,d),P.$joinBtn.on("click",y),P.$backBtn.on("click",o),P.$joinSbmt.on("click",_),P.$checkIdBtn.on("click",S),P.$findPassBtn.on("click",D),P.$findIdBtn.on("click",x),P.$answerChkBtn.on("click",z),P.$newPassBtn.on("click",M),P.$offlineBtn.on("click",v),P.$search.on("click",f),P.$today.on("click",w),P.$repeatType.on("change",m),t},{configModule:t,initModule:n}}(),zp.month=function(){var e,t,n,a={settable_map:{set_cur_anchor:!0},set_cur_anchor:null},o={monthList:[],monthMap:{}},i={};return n=function(e,t,n){this.month=parseInt(t.month,10),this.year=parseInt(t.year,10),this.dateStr=n,this.initiate(e,t)},n.prototype.initiate=function(e,t){e.html($("#zp-month").html()),console.log("month",this.dateStr),this.setJqueryMap(e,this.dateStr),this.insertCalendar(t.month,t.year),i[this.dateStr].$month.attr("data-date",this.dateStr),i[this.dateStr].$month.find("td").on("click",t,this.onClickDate),i[this.dateStr].$month.find("tbody th").on("click",t,this.onClickWeek)},n.prototype.setJqueryMap=function(e,t){i[t]={$month:e.find(".month-calendar")}},n.prototype.insertCalendar=function(e,t){var n={month:e,year:t};return zp.calendar.initModule(i[this.dateStr].$month,n),this.insertPlan(this.dateStr),o.monthList.push(this.dateStr),o.monthMap[this.dateStr]=i[this.dateStr].$container,!0},n.prototype.insertPlan=function(e){var t,n,a,o,r,d,l,s,c,u,p,f,m,h,g,y,v,k,w,b,_,D,x,z,S,M,C,I,P=parseInt(e.substr(0,4),10),T=parseInt(e.substr(4,2),10);return l=e.substr(0,4)+"-"+e.substr(4,2),d=new Date(l),o=d.getTime(),d.setMonth(d.getMonth()+1),r=d.getTime(),k=zp.model.getPlan(o+"00000",r+"00000"),w=zp.model.getDday(o+"00000",r+"00000"),v=zp.model.getTodo(o+"00000",r+"00000"),k.done(function(t){for(s=0;s<t.length;s++)a=t[s],console.log(a),a&&(b=a.startdate,S=new Date(b).getTime(),_=parseInt(b.substr(5,2),10),D=b.substr(8,2),x=a.enddate,M=new Date(x).getTime(),z=parseInt(x.substr(5,2),10),C=(M-S)/1e3/60/60/24,T>=_&&z>=T&&(m=i[e].$month.find("td"),m.each(function(){if($(this).find("div").eq(0).text()===D)for(h=$(this).index(),y=$("<div/>").addClass("month-plan").text(a.text),I=$(this).parent().children(),I.eq(h).append(y.clone()),console.log(h,C,I);C>0;)h++,console.log(I.eq(h)),I.eq(h).length?I.eq(h).append(y.clone()):(h=1,I=I.parent().next().children(),I.eq(h).append(y.clone())),console.log(h,C,I),C--})))}),k.fail(function(e){console.log(e)}),w.done(function(t){for(s=0;s<t.length;s++)n=t[s],n&&(c=n.target,u=parseInt(c.substr(0,4),10),p=parseInt(c.substr(5,2),10),f=c.substr(8,2),m=i[e].$month.find("td"),console.log(n),m.each(function(){$(this).find("div").eq(0).text()===f&&(console.log(f,$(this).find("div").eq(0).text()),y=$("<div/>").addClass("month-dday").text(n.text),$(this).append(y))}))}),w.fail(function(e){console.log(e)}),v.done(function(n){for(s=0;s<n.length;s++)t=n[s],t&&(g=t.date,u=parseInt(g.substr(0,4),10),p=parseInt(g.substr(5,2),10),f=g.substr(8,2),u===P&&p===T&&(m=i[e].$month.find("td"),m.each(function(){$(this).find("div").eq(0).text()===f&&(y=$("<div/>").addClass("month-todo").text(t.text),t.done?y.addClass("month-done"):new Date(g).getTime()<(new Date).getTime()&&y.addClass("month-due"),$(this).append(y))})))}),v.fail(function(e){console.log(e)}),!0},n.prototype.onClickWeek=function(e){var t,n=parseInt(("0"+parseInt($(this).html(),10)).slice(-2),10),a=e.data.year;return"&nbsp;"===n?!1:("0"===n&&(a--,n=zp.calendar.getWeekNum(31,12,a)),t={week:n,year:a},void $.gevent.publish("week",[t]))},n.prototype.onClickDate=function(e){var t,n=parseInt($(this).find("div").eq(0).text(),10),a=e.data.month,o=e.data.year;isNaN(n)||(t={date:n,month:a,year:o},$.gevent.publish("day",[t]))},e=function(e){zp.util.setConfigMap({input_map:e,settable_map:a.settable_map,config_map:a})},t=function(e,t){var a=t.year+("0"+t.month).slice(-2);return new n(e,t,a)},{configModule:e,initModule:t}}(),zp.plan=function(){var e,t,n,a,o,i,r,d,l,s,c,u,p,f={settable_map:{set_cur_anchor:!0},set_cur_anchor:null},m={$container:null,taphold:null},h={};return e=function(e){h={$container:e,$main:e.find("#plan-main")}},a=function(){var e,t,n,a,o,i,r,d,l,s,c,u,p,f,m,g,y,v=$(document.createDocumentFragment());r=zp.model.getPlan(),r.done(function(r){if($(d.el).remove(),r.length){for(h.$main.html(""),i=0;i<r.length;i++)e=r[i],e&&(t=e.startdate,n=e.starttime,a=e.enddate,o=e.endtime,l=t+" "+n,s=a+" "+o,c=$("<div/>").addClass("plan-item").attr("data-id",e._id).attr("data-pid",e.plan_idx),u=$("<div/>").addClass("plan-option"),p=$("<div/>").addClass("item-del").html('<i class="fa fa-trash-o"></i>'),f=$("<div/>").addClass("item-alarm").html('<i class="fa fa-alarm"></i>'),m=$("<div/>").addClass("plan-text").text(e.text),g=$("<div/>").addClass("plan-start").text(l),y=$("<div/>").addClass("plan-end").text(s),u.append(p).append(f),c.append(g).append(y).append(m).append(u),v.append(c));h.$main.append(v)}}),r.fail(function(e){$(d.el).remove(),"not_found"===e?h.$main.html('<div class="no-content">일정을 작성해주세요</div>'):alert(e)}),d=(new Spinner).spin(),h.$main.append(d.el)},o=function(){var e,t=$(this).closest(".plan-item"),n=t.data("id"),a=t.data("pid"),o=t.parent().find("[data-pid="+a+"]");if(confirm("정말 삭제하시겠습니까?")){if(confirm("이 종류의 일정을 모두 삭제하시겠습니까?"))return e=zp.model.deletePlans(a),e.done(function(){o.remove()}),void e.fail(function(e){console.log(e)});e=zp.model.deleteItem(n),e.done(function(){t.remove()}),e.fail(function(){alert("오류 발생")})}},l=function(e){return console.log("holdtap"),e.stopImmediatePropagation(),m.taphold=setTimeout(function(){"plan-text"===e.target.className?d(e.target):"plan-start"===e.target.className?i(e.target):"plan-end"===e.target.className&&r(e.target)},1e3),!1},s=function(e){return console.log("holdstop"),e.stopPropagation(),clearTimeout(m.taphold),!1},i=function(e){var t=$(e).text();$(e).empty().append('<input type="text" value="'+t+'"/>'),$(e).find("input").focus().on("blur",{target:e,origin:t},c)},r=function(e){var t=$(e).text();$(e).empty().append('<input type="text" value="'+t+'"/>'),$(e).find("input").focus().on("blur",{target:e,origin:t},u)},d=function(e){var t=$(e).text();$(e).empty().append('<input type="text" value="'+t+'"/>'),$(e).find("input").focus().on("blur",{target:e,origin:t},p)},c=function(e){var t,n,a,o,i,r=e.data,d=$(r.target),l=d.find("input").val();return r.origin===l?void d.empty().text(r.origin):(d.empty().text(l),t=JSON.parse(localStorage.change),n=JSON.parse(localStorage.plan),a=d.parent(".plan-item").data("id"),o=l.substr(0,10),i=l.substr(11,8),alert(a),n[a].startdate=o,n[a].starttime=i,t.u.push({cidx:a,type:"plan"}),localStorage.plan=JSON.stringify(n),void(localStorage.change=JSON.stringify(t)))},u=function(e){var t,n,a,o,i,r=e.data,d=$(r.target),l=d.find("input").val();return r.origin===l?void d.empty().text(r.origin):(d.empty().text(l),t=JSON.parse(localStorage.change),n=JSON.parse(localStorage.plan),a=d.parent(".plan-item").data("id"),o=l.substr(0,10),i=l.substr(11,8),alert(a),n[a].enddate=o,n[a].endtime=i,t.u.push({cidx:a,type:"plan"}),localStorage.plan=JSON.stringify(n),void(localStorage.change=JSON.stringify(t)))},p=function(e){var t,n,a,o=e.data,i=$(o.target),r=i.find("input").val();return o.origin===r?void i.empty().text(o.origin):(i.empty().text(r),t=JSON.parse(localStorage.change),n=JSON.parse(localStorage.plan),a=i.parent(".plan-item").data("id"),alert(a),n[a].text=r,t.u.push({cidx:a,type:"plan"}),localStorage.plan=JSON.stringify(n),void(localStorage.change=JSON.stringify(t)))},t=function(e){zp.util.setConfigMap({input_map:e,settable_map:f.settable_map,config_map:f})},n=function(t){t.html($("#zp-plan").html()),m.$container=t,e(t),a(),h.$main.on("click",".item-del",o),h.$main.on("touchstart",".plan-text, .plan-start, .plan-end",l),h.$main.on("touchend",".plan-text, .plan-start, .plan-end",s)},{configModule:t,initModule:n}}(),zp.todo=function(){"use strict";var e,t,n,a,o,i,r,d,l,s,c,u,p,f,m,h,g={settable_map:{set_cur_anchor:!0},set_cur_anchor:null},y={$container:null,totalCount:0,failCount:0},v={};return e=function(e){v={$container:e,$main:e.find("#todo-main"),$dateless:e.find("#todo-dateless"),$normal:e.find("#todo-normal")}},t=function(){var e,t,n,a,o,i,r,l,s,c,u,p,f,m,h,g,y=$(document.createDocumentFragment()),k=y.clone();return g=zp.model.getTodo("dateless"),g.done(function(i){if($(h.el).remove(),i.length){for(y.append('<div class="subheader"><i class="fa fa-caret-down"></i>무기한</div>').append("<div/>"),f=0;f<i.length;f++)s=i[f],s&&(u=s.date,p=s.time,l=s.done,c=u+" "+p,a=$("<div/>").addClass("dateless-item").attr("data-id",s._id),n=$("<div/>").addClass("dateless-done").append('<input type="checkbox" size="3">'),o=$("<div/>").addClass("item-del").html('<i class="fa fa-trash-o"></i>'),r=$("<div/>").addClass("dateless-option").append(o),t=$("<div/>").addClass("dateless-text").text(s.text),a.append(n).append(t).append(r).append(e),y.find("div").eq(1).append(a));v.$dateless.append(y)}d(!0)}),g.fail(function(e){$(h.el).remove(),"not_found"===e?d(!1):alert(e)}),m=zp.model.getTodo(),m.done(function(m){if($(h.el).remove(),m.length){for(k.append('<div class="subheader"><i class="fa fa-caret-down"></i>할일들</div>').append("<div/>"),f=0;f<m.length;f++)s=m[f],s&&(u=s.date,p=s.time,l=s.done,c=u+" "+p,a=$("<div/>").addClass("todo-item").attr("data-id",s._id),n=$("<div/>").addClass("todo-done").append('<input type="checkbox" size="3">'),o=$("<div/>").addClass("item-del").html('<i class="fa fa-trash-o"></i>'),i=$("<div/>").addClass("item-alarm").html('<i class="fa fa-bell-o"></i>'),s.alarm===!0&&i.addClass("set"),r=$("<div/>").addClass("todo-option").append(o).append(i),t=$("<div/>").addClass("todo-text").text(s.text),e=$("<div/>").addClass("todo-due").text(c),new Date(c).getTime()<(new Date).getTime()&&t.addClass("item-due"),l&&(n.find("input").prop("checked",!0),t.addClass("item-done")),a.append(n).append(t).append(r).append(e),k.find("div").eq(1).append(a));v.$normal.append(k),d(!0)}}),m.fail(function(e){$(h.el).remove(),"not_found"===e?d(!1):alert(e)}),h=(new Spinner).spin(),v.$main.append(h.el),!0},d=function(e){y.totalCount++,e||y.failCount++,2===y.totalCount&&(2===y.failCount&&v.$dateless.html('<div class="no-content">할일을 작성해주세요</div>'),y.totalCount=0,y.failCount=0)},h=function(){var e=$(this);e.hasClass("fa-caret-down")?(e.parent().next().hide(),e.removeClass("fa-caret-down"),e.addClass("fa-caret-right")):e.hasClass("fa-caret-right")&&(e.parent().next().show(),e.addClass("fa-caret-down"),e.removeClass("fa-caret-right"))},o=function(){var e=$(this).parent().next(),t=$(this).closest(".todo-item").data("id");return $(this).is(":checked")?($(this).prop("checked",!0),e.addClass("item-done"),zp.model.updateItem(t,{done:!0})):($(this).prop("checked",!1),e.removeClass("item-done"),zp.model.updateItem(t,{done:!1})),!0},i=function(){var e,t=$(this).closest(".todo-item"),n=t.data("id");return confirm("삭제하시겠습니까?")?(e=zp.model.deleteItem(n),e.done(function(){t.remove()}),e.fail(function(){alert("오류 발생")}),!0):!1},m=function(){var e,t,n={Android:/Android/,iOS:/like Mac OS X/};for(t in n)n.hasOwnProperty(t)&&n[t].test(navigator.userAgent)&&(e=t);return"Android"===e||"iOS"===e},r=function(){if(m()){var e=$(this),t=e.closest(".todo-item"),n=t.data("id");if(e.hasClass("set"))cordova.plugins.notification.local.cancel(n,function(){}),e.removeClass("set"),zp.model.updateItem(n,{alarm:!1}),e.css("color","silver");else{var a=t.find(".todo-text").text(),o=t.find(".todo-due").text();cordova.plugins.notification.local.schedule({id:n,text:a,at:new Date(o),sound:"../sound.mp3"}),zp.model.updateItem(n,{alarm:!0}),e.addClass("set"),e.css("color","black"),console.log((new Date).getTime(),new Date(o).getTime())}return!1}return alert("모바일에서만 가능한 기능입니다"),!1},c=function(e){return console.log("holdtap"),y.taphold=setTimeout(function(){"todo-text"===e.target.className?s(e.target):"todo-due"===e.target.className&&l(e.target)},1e3),!1},u=function(){return console.log("holdstop"),clearTimeout(y.taphold),!1},l=function(e){var t=$(e).text();$(e).empty().append('<input type="text" value="'+t+'"/>'),$(e).find("input").focus().on("blur",{target:e,origin:t},p)},p=function(e){var t,n,a,o=e.data,i=$(o.target),r=i.find("input").val(),d=i.parent(".todo-item").data("idx");return o.origin===r?void i.empty().text(o.origin):(i.empty().text(r),t=r.substr(0,10),n=r.substr(11,8),a=zp.model.updateItem(d,{date:t,time:n}),void a.fail(function(e){console.log(e)}))},s=function(e){var t=$(e).text();$(e).empty().append('<input type="text" value="'+t+'"/>'),$(e).find("input").focus().on("blur",{target:e,origin:t},f)},f=function(e){var t,n=e.data,a=$(n.target),o=a.find("input").val(),i=a.parent(".todo-item").data("id");return n.origin===o?void a.empty().text(n.origin):(a.empty().text(o),t=zp.model.updateItem(i,{text:o}),void t.fail(function(e){console.log("todo update fail",e)}))},n=function(e){zp.util.setConfigMap({input_map:e,settable_map:g.settable_map,config_map:g})},a=function(n){return n.html($("#zp-todo").html()),y.$container=n,e(n),t(),v.$main.on("click","input[type=checkbox]",o),v.$main.on("click",".subheader i.fa",h),v.$main.on("click",".item-del",i),v.$main.on("click",".item-alarm",r),v.$main.on("touchstart",".todo-text, .todo-due",c),v.$main.on("touchmove",".todo-text, .todo-due",u),v.$main.on("touchend",".todo-text, .todo-due",u),n},{configModule:n,initModule:a}}(),zp.week=function(){var e,t,n,a={settable_map:{set_cur_anchor:!0},set_cur_anchor:null,tr_h:30},o={weekList:[],weekMap:{}},i={};return n=function(e,t,n){this.week=parseInt(t.week,10),this.year=parseInt(t.year,10),this.dateStr=n,this.initiate(e,t)},n.prototype.initiate=function(e,t){e.html($("#zp-week").html()),this.setJqueryMap(e,this.dateStr),this.insertDate(this.week,this.year),i[this.dateStr].$week.attr("data-week",this.dateStr),i[this.dateStr].$thead.on("click",t,this.onClickDate);

},n.prototype.setJqueryMap=function(e,t){i[t]={$week:e.find(".week-table"),$thead:e.find("thead th"),$info:e.find(".week-info")}},n.prototype.insertDate=function(e,t){var n,a=t+("0"+e).slice(-2),r=zp.calendar.getWeekDay(e,t),d=0;for(d;7>d;d++)n=r[d].month+"."+r[d].date,i[a].$thead.eq(d).text(n);return this.insertPlan(this.dateStr),o.weekList.push(this.dateStr),o.weekMap[this.dateStr]=i[this.dateStr].$container,!0},n.prototype.insertPlan=function(e){var t,n,o,r,d,l,s,c,u,p,f,m,h,g,y,v,k,w,b,_,D,x,z=parseInt(e.substr(0,4),10),S=parseInt(e.substr(4,2),10),M=zp.calendar.getWeekDay(S,z);return x=e.substr(0,4)+"-"+("0"+M[0].month).slice(-2)+"-"+("0"+M[0].date).slice(-2),D=new Date(x),b=D.getTime(),D.setDate(D.getDate()+7),_=D.getTime(),d=zp.model.getTodo("dateless"),l=zp.model.getTodo(b+"00000",_+"00000"),s=zp.model.getPlan(b+"00000",_+"00000"),c=zp.model.getDday(b+"00000",_+"00000"),console.log(e,"일정을 삽입합니다."),c.done(function(t){for(p=0;p<t.length;p++)if(n=t[p])for(console.log(n),f=0;7>f;f++)m=("0"+M[f].month).slice(-2),h=("0"+M[f].date).slice(-2),u=z+"-"+m+"-"+h,n.target===u&&(console.log(n.target,u),w=i[e].$info.children().eq(f),k=$("<div/>").addClass("week-dday").text(n.text).appendTo(w))}),c.fail(function(e){console.log(e)}),l.done(function(n){for(p=0;p<n.length;p++)if(t=n[p])for(f=0;7>f;f++)m=("0"+M[f].month).slice(-2),h=("0"+M[f].date).slice(-2),u=z+"-"+m+"-"+h,t.date===u&&(y=t.time.substr(0,2),v=t.time.substr(3,2),r=y*a.tr_h+v*a.tr_h/60+61,console.log("top",r),k=$("<div/>").addClass("week-todo").attr("data-id",t._id),t.done?k.addClass("week-done"):new Date(t.date).getTime()<(new Date).getTime()&&k.addClass("week-due"),g=14.285714*f+"%",k.css({top:r,left:g}).append($("<div/>")).find("div").addClass("input").text(t.text),k.appendTo(i[e].$week))}),l.fail(function(e){console.log(e)}),s.done(function(t){var n,d,l,s,c,b,_;for(p=0;p<t.length;p++)if(o=t[p])for(f=0;7>f;f++)m=("0"+M[f].month).slice(-2),h=("0"+M[f].date).slice(-2),u=z+"-"+m+"-"+h,n=new Date(o.startdate).getTime(),d=new Date(o.enddate).getTime(),l=new Date(u),l>=n&&d>=l&&(n===l?(y=o.starttime.substr(0,2),v=o.starttime.substr(3,2),r=y*a.tr_h+v*a.tr_h/60+61,l===d?(c=o.endtime.substr(0,2),b=o.endtime.substr(3,2),_=c*a.tr_h+b*a.tr_h/60+61,s=_-r):s=24*a.tr_h-r,k=$("<div/>").addClass("week-plan").attr("data-idx",p),g=14.285714*f+"%",k.css({top:r,left:g,height:s}).append($("<div/>")).find("div").addClass("input").text(o.text),k.appendTo(i[e].$week)):l>n&&d>l?(w=i[e].$info.children().eq(f),k=$("<div/>").addClass("week-whole").text(o.text).appendTo(w)):l===d&&(y=o.endtime.substr(0,2),v=o.endtime.substr(3,2),r=0,g=14.285714*f+"%",s=y*a.tr_h+v*a.tr_h/60+61,k=$("<div/>").addClass("week-plan").attr("data-idx",p),k.css({top:r,left:g,height:s}).append($("<div/>")).find("div").addClass("input").text(o.text),k.appendTo(i[e].$week)))}),s.fail(function(e){console.log(e)}),!0},n.prototype.onClickDate=function(e){var t,n=$(this).text(),a=parseInt(n.split(".")[1],10),o=parseInt(n.split(".")[0],10),i=e.data.year;""!==a&&(t={date:a,month:o,year:i},$.gevent.publish("day",[t]))},e=function(e){zp.util.setConfigMap({input_map:e,settable_map:a.settable_map,config_map:a})},t=function(e,t){var a=t.year+("0"+t.week).slice(-2);return new n(e,t,a)},{configModule:e,initModule:t}}(),zp.year=function(){"use strict";var e,t,n,a,o={settable_map:{set_cur_anchor:!0},set_cur_anchor:null},i={yearMap:{},yearList:[]},r={};return n=function(e,t){this.year=t.year,this.initiate(e)},n.prototype.initiate=function(e){e.html($("#zp-year").html()),this.setJqueryMap(e,this.year),this.insertCalendar(this.year),r[this.year].$calendar.on("click",this.year,this.onClickTable)},n.prototype.insertCalendar=function(e){var t,n=0,a={year:e};for(n;12>n;n++)t=r[e].$calendar.eq(n),a.month=parseInt(t.data("month"),10),zp.calendar.initModule(t,a);i.yearList.push(e),i.yearMap[e]=r[e].$container},n.prototype.setJqueryMap=function(e,t){r[t]={$calendar:e.find(".year-calendar")}},n.prototype.onClickTable=function(e){var t=$(this).data("month"),n=e.data,a={month:t,year:n};$.gevent.publish("month",[a])},a=function(){},t=function(e){zp.util.setConfigMap({input_map:e,settable_map:o.settable_map,config_map:o})},e=function(e,t){return t.year=parseInt(t.year,10),i.yearList[t.year]?(alert("already here!"),void e.replaceWith(i.yearMap[t.year].$container)):new n(e,t)},{configModule:t,initModule:e}}();